{{#define type="doc" id="solicitud"}}
  {{param name="=base._nota||'Solicitud'"}}
  {{param excludeHideTenant="true"}}
  {{action id="abrir" hide="true"}}
  {{action id="edi" label="Descargar Interface..." type="save-as" visibleMode="close" color="blue" btnSolid="true" condition="=edi.length" items="=edi" fileName="=persona.nombreCompleto+'.hl7'"}}

  {{#view id="_serviceDash"}}
    {{#pipeline}}
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter condition="=user.onlyAssignedRequests" field="_access.user" in="=user.id"}}
      {{filter condition="=service&&service!='incidencia'" field="base.servicio" eq="=service"}}
      {{filter condition="=service&&service=='incidencia'" field="base.tipoSolicitud" eq="=service"}}
      {{filter condition="=type" field="base.tipoSolicitud" eq="=type"}}
      {{group field="_updated.moment" as="moment"}}
      {{!-- {{group field="_updated._moment" as="_moment"}} --}}
      {{group field="info.base.vencimiento" type="min" as="expires"}}
      {{group field="info.base.alerta" type="min" as="alert"}}
      {{group field="_id" type="count" as="count"}}
    {{/pipeline}}  
    {{#pipeline}}
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter condition="=user.onlyAssignedRequests" field="_access.user" in="=user.id"}}
      {{filter condition="=service&&service!='incidencia'" field="base.servicio" eq="=service"}}
      {{filter condition="=service&&service=='incidencia'" field="base.tipoSolicitud" eq="=service"}}
      {{filter condition="=type" field="base.tipoSolicitud" eq="=type"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{group field="_updated.moment" as="moment"}}
      {{!-- {{group field="_updated._moment" as="_moment"}} --}}
      {{group field="control.subMoment" as="subMoment"}}
      {{!-- {{group field="control._subMoment" as="_subMoment"}} --}}
      {{group field="info.base.vencimiento" type="min" as="expires"}}
      {{group field="info.base.alerta" type="min" as="alert"}}
      {{group field="_id" type="count" as="count"}}
      {{!-- {{mapReduce clearFields="subMoment,_subMoment,expires" clearWhen="moment=ejecutado" keys="service,moment,_moment,subMoment,_subMoment,expires" values="count"}} --}}
    {{/pipeline}}  
    {{calc field="color" type="expr" value="=calc.semaphore(@expires,1,@alert)"}}
    {{calc field="red" type="calc" value="=color=='red'?count:null"}}
    {{calc field="yellow" type="calc" value="=color=='yellow'?count:null"}}
    {{calc field="green" type="calc" value="=color=='green'?count:null"}}
    {{calc field="blue" type="calc" value="=color=='blue'?count:null"}}
    {{calc field="grey" type="calc" value="=color=='grey'?count:null"}}
  {{/view}}

  {{#view id="_serviceLevel" includeHideTenant="true"}}
    {{#pipeline default="=calc.arrayToItems(calc.presetIdWhere('cfg.servicio',{partOf:'sla'}), 'servicio')"}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter field="_updated.moment" in="incumplimiento,centinela"}}
      {{filter condition="=!@desde" field="_date" gt="=fn('nivelServicioDesde')"}}
      {{filter condition="=desde" field="_date" gt="=moment(desde).format()"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=!@sgg" field="_created.tenant" neq="sgg"}}
      {{group field="base.incidencia.base.puntos" type="sum" as="puntos"}}
      {{group field="base.servicio" as="servicio"}}
      {{group field="_updated.moment" as="momento"}}

      {{calc field="servicio" type="expr" value="=fn('servicioSLA', servicio)"}}
      {{calc field="centinelas" type="expr" value="=calc.in(momento, ['centinela'])?1:0"}}
      {{mapReduce keys="servicio,accion" values="puntos,centinelas"}}
    {{/pipeline}}  
    {{calc field="_servicio" type="expr" value="=calc.presetName('cfg.servicio', servicio)"}}
    {{calc field="fecha" type="expr" value="=moment().format()"}}
    {{calc field="accion" type="expr" value="='verIncumplimientos'"}}
    {{calc field="nivel" type="calc" value="=100-calc.number(@puntos)"}}
    {{calc field="factor" type="calc" value="=calc.number(fn('nivelServicioGeneral', servicio))"}}
    {{calc field="general" type="calc" value="=(factor/100)*nivel"}}
    {{acum field="acum" value="=general" type="sum"}}
    {{acum field="acumCentinelas" value="=centinelas" type="sum"}}
    {{calc2 field="valor" value="=servicio=='sla'?acum:nivel"}}
    {{calc2 field="color" type="expr" value="=user.isAdminUser?fn('nivelServicioColor', valor):'gris'"}}  
    {{calc2 field="_color" type="expr" value="=calc.presetName('cfg.colorNivelServicio', color)"}}
    {{calc2 field="titleColor" type="expr" value="=user.isAdminUser&&(centinelas||(servicio=='sla'&&acumCentinelas))?'rojo2':'gris-obscuro2'"}}  
    {{calc2 field="title" type="expr" value="=factor&&calc.format('number', factor/100, '#.##%')"}}  
  {{/view}}

  {{#view id="incumplimientoRegistrados"}}
    {{param id="servicio"}}
    {{#pipeline}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter field="base.servicio" in="=fn('slaServicio', servicio)"}}
      {{filter field="_updated.moment" eq="='incumplimiento'"}}
      {{filter condition="=!@desde" field="_date" gt="=fn('nivelServicioDesde')"}}
      {{filter condition="=desde" field="_date" gt="=moment(desde).format()"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{group field="base.servicio" as="servicio2"}}
      {{group field="base.incidencia.base.puntos" type="sum" as="puntos"}}
      {{group field="_date" as="fecha"}}
      {{sort field="_id.fecha" direction="asc"}}
      {{calc field="servicio2" type="expr" value="=fn('servicioSLA', servicio2)"}}
    {{/pipeline}}  
    {{calc field="_servicio2" type="expr" value="=calc.presetName('cfg.servicio', servicio2)"}}
    {{calc field="factor" type="calc" value="=_params.servicio=='sla'?calc.number(fn('nivelServicioGeneral', servicio2)):100"}}
    {{calc field="puntosFactor" type="calc" value="=(factor/100)*calc.number(@puntos)"}}
    {{acum field="acum" value="=-puntosFactor" type="sum" initialValue="100"}}
  {{/view}}

  {{#view id="_sentinel"}}
    {{#pipeline}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter field="_updated.moment" eq="='centinela'"}}
      {{filter field="_date" gt="=fn('nivelServicioDesde')"}}
      {{group field="_id" type="count" as="conteo"}}
      {{group field="base.servicio" as="servicio"}}

      {{calc field="servicio" type="expr" value="=fn('servicioSLA', servicio)"}}
      {{mapReduce keys="servicio,accion" values="conteo"}}
    {{/pipeline}}  
    {{calc field="accion" type="expr" value="='verCentinelas'"}}
    {{calc field="valor" value="=conteo"}}
    {{calc field="color" type="expr" value="=valor?'rojo':'gris'"}}
  {{/view}}

  {{#view id="centinelaRegistrados"}}
    {{#pipeline}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter field="base.servicio" in="=fn('slaServicio', servicio)"}}
      {{filter field="_updated.moment" eq="='centinela'"}}
      {{filter field="_date" gt="=fn('nivelServicioDesde')"}}
      {{group field="_id" type="count" as="conteo"}}
      {{group field="_date" as="fecha"}}
      {{sort field="_id.fecha" direction="asc"}}
    {{/pipeline}}  
    {{acum field="acum" value="=conteo" type="sum"}}
  {{/view}}

  {{#view id="tiempoNoDisponibilidad"}}
    {{#pipeline}}
      {{filter condition="=codigo" field="base.codigo" in="=codigo"}}
      {{filter field="_updated.moment" nin="pendiente,cancelado,descartado,rechazado,suspendido,suspendidoEntregado"}}
      {{group field="base.codigo" as="codigo"}}
      {{group field="info.base.tiempoNoDisponibilidad" type="sum" as="minutos"}}
    {{/pipeline}}  
  {{/view}}

  {{#view id="cubo"}}
    {{#find limit="-1"}}
      {{include field="_created.user"}}
      {{include field="_date"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona._genero"}}
      {{include field="persona._tipoSanguineo"}}
      {{include field="base._tipoSolicitud"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._categoria"}}
      {{include field="base._prioridad"}}
      {{include field="base._estatus"}}
      {{include field="base.importe"}}
    {{/find}}
  {{/view}}
  {{#cube id="cubo" name="Solicitudes" view="cubo" allowSortingBySummary="true" allowSorting="true" allowFiltering="true" exportToExcel="true" allowExpandAll="true" showColumnGrandTotals="true"}}
    {{column field="_date" type="date" label="Año" groupInterval="year"}}
    {{column field="base._estatus" label="Estatus"}}
    {{column field="persona._genero" width="80" label="Genero"}}
    {{!-- {{column field="_date" type="date" label="Mes" groupInterval="month"}}
    {{column field="_date" type="date" label="Día" groupInterval="day"}} --}}
    {{row field="base._tipoSolicitud" width="250" label="Tipo"}}
    {{row field="base.codigo" width="100" label="Código"}}
    {{row field="base.descripcion" width="250" label="Descripción"}}
    {{row field="base._categoria" width="250" label="Categoría"}}
    {{!-- {{row field="persona._tipoSanguineo" width="20" label="Tipo Sanguineo"}}
    {{row field="persona.nombreCompleto" width="200" label="Paciente"}} --}}
    {{sum field="base.importe" label="Importe" format="currency"}}
    {{count field="_id" label="Cantidad" format="#"}}
  {{/cube}}

  {{#view id="servicio" onlyMapped="true"}}
    {{#find limit="-1"}}
      {{include field="_date"}}
      {{include field="_created.folio"}}
      {{include field="_created._user"}}
      {{include field="base._tipoActividad"}}
      {{include field="base._tipoSolicitud"}}
      {{include field="base._subTipoSolicitud"}}
      {{include field="base._area"}}
      {{include field="base._ubicacion"}}
      {{include field="base._criticidadZona"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._estatus"}}
      {{include field="_updated.moment"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{include field="info.base._motivo"}}
[.#if esSIC.]          
      {{include field="info.base._diagnostico"}}
      {{include field="info.base._subDiagnostico"}}
      {{include field="info.base._resolucion"}}
      {{include field="info.base.costosMantenimiento.base"}}
[./if.]      
[.#if esRH.]
      {{include field="info.base._puesto"}}
[./if.]
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter condition="=desde" field="_date" gt="=moment(desde).format('YYYY-MM-DD')"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
    {{/find}}
    {{map field="fecha" type="expr" value="=_date"}}
    {{map field="folio" type="expr" value="=_created.folio"}}
    {{map field="tipoActividad" type="expr" value="=base._tipoActividad"}}
    {{map field="tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{map field="subTipoSolicitud" type="expr" value="=base._subTipoSolicitud"}}
    {{map field="usuario" type="expr" value="=_created._user"}}
    {{map field="area" type="expr" value="=base._area"}}
    {{map field="criticidadZona" type="expr" value="=base._criticidadZona"}}
    {{map field="ubicacion" type="expr" value="=base._ubicacion"}}
    {{map field="situacionGeneral" type="expr" value="=fn('situacionGeneral', _updated.moment)"}}
    {{map field="momento" type="expr" value="=_updated._moment"}}
    {{map field="subMomento" type="expr" value="=control._subMoment"}}
    {{map field="codigo" type="expr" value="=base.codigo"}}
    {{map field="motivo" type="expr" value="=info.base._motivo"}}
[.#if esSIC.]    
    {{map field="diagnostico" type="expr" value="=info.base._diagnostico"}}
    {{map field="subDiagnostico" type="expr" value="=info.base._subDiagnostico"}}
    {{map field="resolucion" type="expr" value="=info.base._resolucion"}}
    {{map field="costoInsumos" type="expr" value="=info.base.costosMantenimiento.base.costoInsumos"}}
    {{map field="costoRepuestos" type="expr" value="=info.base.costosMantenimiento.base.costoRepuestos"}}
    {{map field="costoServicios" type="expr" value="=info.base.costosMantenimiento.base.costoServicios"}}
    {{map field="costoTotal" type="expr" value="=info.base.costosMantenimiento.base.costoTotal"}}
[./if.]    
[.#if esRH.]    
    {{map field="puesto" type="expr" value="=info.base._puesto"}}
[./if.]    
  {{/view}}
  {{#cube id="servicio" name="Solicitudes" view="servicio" allowSortingBySummary="true" allowSorting="true" allowFiltering="true" exportToExcel="true" allowExpandAll="true" showColumnGrandTotals="true"}}
    {{column field="situacionGeneral" label="Situación General" fixedOrder="En Ejecución,Ejecutado,Incumplimiento,Centinela,Cancelado"}}
    {{column field="momento" label="Momento" hide="true"}}
[.#if esSIC.]    
    {{column field="diagnostico" label="Diagnóstico"}}
    {{column field="subDiagnostico" label="Sub Diagnóstico"}}
    {{column field="resolucion" label="Resolución"}}
[./if.]
    {{column field="momento" label="Momento"}}
    {{column field="subMomento" label="Sub Momento"}}
    {{column field="criticidadZona" label="Criticidad Zona"}}
    {{column field="area" label="Área"}}
    {{column field="ubicacion" label="Ubicación"}}
    {{column field="codigo" label="Código"}}
    {{row field="fecha" type="date" label="Año" groupInterval="year"}}
    {{row field="fecha" type="date" label="Mes" groupInterval="month"}}
    {{row field="fecha" type="date" label="Día" groupInterval="day"}}
    {{row field="tipoSolicitud" width="150" label="Tipo Solicitud"}}
    {{row field="subTipoSolicitud" width="150" label="Sub Tipo Solicitud"}}
    {{row field="tipoActividad" width="100" label="Tipo Actividad"}}
    {{row field="motivo" width="150" label="Motivo"}}
    {{row field="usuario" width="150" label="Usuario"}}
    {{row field="folio" label="Folio"}}
    {{count field="folio" label="Cantidad" format="#"}}
[.#if esSIC.]        
    {{sum field="costoInsumos" label="Costo Insumos" format="currency"}}
    {{sum field="costoRepuestos" label="Costo Repuestos" format="currency"}}
    {{sum field="costoServicios" label="Costo Servicios" format="currency"}}
    {{sum field="costoTotal" label="Costo Total" format="currency"}}
[./if.]
  {{/cube}}

  {{#view id="alimentacionPacientes" onlyMapped="true"}}
    {{#find limit="-1"}}
      {{include field="_date"}}
      {{include field="_created.folio"}}
      {{include field="_created._user"}}
      {{include field="base._subTipoSolicitud"}}
      {{include field="base._area"}}
      {{include field="base._ubicacion"}}
      {{include field="base.alimentacionPacientes.base._momentoDieta"}}
      {{include field="base.alimentacionPacientes.base._regimenAlimenticio"}}
      {{include field="base.alimentacionPacientes.base._hidratacion"}}
      {{include field="base.alimentacionPacientes.base._preparacion"}}
      {{include field="base.alimentacionPacientes.base._desechable"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._estatus"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter condition="=desde" field="_date" gt="=moment(desde).format('YYYY-MM-DD')"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
    {{/find}}
    {{map field="fecha" type="expr" value="=_date"}}
    {{map field="folio" type="expr" value="=_created.folio"}}
    {{map field="subTipoSolicitud" type="expr" value="=base._subTipoSolicitud"}}
    {{map field="usuario" type="expr" value="=_created._user"}}
    {{map field="area" type="expr" value="=base._area"}}
    {{map field="ubicacion" type="expr" value="=base._ubicacion"}}
    {{map field="momento" type="expr" value="=control._subMoment||_updated._moment"}}
    {{map field="momentoDieta" type="expr" value="=base.alimentacionPacientes.base._momentoDieta"}}
    {{map field="regimenAlimenticio" type="expr" value="=base.alimentacionPacientes.base._regimenAlimenticio"}}
    {{map field="menu" type="expr" value="=calc.concatValueKey(base.descripcion, base.codigo)"}}
    {{map field="hidratacion" type="expr" value="=base.alimentacionPacientes.base._hidratacion"}}
    {{map field="preparacion" type="expr" value="=base.alimentacionPacientes.base._preparacion"}}
    {{map field="desechable" type="expr" value="=base.alimentacionPacientes.base._desechable"}}
  {{/view}}
  {{#cube id="alimentacionPacientes" name="Solicitudes" view="alimentacionPacientes" allowSortingBySummary="true" allowSorting="true" allowFiltering="true" exportToExcel="true" allowExpandAll="true" showColumnGrandTotals="true"}}
    {{column field="momento" label="Momento" expanded="true"}}
    {{row field="momentoDieta" width="200" label="Tiempo Alimentación" expanded="true"}}
    {{row field="regimenAlimenticio" width="200" label="Régimen Alimenticio" expanded="true"}}
    {{row field="menu" width="400" label="Menú"}}
    {{count field="folio" label="Cantidad" format="#"}}
  {{/cube}}

  {{#view id="reporteGeneral"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="_date" direction="asc"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
    {{/find}}
    {{calc field="importe" type="expr" value="=calc.round(control.importe,2)"}}
    {{calc field="porCobrar" type="expr" value="=calc.round(control.porCobrar,2)"}}
    {{calc field="porPagar" type="expr" value="=calc.round(control.porPagar,2)"}}
    {{calc field="cobrado" type="expr" value="=importe-porCobrar"}}
    {{calc field="pagado" type="expr" value="=importe-porPagar"}}
  {{/view}}

  {{#view id="historialCitas"}}
    {{#find limit="-1"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona._edadActual"}}
      {{include field="persona._genero"}}
      {{include field="base._nota"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._tipoCita"}}
      {{include field="base._prestadorServicios"}}
      {{include field="base._especialidad"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{filter field="base.fechaHoraCita" exists="true"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=desde"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{sort field="base.fechaHoraCita" direction="desc"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
  {{/view}}

  {{#view id="historialSolicitudes"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_moment.finalizado"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona._edadActual"}}
      {{include field="persona._genero"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._prestadorServicios"}}
      {{include field="base._especialidad"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{filter field="_updated.moment" eq="='finalizado'"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio"}}
      {{filter condition="=desde" field="_moment.finalizado.date" gt="=desde"}}
      {{filter condition="=hasta" field="_moment.finalizado.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{sort field="_moment.finalizado.date" direction="desc"}}
    {{/find}}
  {{/view}}

  {{#view id="reporteConsultaExterna"}}
    {{complexView type="reporteConsultaExterna"}}
  {{/view}}

  {{#view id="baseReporteConsultaExterna"}}
    {{#find limit="-1" flatten="true"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=desde"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter field="base.tipoSolicitud" eq="='consultaExterna'"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.codigo" neq="='(multiple)'"}}
      {{include field="base.fechaHoraCita" as="fechaHoraCita"}}
      {{include field="_created.folio" as="folio"}}
      {{include field="_created._user" as="usuarioAlta"}}
      {{include field="_created.date" as="fechaAlta"}}
      {{include field="_updated._user" as="usuarioCambio"}}
      {{include field="_updated.date" as="fechaCambio"}}
      {{include field="_updated._moment" as="momento"}}
      {{include field="_moment.pre.date" as="fechaInicia"}}
      {{include field="_moment.finalizado.date" as="fechaTermina"}}
      {{include field="persona.id" as="personaId"}}
      {{include field="persona.clave" as="curp"}}
      {{include field="persona.nombreCompleto" as="nombreCompleto"}}
      {{include field="persona._genero" as="genero"}}
      {{include field="persona._edadActual" as="edadActual"}}
      {{include field="persona.fechaNacimiento" as="fechaNacimiento"}}
      {{include field="base.descripcion" as="descripcion"}}
      {{include field="base._prioridad" as="prioridad"}}
      {{include field="base.prestadorServicios" as="prestadorServiciosSolicitud"}}
      {{include field="base.consultaExterna.base.cita.base.recursoEspecifico" as="prestadorServiciosCita"}}
      {{include field="_updated._reason" as="motivo1"}}
      {{include field="respuesta.base._motivoCancelacion" as="motivo2"}}
    {{/find}}
    {{calc field="duracion" type="expr" value="=moment(fechaTermina).diff(fechaInicia, 'minutes')"}}
    {{calc field="prestadorServiciosId" type="expr" value="=@prestadorServiciosSolicitud||@prestadorServiciosCita"}}
    {{calc field="motivo" type="expr" value="=@motivo1||@motivo2"}}
  {{/view}}
  

  {{#view id="cuboConsultaExterna"}}
    {{#find limit="-1"}}
      {{filter field="base.fechaHoraCita" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.fechaHoraCita" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona._genero"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._tipoCita"}}
      {{include field="base._categoria"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{filter field="base.tipoSolicitud" eq="='consultaExterna'"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
  {{/view}}

  {{#grid id="citasDelPaciente" name="Citas del Paciente" view="citasDelPaciente" exportToExcel="false" allowRefresh="true" columnChooser="false" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="fechaCita" label="Fecha Cita" format="DD/MMM/YYYY h:mma" type="date" width="150"}}
    {{column field="_tipoSolicitud" label="Servicio" width="100"}}
    {{column field="_name" label="Descripción" width="500"}}
  {{/grid}}

  {{#cube id="cuboConsultaExterna" name="Consulta Externa" view="cuboConsultaExterna" allowSortingBySummary="true" allowSorting="true" allowFiltering="true" exportToExcel="true" allowExpandAll="true" showColumnGrandTotals="true"}}
    {{column field="base.fechaHoraCita" type="date" label="Día" groupInterval="day"}}
    {{column field="persona._genero" width="80" label="Genero"}}
    {{column field="persona.nombreCompleto" width="200" label="Persona"}}
    {{row field="base._tipoCita" width="250" label="Tipo"}}
    {{row field="base._categoria" width="150" label="Categoría"}}
    {{row field="_updated._moment" width="150" label="Momento"}}
    {{row field="base.codigo" width="100" label="Código"}}
    {{row field="base.descripcion" width="250" label="Descripción"}}
    {{count field="_id" label="Cantidad" format="#"}}
  {{/cube}}

  {{#view id="cuboInterconsulta"}}
    {{#find limit="-1"}}
      {{filter field="base.fechaHoraCita" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.fechaHoraCita" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona._genero"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base._tipoCita"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{filter field="base.tipoSolicitud" eq="='interconsulta'"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
  {{/view}}

  {{#cube id="cuboInterconsulta" name="Consulta Externa" view="cuboInterconsulta" allowSortingBySummary="true" allowSorting="true" allowFiltering="true" exportToExcel="true" allowExpandAll="true" showColumnGrandTotals="true"}}
    {{column field="base.fechaHoraCita" type="date" label="Día" groupInterval="day"}}
    {{column field="persona._genero" width="80" label="Genero"}}
    {{column field="persona.nombreCompleto" width="200" label="Persona"}}
    {{row field="base._tipoCita" width="250" label="Tipo"}}
    {{row field="_updated._moment" width="150" label="Momento"}}
    {{row field="base.codigo" width="100" label="Código"}}
    {{row field="base.descripcion" width="250" label="Descripción"}}
    {{count field="_id" label="Cantidad" format="#"}}
  {{/cube}}

  {{#view id="momentoConteo"}}
    {{#pipeline}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=subTipoSolicitud" field="base.subTipoSolicitud" eq="=subTipoSolicitud"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{group field="_updated.moment" as="momento"}}
      {{group field="_created.folio" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}

  {{#view id="solicitadoAcum"}}
    {{#pipeline}}
      {{filter field="_updated.moment" eq="='programado'"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" in="=persona"}}
      {{filter condition="=codigo" field="base.codigo" in="=codigo"}}
      {{group field="persona.id" as="persona"}}
      {{group field="base.codigo" as="codigo"}}
      {{group field="base.solicitado" type="sum" as="solicitado"}}
    {{/pipeline}}
  {{/view}}

  {{#view id="entregado"}}
    {{#find}}
      {{include field="_moment.entregado"}}
      {{include field="_moment.cancelado"}}
      {{include field="_created._user"}}
    {{/find}}
  {{/view}}

  {{#view id="salidasCobradas"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created._user"}}
      {{include field="_date"}}
      {{include field="base.cantidad"}}
      {{include field="base._central"}}
      {{include field="base._solicitante"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
    {{/find}}
  {{/view}}

  {{#view id="deHoy"}}
    {{#find limit="-1"}}
      {{include field="_name"}}      
      {{include field="base.tipoSolicitud"}}
      {{include field="base.estatus"}}
      {{include field="base._estatus"}}
      {{include field="_updated.moment"}}
      {{include field="_updated._moment"}}
      {{include field="control"}}
      {{include field="base.cantidad"}}
      {{include field="_parent"}}
      {{filter field="persona.id" eq="=persona"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','suspendido,suspendidoEntregado,suspendidoEntregado',true)"}}
      {{filter field="_created.date" gt="=moment().add(-1,'day').format()"}}   {{!-- checa que sea mayor a las 7am --}}
    {{/find}}
    {{calc field="siguienteDosis" type="expr" value="=control.siguienteDosis"}}
    {{calc field="siguienteDosisHora" type="expr" value="=control.siguienteDosis&&moment(control.siguienteDosis).format('h:mma')"}}
    {{calc field="velocidad" type="expr" value="=control.velocidad"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="informacionSolicitud" type="expr" value="=calc.concatPairs('Solicitado',solicitado,'Utilizado',utilizado,'Faltante',faltante,'ml/hora',velocidad,'Siguiente Dósis',siguienteDosisHora,'Momento',_updated._moment)"}}
  {{/view}}

  {{#view id="farmaciaHoy"}}
    {{#find limit="-1" flatten="true"}}
      {{include field="_name" as="_name"}}
      {{include field="base.estatus" as="estatus"}}
      {{include field="_updated._moment" as="_moment"}}
      {{include field="control.porMinistrar" as="porMinistrar"}}
      {{include field="control.siguienteDosis" as="siguienteDosis"}}
      {{include field="control.velocidad" as="velocidadActual"}}
      {{filter field="persona.id" eq="=persona"}}
      {{filter field="base.tipoSolicitud" in="medicamento,solucion,mezcla"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','suspendido,suspendidoEntregado,suspendidoEntregado',true)"}}
      {{filter field="_created.date" gt="=moment().format('YYYY-MM-DDT07')"}}   {{!-- checa que sea mayor a las 7am --}}
    {{/find}}
    {{calc field="horaSiguienteDosis" type="expr" value="=moment(siguienteDosis).format('h:mma')"}}
    {{calc field="velocidadNueva" type="expr" value="=calc.round(velocidadActual,4)"}}
    {{calc field="accion" type="expr" value="='continuar'"}}
  {{/view}}

  {{#view id="reporteCobertura" onlyMapped="true"}}
    {{#find limit="-1"}}
      {{include field="_created.short"}}
      {{include field="_date"}}
      {{include field="_updated._moment"}}
      {{include field="base.tipoActividad"}}
      {{include field="base.ubicacion"}}
      {{include field="info.base._motivo"}}
      {{filter field="base.tipoSolicitud" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','suspendido,suspendidoEntregado,suspendidoEntregado',true)"}}
      {{filter condition="=desde" field="_date" gt="=moment(desde).format('YYYY-MM-DD')"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
    {{/find}}
    {{join source="persona" view="datosPersona" as="ubicacion" id="base.ubicacion"}}
    {{map field="_name" type="expr" value="=_created.short"}}
    {{map field="_date" type="expr" value="=_date"}}
    {{map field="_motivo" type="expr" value="=info.base._motivo"}}
    {{map field="_moment" type="expr" value="=_updated._moment"}}
    {{map field="_ubicacion" type="expr" value="=ubicacion._name"}}
    {{map field="_tipoActividad" type="expr" value="=base._tipoActividad"}}
    {{map field="superficie" type="expr" value="=ubicacion.persona.superficie"}}
  {{/view}}

  {{#view id="solicitudesEgreso"}}
    {{#find limit="-1" flatten="true"}}
      {{include field="_name" as="_name"}}
      {{include field="base.estatus" as="estatus"}}
      {{include field="_updated._moment" as="_moment"}}
      {{filter field="persona.id" eq="=persona"}}
      {{filter field="base.tipoSolicitud" nin="dieta,suive,anticipo,consultaExterna,nota"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="pendiente,solicitado,programado"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}      
    {{/find}}
    {{calc field="accion" type="expr" value="='continuar'"}}
  {{/view}}

  {{#view id="lista"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_moment"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=!@todo" field="base.fechaHoraCita" direction="desc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
[.#if esSIC.]
      {{search field="base._area"}}
[./if.]
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=infoServicio" field="info.base.servicio" eq="=infoServicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=request" field="_created.request" eq="=request"}}
      {{filter condition="=usuario" field="_created.user" eq="=usuario"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=subTipoSolicitud" field="base.subTipoSolicitud" eq="=subTipoSolicitud"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gt="=0"}}
      {{filter condition="=parentId" field="_parent.id" eq="=parentId"}}
      {{filter condition="=tieneControl" field="='control.'+tieneControl" exists="=true"}}
      {{filter condition="=!@todo" field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=!@todo" field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter condition="=user.onlyAssignedRequests" field="_access.user" in="=user.id"}}
      {{filter condition="=articulo" field="articulo.id" eq="=articulo"}}
      {{filter condition="=articuloMantenimiento" field="info.notaAsignacionAcceso.base.procedimientoMantenimiento" eq="=articuloMantenimiento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
    {{/find}}
    {{calc field="_servicio" type="expr" value="=calc.presetName('cfg.servicio', base.servicio)"}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="semaforo" type="expr" value="=calc.in(estatus, fn('listaEstatus','activos'))?calc.semaphore(info.base.vencimiento,1,info.base.alerta):null"}}
    {{calc field="_momentoActual" type="expr" value="=_moment[_updated.moment]._doc"}}
    {{calc field="_estatusEvaluacion" type="expr" value="=base.tipoSolicitud=='evaluacion'?fn('_estatusEvaluacion', base, _updated, control):null"}}
    {{calc field="definicion" type="expr" value="=calc.momentDefinition(control.subMoment)"}}
    {{calc field="esFormato2" type="expr" value="=calc.in(base.tipoSolicitud,['adquisicion'])"}}
  {{/view}}

  {{#view id="buscar"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_moment"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}
      {{filter condition="=_service" or="true" field="base.servicio" eq="=_service" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=_service" or="true" field="base.servicioOrigen" eq="=_service" orInPresetPartOf="cfg.servicio"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="semaforo" type="expr" value="=calc.in(estatus, fn('listaEstatus','activos'))?calc.semaphore(info.base.vencimiento,1,info.base.alerta):null"}}
    {{calc field="_momentoActual" type="expr" value="=_moment[_updated.moment]._doc"}}
  {{/view}}

  {{#view id="miLista"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="base.fechaHoraCita" direction="desc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_created.user" eq="=user.id"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=request" field="_created.request" eq="=request"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gt="=0"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
  {{/view}}

  {{#view id="porDias"}}
[.#if esSIC.]
    {{#find}}
[.else.]
    {{#find elastic="true"}}
[./if.]    
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{!-- {{sort field="base.fechaHoraCita" direction="desc"}} --}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_created.date" gt="=moment().add(-dias,'d').format('YYYY-MM-DD')"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
  {{/view}}

  {{#view id="conveniosEnsenanzaActivos"}}
    {{#find}}
      {{include field="base.nombreCorto"}}
      {{search field="base.nombreCorto"}}
      {{sort field="base.nombreCorto" direction="asc"}}
      {{filter field="base.tipoSolicitud" eq="='convenio'"}}
      {{filter field="base.convenio.base.tipoConvenio" eq="='ensenanza'"}}
      {{filter field="_updated.moment" eq="='activo'"}}
    {{/find}}
    {{editor display="base.nombreCorto"}}
  {{/view}}

  {{#view id="cursos"}}
    {{#find}}
      {{include field="base.nombreCorto"}}
      {{search field="base.nombreCorto"}}
      {{sort field="base.nombreCorto" direction="asc"}}
      {{filter field="base.tipoSolicitud" eq="='curso'"}}
    {{/find}}
    {{editor display="base.nombreCorto"}}
  {{/view}}

  {{#view id="cursosCapacitacion"}}
    {{#find}}
      {{include field="base.descripcion"}}
      {{search field="base.descripcion"}}
      {{sort field="base.descripcion" direction="asc"}}
      {{filter field="base.tipoSolicitud" eq="='capacitacion'"}}
      {{filter field="base.subTipoSolicitud" eq="='curso'"}}
    {{/find}}
    {{editor display="base.descripcion"}}
  {{/view}}

  {{#view id="cursosCapacitacionActivos"}}
    {{#find}}
      {{include field="base.descripcion"}}
      {{search field="base.descripcion"}}
      {{sort field="base.descripcion" direction="asc"}}
      {{filter field="base.tipoSolicitud" eq="='capacitacion'"}}
      {{filter field="base.subTipoSolicitud" eq="='curso'"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" nin="ejecutado,cancelado"}}
    {{/find}}
    {{editor display="base.descripcion"}}
  {{/view}}

  {{#view id="cursosProgramadosRol"}}
    {{#find}}
      {{include field="base.nombreCorto"}}
      {{search field="base.nombreCorto"}}
      {{sort field="base.nombreCorto" direction="asc"}}
      {{filter field="base.tipoSolicitud" eq="='curso'"}}
      {{filter field="_updated.moment" eq="='programado'"}}
      {{filter condition="=tipoExpediente=='alumno'" field="base.curso.base.alumnosExternos" eq="='si'"}}
      {{filter condition="=tipoExpediente!='alumno'" field="base.curso.base.rolesEspecificos" in="=user.roles"}}
    {{/find}}
    {{editor display="base.nombreCorto"}}
  {{/view}}

  {{#view id="inscripcionesAbiertas"}}
    {{#find}}
      {{include field="_name"}}
      {{search field="_name"}}
      {{sort field="_name" direction="asc"}}
      {{filter field="base.tipoSolicitud" eq="='capacitacion'"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{filter field="control.subMoment" eq="='inscripcionesAbiertas'"}}
      {{filter field="base.capacitacion.base.tipoPersonal" in="=user.staffType"}}
    {{/find}}
    {{editor display="_name"}}
  {{/view}}

  {{#view id="misInscripcionesFinalizadas"}}
    {{#find}}
      {{include field="_name"}}
      {{search field="_name"}}
      {{sort field="_name" direction="asc"}}
      {{filter field="persona.id" eq="=persona"}}
      {{filter field="base.tipoSolicitud" eq="='inscripcionCurso'"}}
      {{filter field="_updated.moment" eq="='finalizado'"}}
    {{/find}}
    {{editor display="_name"}}
  {{/view}}

  {{#view id="resultadosTxDx"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="_updated.date" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
[.#if esSIC.]
      {{search field="base._area"}}
[./if.]
      {{filter field="_created.service" in="laboratorio,imagenologia,patologia,hemodinamia,endoscopia,endourologia,electrodiagnostico,medicinaNuclear"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="_updated.moment" in="finalizado"}}
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
  {{/view}}
  
  {{#view id="porAutorizar"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_updated.moment" eq="='pendiente'"}}   {{!-- exists="false" --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" eq="=true"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoControl" field="base.tipoControl" eq="=tipoControl"}}
      {{filter condition="=esAdulto" field="persona.edadActual" gte="=17"}}
      {{filter condition="=esMenor" field="persona.edadActual" lt="=17"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="base"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{include field="base"}}
      {{include field="info"}}
    {{/find}}
  {{/view}}

  {{#view id="pendientesContratacion"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}      
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicio"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_updated.moment" eq="='pendiente'"}} {{!-- exists="false" --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" exists="false"}}
      {{filter condition="=usuario" field="base.usuario" eq="=usuario"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=requiereAnestesiologo" field="base.requiereAnestesiologo" eq="=requiereAnestesiologo"}}
      {{filter condition="=requiereAnestesiologo" field="base.tipoSolicitud" in="procedimiento,imagenologia"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
    {{/find}}
    {{join source="persona" view="perfil" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{!-- {{#join source="persona" view="empleadosDelPuesto" as="join" id="persona.puesto"}}
      {{param puesto="=persona.puesto"}}
    {{/join}} --}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="resumenCentinelasDGC"}}
    {{#pipeline}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" eq="='centinela'"}}
      {{filter field="control.registroDGC" exists="=false"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}  
  {{/view}}

  {{#view id="hojaFrontal"}}
    {{#find limit="-1"}}
      {{include field="_created.date"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}
      {{include field="_name"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="base._tipoSolicitud"}}
      {{include field="base._servicioOrigen"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="persona.id" eq="=persona"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado',true)"}}
    {{/find}}
  {{/view}}

  {{#view id="misPendientes"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicio"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_updated.moment" in="pendiente,eventoCancelado"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" exists="false"}}
      {{filter field="base.usuario" eq="=user.id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=requiereAnestesiologo" field="base.requiereAnestesiologo" eq="=requiereAnestesiologo"}}
      {{filter condition="=requiereAnestesiologo" field="base.tipoSolicitud" in="procedimiento,imagenologia"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{union source="nota" view="misNotificaciones"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}    
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="confirmados"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_updated.moment" eq="='confirmado'"}} {{!-- exists="false" --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" exists="false"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=requiereAnestesiologo" field="base.requiereAnestesiologo" eq="=requiereAnestesiologo"}}
      {{filter condition="=requiereAnestesiologo" field="base.tipoSolicitud" in="procedimiento,imagenologia"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="programacionCitas"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_moment"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="base.fechaHoraCita" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente',true)"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
  {{/view}}

  {{#view id="resumenPendientesConformidad"}}
    {{#pipeline}}
      {{filter field="persona.id" in="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="ejecutado"}}
      {{filter field="control.subMoment" neq="ejecutadoTercero"}}
      {{filter field="base.tipoSolicitud" nin="conteoRopa"}}
      {{group field="_id" type="count" as="count"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
  {{/view}}

  {{#view id="resumenSolicitudesPuesto"}}
    {{#find limit="-1"}}
      {{include field="_name"}}
      {{include field="_updated._moment"}}
      {{include field="control._subMoment"}}

      {{sort field="_name" direction="asc"}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="_hide" neq="=true"}}
      {{filter field="_updated.moment" in="autorizado,seleccionado"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=_updated._moment"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="resumenDocumentacionPendiente"}}
    {{#pipeline}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='documentacion'"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{filter field="control.subMoment" in="porEntregar,porCorregir"}}
      {{group field="_id" type="count" as="conteo"}}
      {{group field="base.vencimiento" type="min" as="vencimiento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
    {{calc field="color" type="expr" value="=calc.semaforo(vencimiento,12)"}}
    {{calc field="backgroudColor" type="expr" value="='gris'"}}
  {{/view}}

  {{#view id="resumenEvaluacionesPendientes"}}
    {{#pipeline}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='evaluacion'"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{filter field="control.subMoment" eq="porResponder"}}
      {{group field="_id" type="count" as="conteo"}}
      {{group field="base.vencimiento" type="min" as="vencimiento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
    {{calc field="color" type="expr" value="=calc.semaforo(vencimiento,12)"}}
    {{calc field="backgroudColor" type="expr" value="='gris'"}}
  {{/view}}

  {{#view id="resumenPorAutorizarJefeDirecto"}}
    {{#pipeline}}
      {{filter field="base.jefeInmediato" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{filter field="control.subMoment" eq="porAutorizarPropuesta"}}
      {{group field="_id" type="count" as="conteo"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
  {{/view}}

  {{#view id="resumenDocumentacionEnRevision"}}
    {{#pipeline}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='documentacion'"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{filter field="control.subMoment" eq="enRevision"}}
      {{group field="_id" type="count" as="conteo"}}
      {{group field="base.vencimiento" type="min" as="vencimiento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
    {{!-- {{calc field="color" type="expr" value="=calc.semaforo(vencimiento,12)"}} --}}
    {{calc field="color" type="expr" value="='azul'"}}
    {{calc field="backgroudColor" type="expr" value="='gris'"}}
  {{/view}}

  {{#view id="resumenEvaluacionesEnRevision"}}
    {{#pipeline}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='evaluacion'"}}
      {{filter field="_updated.moment" eq="='enEjecucion'"}}
      {{filter field="control.subMoment" eq="enCalificacion"}}
      {{group field="_id" type="count" as="conteo"}}
      {{group field="base.vencimiento" type="min" as="vencimiento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
    {{!-- {{calc field="color" type="expr" value="=calc.semaforo(vencimiento,12)"}} --}}
    {{calc field="color" type="expr" value="='azul'"}}
    {{calc field="backgroudColor" type="expr" value="='gris'"}}
  {{/view}}

  {{#view id="resumenCitasPorMedico"}}
    {{#pipeline}}
      {{filter field="_created.service" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=desde"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{group field="base._prestadorServicios" as="medico"}}
      {{group field="base._tipoCita" as="tipoCita"}}
      {{group field="_updated._moment" as="momento"}}
      {{group field="_created.folio" type="count" as="conteo"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
  {{/view}}

  {{#view id="resumenCitasPorMedico2"}}
    {{#pipeline}}
      {{filter field="_created.service" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=desde"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{group field="base._prestadorServicios" as="medico"}}
      {{!-- {{group field="base._tipoCita" as="tipoCita"}} --}}
      {{group field="_updated._moment" as="momento"}}
      {{group field="_created.folio" type="count" as="conteo"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
  {{/view}}

  {{#view id="resumenCitasPorUsuario"}}
    {{#pipeline}}
      {{filter field="_created.service" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{sort field="_created.date" direction="asc"}}
      {{group field="_created._user" as="_usuario"}}
      {{group field="base._tipoCita" as="tipoCita"}}
      {{!-- {{group field="_updated._moment" as="momento"}} --}}
      {{group field="_created.folio" type="count" as="conteo"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/pipeline}}  
  {{/view}}

  {{#view id="solicitudesDelServicio"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="base.orden" direction="asc"}}
      {{sort field="base._categoria" direction="asc"}}
      {{sort field="base._central" direction="asc"}}
      {{sort field="base._cama" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente',true)"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="cama" type="expr" value="=calc.concat(base._cama, fn('esPreAlta', base.estatusCama))"}}
  {{/view}}

  {{#view id="hojaDiariaPacientes" onlyMapped2="true"}}
    {{#find limit="-1"}}
      {{include field="_created._service"}}
      {{include field="_created.folio"}}
      {{include field="_parent.folio"}}
      {{include field="_created._user"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="persona.id"}}
      {{include field="base._central"}}
      {{include field="base._cama"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona._genero"}}
      {{include field="persona.fechaNacimiento"}}
      {{include field="persona._edadActual"}}
      {{include field="base._tipoCita"}}
      {{include field="base._prioridad"}}
      {{include field="base._categoria"}}
      {{include field="base.descripcion"}}
      {{include field="_updated._moment"}}
      {{include field="_updated._reason"}}
      {{include field="base._prestadorServicios"}}
      {{include field="base._especialidad"}}
      {{include field="base.consultaExterna.base.cita.base._recursoEspecifico"}}
      {{include field="base._solicitante"}}
      {{include field="_moment.cancelado._user"}}
      {{!-- {{include field="base._diagnostico"}} --}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="_updated.moment" in="pendiente,solicitado,programado,pre,trans,post"}} --}}
      {{filter field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=moment(desde).format('YYYY-MM-DD')"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(@addDays||0, 'days').format('YYYY-MM-DD')"}}
      {{!-- {{hint index="base.fechaHoraCita_1"}} --}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="_diagnostico" as="join" id="persona.id"}}
    {{map field="_servicio" type="expr" value="=_created._service" label="Servicio"}}
    {{map field="folio" type="expr" value="=_created.folio" label="Folio Solicitud"}}
    {{map field="folioNota" type="expr" value="=_parent.folio" label="Folio Nota"}}
    {{map field="_usuarioSolicitud" type="expr" value="=_created._user" label="Usuario Solicitud"}}
    {{map field="fechaCita" type="expr" value="=base.fechaHoraCita" label="Fecha Cita"}}
    {{map field="_central" type="expr" value="=base._central" label="Central"}}
    {{map field="_cama" type="expr" value="=base._cama" label="Cama"}}
    {{map field="_persona" type="expr" value="=persona.nombreCompleto" label="Paciente"}}
    {{map field="curp" type="expr" value="=persona.clave" label="CURP"}}
    {{map field="_genero" type="expr" value="=persona._genero" label="Genero"}}
    {{map field="fechaNacimiento" type="expr" value="=moment(persona.fechaNacimiento).format()" label="Fecha Nacimiento"}}
    {{map field="_edadActual" type="expr" value="=persona._edadActual" label="Edad"}}
    {{map field="_tipoCita" type="expr" value="=base._tipoCita" label="Tipo Cita"}}
    {{map field="_prioridad" type="expr" value="=base._prioridad" label="Prioridad"}}
    {{map field="_categoria" type="expr" value="=base._categoria" label="Categoría"}}
    {{map field="descripcion" type="expr" value="=base.descripcion" label="Descripción"}}
    {{map field="_momento" type="expr" value="=_updated._moment" label="Momento"}}
    {{map field="_motivoCancelacion" type="expr" value="=_updated._reason" label="Motivo Cancelación"}}
    {{map field="_prestadorServicios" type="expr" value="=base._prestadorServicios" label="Prestador Servicios"}}
    {{map field="_especialidad" type="expr" value="=base._especialidad" label="Especialidad"}}
    {{map field="_recursoEspecifico" type="expr" value="=base.consultaExterna.base.cita.base._recursoEspecifico" label="Recurso Específico"}}
    {{map field="_solicitante" type="expr" value="=base._solicitante" label="Solicitante"}}
    {{map field="_diagnostico" type="expr" value="=join.detalle._diagnostico" label="Diagnósticos"}}
    {{map field="expendiente" type="expr" value="=calc.concatValueKey(join._created.consecutive, join.persona.expedienteInterno)" label="Expendiente"}}
    {{map field="familiarResponsable" type="expr" value="=join.persona._familiarResponsable" label="Familiar Responsable"}}
  {{/view}}


  {{#view id="citasDelPaciente" onlyMapped2="true"}}
    {{#find limit="-1"}}
      {{include field="_created._service"}}
      {{include field="_created.folio"}}
      {{include field="_parent.folio"}}
      {{include field="_created._user"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="persona.id"}}
      {{include field="base._central"}}
      {{include field="base._cama"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona._genero"}}
      {{include field="persona.fechaNacimiento"}}
      {{include field="persona._edadActual"}}
      {{include field="base._tipoSolicitud"}}
      {{include field="base._tipoCita"}}
      {{include field="base._prioridad"}}
      {{include field="base._categoria"}}
      {{include field="base.descripcion"}}
      {{include field="_updated.moment"}}
      {{include field="_updated._moment"}}
      {{include field="_updated._reason"}}
      {{include field="base._prestadorServicios"}}
      {{include field="base._especialidad"}}
      {{include field="base._solicitante"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.fechaHoraCita" exists="=true"}}
      {{filter field="_updated.moment" eq="='programado'"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=moment(desde).format('YYYY-MM-DD')"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(@addDays||0, 'days').format('YYYY-MM-DD')"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{map field="_name" type="expr" value="=_name" label="Nombre"}}
    {{map field="_servicio" type="expr" value="=_created._service" label="Servicio"}}
    {{map field="folio" type="expr" value="=_created.folio" label="Folio Solicitud"}}
    {{map field="folioNota" type="expr" value="=_parent.folio" label="Folio Nota"}}
    {{map field="_usuarioSolicitud" type="expr" value="=_created._user" label="Usuario Solicitud"}}
    {{map field="fechaCita" type="expr" value="=base.fechaHoraCita" label="Fecha Cita"}}
    {{map field="_central" type="expr" value="=base._central" label="Central"}}
    {{map field="_cama" type="expr" value="=base._cama" label="Cama"}}
    {{map field="curp" type="expr" value="=persona.clave" label="CURP"}}
    {{map field="_genero" type="expr" value="=persona._genero" label="Genero"}}
    {{map field="fechaNacimiento" type="expr" value="=moment(persona.fechaNacimiento).format()" label="Fecha Nacimiento"}}
    {{map field="_edadActual" type="expr" value="=persona._edadActual" label="Edad"}}
    {{map field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud" label="Tipo Solicitud"}}
    {{map field="_tipoCita" type="expr" value="=base._tipoCita" label="Tipo Cita"}}
    {{map field="_prioridad" type="expr" value="=base._prioridad" label="Prioridad"}}
    {{map field="_categoria" type="expr" value="=base._categoria" label="Categoría"}}
    {{map field="descripcion" type="expr" value="=base.descripcion" label="Descripción"}}
    {{map field="_momento" type="expr" value="=_updated._moment" label="Momento"}}
  {{/view}}

  {{#view id="hojaDiariaPacientesSinCita"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment.cancelado._user"}}
      {{sort field="_date" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="_updated.moment" in="pendiente,solicitado,programado,pre,trans,post"}} --}}
      {{filter field="base.fechaHoraCita" exists="=false"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="_diagnostico" as="join" id="persona.id"}}
    {{calc field="_diagnostico" type="expr" value="=join.detalle._diagnostico" label="Diagnósticos"}}
    {{calc field="expendiente" type="expr" value="=calc.concatValueKey(join._created.consecutive, join.persona.expedienteInterno)" label="Expendiente"}}
    {{calc field="familiarResponsable" type="expr" value="=join.persona._familiarResponsable" label="Familiar Responsable"}}    
  {{/view}}

  {{#view id="enDevolucion"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="control"}}
      {{sort field="base.orden" direction="asc"}}
      {{sort field="base._cama" direction="asc"}}
      {{filter field="base.central" eq="=central"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="devolucion"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="cama" type="expr" value="=calc.concat(base._cama, fn('esPreAlta', base.estatusCama))"}}
  {{/view}}

  {{#view id="bitacoraCadaveres"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{filter field="base.servicio" eq="morgue"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
  {{/view}}

  {{#view id="cirugiasProgramadas"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="reprogramado.base._espacio"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}

      {{!-- {{filter field="base.tipoSolicitud" in="cirugia,procedimiento,imagenologia"}}
      {{filter field="base.requiereAnestesiologo" eq="si"}} --}}
      {{!-- {{filter field="base.tipoSolicitud" eq="='cirugia'" or="true"}}
      {{filter field="base.categoria" in="hemodinamia,endourologia,endoscopia" or="true"}} --}}
      {{filter field="base.tipoSolicitud" in="cirugia,cirugiaAmbulatoria,tococirugia,procedimiento,imagenologia"}}
      {{filter field="base.requiereAnestesiologo" eq="='si'"}}     
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,descartado,rechazado,suspendido,facturado,fragmentado',true)"}}

      {{filter field="base.estatus" in="nuevo,instalar,continuar,activo-controlado,activo-no-controlado"}}
      {{filter condition="=desde" field="base.fechaHoraCita" gt="=desde"}}
      {{filter condition="=hasta" field="base.fechaHoraCita" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="_servicio" type="expr" value="base._categoria||base._tipoSolicitud"}}
  {{/view}}  
  
  {{#view id="solicitudesCensoDiario"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','solicitado,programado,cancelado,rechazado,finalizado,suspendido,suspendidoEntregado,utilizado,ministrado,devuelto,facturado,fragmentado,enProcedimientoQx',true)"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
  {{/view}}
  
  {{#view id="programacionQuirofano"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="base.fechaHoraCita" exists="true"}}
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter field="base.tipoSolicitud" in="braquiterapia,endoscopia,endourologia,cirugia,cirugiaAmbulatoria,tococirugia,procedimiento"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="solicitado,programado,pre,trans,post"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
  {{/view}}

  {{#view id="programacionQuirurgicaDiaria"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{filter field="base.fechaHoraCita" gt="=moment().format('YYYY-MM-DD')"}}
      {{filter field="base.fechaHoraCita" lt="=moment().add(1,'day').format('YYYY-MM-DD')"}}
      {{filter field="base.tipoSolicitud" in="braquiterapia,endoscopia,endourologia,cirugia,cirugiaAmbulatoria,tococirugia,procedimiento"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="solicitado,programado,pre,trans,post"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="fecha" type="expr" value="=calc.format('date', base.fechaHoraCita, 'DD/MMM/YYYY h:mma')"}}
  {{/view}}

  {{#grid id="programacionQuirurgicaDiaria" name="Programación Quirúrgica Diaria" view="programacionQuirurgicaDiaria" pdfFontSize="6" filters="true" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="base._tipoSolicitud" label="Servicio" width="100"}}
    {{column field="reprogramado.base._espacio" label="Espacio" width="100"}}
    {{column field="fecha" label="Fecha" width="120"}}
    {{column field="_name" label="Cirugía Programada" width="500"}}
    {{column field="base._cirujano" label="Cirujano" width="150"}}
    {{column field="base._especialidadCirujano" label="Especialidad Cirujano" width="150"}}
    {{column field="base._servicioOrigen" label="Servicio Origen" width="150"}}
  {{/grid}}

  {{#view id="solicitudesEntregadas"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="base.servicio" eq="=servicio"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="entregado"}}
      {{filter condition="=desde" field="_moment.entregado.date" gt="=desde"}}
      {{filter condition="=hasta" field="_moment.entregado.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="entregado" type="expr" value="=control.solicitado-control.faltante"}}
  {{/view}}

  {{#view id="solicitudesCanceladas"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter condition="=servicio=='almacen'" field="base.tipoSolicitud" eq="material"}}
      {{!-- {{filter condition="=servicio=='ceye'" field="base.tipoSolicitud" eq="materialCeye"}} --}}
      {{filter condition="=servicio=='farmacia'" field="base.tipoSolicitud" in="medicamento,solucion,mezcla"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="cancelado"}}
      {{filter condition="=desde" field="_moment.cancelado.date" gt="=desde"}}
      {{filter condition="=hasta" field="_moment.cancelado.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
  {{/view}}
  
  {{#view id="solicitudesDevueltas"}}
    {{#find limit="-1"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter condition="=servicio=='almacen'" field="base.tipoSolicitud" eq="material"}}
      {{!-- {{filter condition="=servicio=='ceye'" field="base.tipoSolicitud" eq="materialCeye"}} --}}
      {{filter condition="=servicio=='farmacia'" field="base.tipoSolicitud" in="medicamento,solucion,mezcla"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="devuelto"}}
      {{filter condition="=desde" field="_moment.devuelto.date" gt="=desde"}}
      {{filter condition="=hasta" field="_moment.devuelto.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
  {{/view}}

  {{#view id="pendientes"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="persona"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenCronologico" field="_id" direction="asc"}}
      {{sort condition="=!@ordenCronologico" field="base.fechaHoraCita" direction="asc"}}
      {{sort condition="=!@ordenCronologico" field="_id" direction="desc"}}
      {{!-- {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}       --}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicio"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}      
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_updated.moment" in="proximo,pendiente,pendienteTercero"}} {{!-- exists="false" --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" exists="false"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=usuario" field="base.usuario" eq="=usuario"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=sinAnestesiologo" field="base.requiereAnestesiologo" eq="='no'"}}
      {{filter condition="=requiereAnestesiologo" field="base.requiereAnestesiologo" eq="=requiereAnestesiologo"}}
      {{filter condition="=requiereAnestesiologo" field="base.tipoSolicitud" in="procedimiento,imagenologia"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}
      {{filter condition="=user.onlyAssignedRequests" field="_access.user" in="=user.id"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
[.#if esSIC.]
    {{!-- {{calc field="semaforo" type="expr" value="=calc.semaphore(base.vencimiento,1,base.alerta)"}} --}}
[.else.]
    {{calc field="semaforo" type="expr" value="=calc.semaphore(base.vencimiento,12,base.alerta)"}}
[./if.]
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="pendientesAsignacionAnestesiologo"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="persona"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{!-- {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}       --}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._nota"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicio"}}
      {{search field="base._servicioOrigen"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="_updated.moment" in="solicitado,pendiente,programado,pre"}}
      {{filter field="base.tipoSolicitud" in="cirugia,cirugiaAmbulatoria,tococirugia,procedimiento,imagenologia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAnestesiologo" eq="='si'"}}
      {{filter field="info.base.anestesiologo" exists="=false"}}
      {{filter condition="=usuario" field="base.usuario" eq="=usuario"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="activosTodo"}}
    {{#find}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado,cerrado,cerradoConforme,cerradoTercero,cerradoCorregido,cerradoReparado',true)"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=subTipoSolicitud" field="base.subTipoSolicitud" eq="=subTipoSolicitud"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
    {{/find}}
    {{join source="persona" view="todo" as="join" id="persona.id"}}
    {{!-- {{calc2 field="_puesto" type="expr" value="=calc.getRef(join, 'detalle.altaEmpleado._puesto')||calc.getRef(join, 'detalle.solicitudEmpleo.base._puesto')"}} --}}
  {{/view}}

  {{#view id="_nonCompliance"}}
    {{#find limit="-1" flatten="true"}}
      {{!-- {{include field="_name" as="_name"}} --}}
      {{include field="base.servicio" as="servicio"}}
      {{include field="base.tipoSolicitud" as="tipoSolicitud"}}
      {{include field="base.tipoActividad" as="tipoActividad"}}
      {{include field="base.criticidadZona" as="criticidadZona"}}
      {{include field="info.base.vencimiento" as="vencimiento"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado,cerrado,cerradoConforme,cerradoTercero,cerradoCorregido,cerradoReparado',true)"}}
      {{filter field="base.tipoSolicitud" in="equipoMedico,mobiliario,adquisicionEquipo,adquisicionMobiliario,alimentacionFuncionarios,alimentacionPacientes,aseo,cafeteria,controlVectores,estacionamiento,ropa,residuosHospitalarios,maquinaDispensadora,moi,seguridad,elementoTecnologico,multiservicio"}}
      {{filter field="info.base.vencimiento" exists="=true"}}
      {{filter field="info.base.vencimiento" lt="=moment().format()"}}
      {{filter field="info.incumplimiento" exists="=false"}}
    {{/find}}
 {{/view}} 

  {{#view id="activos"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.requestType"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort condition="=ordenVencimiento" field="info.base.vencimiento" direction="asc"}}
      {{sort condition="=ordenHoraRequerida" field="base.fechaHoraRequerida" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base._nota"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="info.base._cama"}}
      {{search field="info.base._central"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
      {{search condition="=calc.isTrue(buscarDevolucion)" field="_moment.devolucion._doc"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
[.#if esSIC.]      
      {{search field="base._area"}}
[./if.]    
[.#if tieneServicios.]      
      {{filter field="base.servicio" in="=user.service"}}
[./if.]      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado,cerrado,cerradoConforme,cerradoTercero,cerradoCorregido,cerradoReparado',true)"}}
      {{filter condition="=conCita" field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicioInterconsultado" field="base.interconsulta.base.servicioInterconsultado" in="=user.service"}}
      {{filter condition="=servicio&&servicio!='alimentacion'" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=servicio=='alimentacion'" field="base.servicio" in="alimentacionPacientes,alimentacionFuncionarios"}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter condition="=verProgramacionQuirurgica" field="base.tipoSolicitud" in="cirugia,cirugiaAmbulatoria,tococirugia,procedimiento,imagenologia"}}
      {{filter condition="=verProgramacionQuirurgica" field="base.requiereAnestesiologo" eq="='si'"}}
      {{filter condition="=verEstatus=='pendiente'" field="_updated.moment" in="solicitado,pendiente"}}
      {{filter condition="=verEstatus=='programado'" field="_updated.moment" eq="programado"}}
      {{filter condition="=!@verEstatus" field="_updated.moment" nin="pendiente"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=subTipoSolicitud" field="base.subTipoSolicitud" eq="=subTipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=sinAnestesiologo" field="base.requiereAnestesiologo" eq="='no'"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=sinAlmacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=conAntimicrobiano" field="base.antimicrobiano" eq="si"}}
      {{filter condition="=sinAntimicrobiano" field="base.antimicrobiano" neq="si"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}
      {{filter condition="=user.onlyAssignedRequests" field="_access.user" in="=user.id"}}
      {{filter condition="=documentacionPendiente" field="control.subMoment" in="porEntregar,porCorregir"}}
      {{filter condition="=request" field="_created.request" eq="=request"}}
      {{filter condition="=misCandidatos" field="info.base.jefeInmediato" eq="=misCandidatos"}}      
      {{filter condition="=misSubordinados" field="base.servicio" in="reclutamientoSeleccion,contratacion,relacionesLaborales,capacitacion"}}
      {{filter condition="=misSubordinados" field="persona.jefeInmediato" eq="=misSubordinados"}}
      {{filter condition="=jefeInmediato" field="base.jefeInmediato" eq="=jefeInmediato"}}
      {{filter condition="=tipoActivoFijo" field="info.base.tipoActivoFijo" eq="=tipoActivoFijo"}}
      {{filter condition="=subTipoActivoFijo" field="info.base.subTipoActivoFijo" eq="=subTipoActivoFijo"}}


      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="semaforo" type="expr" value="=calc.semaphore(info.base.vencimiento,1,info.base.alerta)"}}
    {{calc field="requiereAnestesiologo" type="expr" value="=calc.isTrue(base.requiereAnestesiologo)"}}
    {{calc field="_name1" type="expr" value="=base.esConsultaExterna?_name.substr(0,_name.indexOf('Cita:')):requiereAnestesiologo&&_name.substr(0,_name.indexOf('Estatus Cirugía:'))"}}
    {{calc field="_name2" type="expr" value="=base.esConsultaExterna?_name.substr(_name.indexOf('Cita:')):requiereAnestesiologo&&_name.substr(_name.indexOf('Estatus Cirugía:'))"}}
    {{calc field="esCandidato" type="expr" value="=join._parent.type=='_user'&&calc.in('candidato', join.persona.rolesAcceso)"}}
    {{calc field="colorApegoPuesto" type="expr" value="=esCandidato&&fn('colorApegoPuesto', join.contexto.apegoPuesto)"}}
    {{calc field="_mensaje" type="expr" value="=fn('mensajeSolicitud', control.subMoment, control._mensaje, info.base.tiempoRequerido)"}}    
    {{calc field="definicion" type="expr" value="=calc.momentDefinition(control.subMoment)"}}
    {{calc field="esFormato2" type="expr" value="=calc.in(base.tipoSolicitud,['adquisicion'])"}}
  {{/view}}

  {{#view id="agendasActivas"}}
    {{#find limit="-1" flatten="true"}}
      {{include field="persona.nombreCompleto" as="nombre"}} 
      {{include field="info.base.desde" as="startDate"}} 
      {{include field="info.base.hasta" as="endDate"}} 
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado,cerrado,cerradoConforme,cerradoTercero,cerradoCorregido,cerradoReparado',true)"}}
      {{filter condition="=tipoActivoFijo" field="info.base.tipoActivoFijo" eq="=tipoActivoFijo"}}
      {{filter condition="=subTipoActivoFijo" field="info.base.subTipoActivoFijo" eq="=subTipoActivoFijo"}}
    {{/find}}
    {{calc field="text" type="expr" value="=calc.concatValueKey(nombre, calc.concat(moment(startDate).format('h:mm A')+'-'+moment(endDate).format('h:mm A')))"}}
  {{/view}}


  {{#view id="conformidad"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort condition="=ordenVencimiento" field="info.base.vencimiento" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base._nota"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
      {{search condition="=calc.isTrue(buscarDevolucion)" field="_moment.devolucion._doc"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" nin="pendiente,cancelado,descartado,rechazado,suspendido,suspendidoEntregado"}}
      {{filter field="control.subMoment" neq="ejecutadoTercero"}}
      {{filter field="base.tipoSolicitud" nin="conteoRopa"}}
      {{filter condition="=conCita" field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" in="=id"}}
      {{filter condition="=usuario" field="_created.user" eq="=usuario"}}
      {{filter condition="=servicioInterconsultado" field="base.interconsulta.base.servicioInterconsultado" in="=user.service"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}      
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=sinAlmacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=conAntimicrobiano" field="base.antimicrobiano" eq="si"}}
      {{filter condition="=sinAntimicrobiano" field="base.antimicrobiano" neq="si"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="semaforo" type="expr" value="=calc.semaphore(info.base.vencimiento,1,info.base.alerta)"}}
  {{/view}}

  {{#view id="misServiciosProgramados"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base._nota"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}

      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" eq="='programado'"}}
      {{filter field="base.servicio" in="=user.service" orInPresetPartOf="cfg.servicio"}}

      {{filter condition="=conCita" field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicioInterconsultado" field="base.interconsulta.base.servicioInterconsultado" in="=user.service"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}      
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=sinAlmacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=conAntimicrobiano" field="base.antimicrobiano" eq="si"}}
      {{filter condition="=sinAntimicrobiano" field="base.antimicrobiano" neq="si"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="_servicio" type="expr" value="=calc.presetName('cfg.servicio', base.servicio)"}}
  {{/view}}

  {{#view id="misServiciosHistoricos"}}
[.#if esSIC.]
    {{#find}}
[.else.]
    {{#find elastic="true"}}
[./if.]    
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base._nota"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}

      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}      
      {{filter field="_updated.moment" in="finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado"}}
      {{filter field="base.servicio" in="=user.service" orInPresetPartOf="cfg.servicio"}}

      {{filter condition="=conCita" field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicioInterconsultado" field="base.interconsulta.base.servicioInterconsultado" in="=user.service"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}      
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=sinAlmacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=conAntimicrobiano" field="base.antimicrobiano" eq="si"}}
      {{filter condition="=sinAntimicrobiano" field="base.antimicrobiano" neq="si"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="_servicio" type="expr" value="=calc.presetName('cfg.servicio', base.servicio)"}}
  {{/view}}

  {{#view id="activosSinOrden"}}
    {{#find}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{!-- {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}} --}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="base._nota"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_date" type="date"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado',true)"}}
      {{filter condition="=conCita" field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicioInterconsultado" field="base.interconsulta.base.servicioInterconsultado" in="=user.service"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=sinAlmacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=conAntimicrobiano" field="base.antimicrobiano" eq="si"}}
      {{filter condition="=sinAntimicrobiano" field="base.antimicrobiano" neq="si"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="activosPuedePasar"}}
    {{#find}}  {{!-- limit="100" --}}
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=hospitalizados" field="base.tipoEpisodio" eq="='hospitalizacion'"}}
      {{filter condition="=ambulatorios" field="base.tipoEpisodio" neq="='hospitalizacion'"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{!-- Por algun motivo no funciono con 2 join, tuve que meter el join en la otra vista --}}
    {{!-- {{join source="auxSaldo" view="saldoContexto" as="referencia" id="_id"}}     --}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="requiereAnestesiologo" type="expr" value="=calc.isTrue(base.requiereAnestesiologo)"}}
    {{calc field="_name1" type="expr" value="=base.esConsultaExterna?_name.substr(0,_name.indexOf('Cita:')):requiereAnestesiologo&&_name.substr(0,_name.indexOf('Estatus Cirugía:'))"}}
    {{calc field="_name2" type="expr" value="=base.esConsultaExterna?_name.substr(_name.indexOf('Cita:')):requiereAnestesiologo&&_name.substr(_name.indexOf('Estatus Cirugía:'))"}}
    {{!-- {{calc field="puedePasar" type="expr" value="=calc.getRef(join.persona, 'contexto.hospitalizacion.estaActivo')||join.saldo===0"}} --}}
  {{/view}}

  {{#view id="activosPuedePasarSinOrden"}}
[.#if esSIC.]
    {{#find}}
[.else.]
    {{#find elastic="true"}}
[./if.]    
      {{include field="_created.folio"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_created.date"}}
      {{include field="_created.user"}}
      {{include field="_updated.user"}}
      {{include field="_updated.moment"}}
      {{include field="_updated.reason"}}
      {{include field="_updated.reasonCommentaries"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{!-- {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}} --}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conAreaCritica" field="base.esAreaCritica" eq="=true"}}
      {{filter condition="=sinAreaCritica" field="base.esAreaCritica" exists="=false"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=hospitalizados" field="base.tipoEpisodio" eq="='hospitalizacion'"}}
      {{filter condition="=ambulatorios" field="base.tipoEpisodio" neq="='hospitalizacion'"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{!-- Por algun motivo no funciono con 2 join, tuve que meter el join en la otra vista --}}
    {{!-- {{join source="auxSaldo" view="saldoContexto" as="referencia" id="_id"}}     --}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{!-- {{calc field="puedePasar" type="expr" value="=calc.getRef(join.persona, 'contexto.hospitalizacion.estaActivo')||join.saldo===0"}} --}}
  {{/view}}

  {{#view id="activosCandidatos"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="control"}}
      {{include field="info"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="info.base._candidato"}}
      {{search field="info.base.claveCandidato" directSearchIfLength="9,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,confirmado,finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado',true)"}}
      {{filter condition="=conCita" field="base.fechaHoraCita" exists="=true"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="activosNombreCorto"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="control"}}
      {{include field="info"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado',true)"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{!-- {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}} --}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{editor display="base.nombreCorto"}}
  {{/view}}

  {{#view id="alta"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="control"}}
      {{include field="info"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado,suspendido,suspendidoEntregado,fragmentado',true)"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{!-- {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}} --}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=curso" field="base.curso" eq="=curso"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="activosSinSaldo"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="persona"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado',true)"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly||calc.round(control.porCobrar,2)"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="saldo" type="expr" value="=calc.round(control.porCobrar,2)"}}
  {{/view}}

  {{#view id="finalizados"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="control"}}
      {{include field="info"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{!-- {{search field="persona.fechaNacimiento"}} --}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="finalizado"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=tipoNota" field="base.nota._type" eq="=tipoNota"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
      {{filter condition="=codigoUrgencias" field="_attributes.1" eq="=codigoUrgencias"}}
      {{filter condition="=porCobrar" field="control.porCobrar" gte="=1"}}
      {{filter condition="=porPagar" field="control.porPagar" gte="=1"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="inactivos"}}    {{!-- collection="solicitudInactivo" --}}
[.#if esSIC.]
    {{#find}}
[.else.]
    {{#find elastic="true"}}
[./if.]    
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="control"}}
      {{include field="info"}}
      {{include field="_moment"}}
      {{include field="_moment2"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort condition="=ordenNombreCorto" field="base.nombreCorto" direction="asc"}}
      {{!-- {{sort field="base.fechaHoraCita" direction="asc"}} --}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="base._prioridad"}}      
      {{search field="base._servicioOrigen"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
      {{!-- {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}} --}}
      {{filter field="_updated.moment" in="finalizado,cancelado,descartado,rechazado,suspendido,suspendidoEntregado,facturado,fragmentado,cerrado,cerradoConforme,cerradoTercero,cerradoCorregido,cerradoReparado,incumplimiento,centinela,centinela"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicioInterconsultado" field="base.interconsulta.base.servicioInterconsultado" in="=user.service"}}
      {{filter condition="=servicio&&servicio!='alimentacion'" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=servicio=='alimentacion'" field="base.servicio" in="alimentacionPacientes,alimentacionFuncionarios"}}
      {{filter condition="=establecimiento" field="_created.establishment" eq="=establecimiento"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=situacionActual" field="control.situacionActual" eq="=situacionActual"}}
      {{filter condition="=tipoSuive" field="base.tipoSuive" exists="=true"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gt="=desde"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format()"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}     
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=conAntimicrobiano" field="base.antimicrobiano" eq="si"}}
      {{filter condition="=sinAntimicrobiano" field="base.antimicrobiano" neq="si"}}
      {{filter condition="=user.onlyAssignedRequests" field="_access.user" in="=user.id"}}
      {{filter condition="=enDGC" field="control.registroDGC" exists="=false"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_momentoActual" type="expr" value="=_moment[_updated.moment]._doc"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="puedeAltaEnfermeria"}}
    {{#pipeline}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,ministrado"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="control.porMinistrar" gt="=0" or="true"}}
      {{filter field="control.porUtilizar" gt="=0" or="true"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}

  {{#view id="porMinistrar"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="control.siguienteDosis" direction="asc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,ministrado"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="control.porMinistrar" gt="=0"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=ultimas24h" field="_date" gt="=moment().add(-24,'h').format()"}}
      {{filter condition="=ultimas48h" field="_date" gt="=moment().add(-48,'h').format()"}}
      {{filter condition="=ultimas72h" field="_date" gt="=moment().add(-72,'h').format()"}}
      {{filter condition="=ultimas96h" field="_date" gt="=moment().add(-96,'h').format()"}}
      {{filter condition="=ultimos7d"  field="_date" gt="=moment().add(-7,'d').format()"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="usuario" type="expr" value="=user.id"}}
    {{calc field="_usuario" type="expr" value="=user.name"}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="minutos" type="expr" value="=moment().diff(moment(control.siguienteDosis), 'minutes')"}}
    {{calc field="icono" type="expr" value="='record'"}}
    {{calc field="color" type="expr" value="=fn('semaforoMinistracion', minutos)"}}
    {{calc field="leyenda" type="expr" value="=fn('leyendaMinistracion', minutos)"}}
    {{calc field="fechaRequerida" type="expr" value="=control.siguienteDosis"}}
    {{calc field="horaRequerida" type="expr" value="=moment(control.siguienteDosis).format('DD/MMM hh:mma')"}}
  {{/view}}

  {{#view id="porDevolver"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="control.siguienteDosis" direction="asc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,ministrado,suspendidoEntregado,sobrante"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter condition="=esSobrante" field="_updated.moment" eq="sobrante"}}
      {{filter condition="=!@esSobrante" field="control.porMinistrar" gt="=0"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="usuario" type="expr" value="=user.id"}}
    {{calc field="_usuario" type="expr" value="=user.name"}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="minutos" type="expr" value="=moment().diff(moment(control.siguienteDosis), 'minutes')"}}
    {{calc field="icono" type="expr" value="='record'"}}
    {{calc field="color" type="expr" value="=fn('semaforoMinistracion', minutos)"}}
    {{calc field="leyenda" type="expr" value="=fn('leyendaMinistracion', minutos)"}}
    {{calc field="fechaRequerida" type="expr" value="=control.siguienteDosis"}}
    {{calc field="horaRequerida" type="expr" value="=moment(control.siguienteDosis).format('DD/MMM hh:mma')"}}
  {{/view}}

  {{#view id="porUtilizar"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="asc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,utilizado"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="control.porUtilizar" gt="=0"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="nombre" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="usuario" type="expr" value="=user.id"}}
    {{calc field="_usuario" type="expr" value="=user.name"}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
  {{/view}}

  {{#view id="enProceso"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="persona"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,solicitado,programado,cancelado,rechazado,finalizado,suspendido,suspendidoEntregado,utilizado,ministrado,devuelto,facturado,fragmentado,contratado',true)"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="semaforo" type="expr" value="=calc.semaphore(info.base.vencimiento,1,info.base.alerta)"}}
  {{/view}}

  {{#view id="sinExistencia"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="persona"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{search field="_updated._moment"}}
      {{search field="control._subMoment"}}
      {{filter field="base.estatus" in="sinExistencia"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=desde" field="_created.date" gt="=desde"}}
      {{filter condition="=hasta" field="_created.date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=base.estatus"}}
    {{calc field="_estatus" type="expr" value="=base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{calc field="semaforo" type="expr" value="=calc.semaphore(info.base.vencimiento,1,info.base.alerta)"}}
  {{/view}}

  {{#view id="enProcesoSinOrden"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="persona"}}
      {{include field="info"}}
      {{include field="control"}}
      {{!--       {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}} --}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,solicitado,programado,cancelado,rechazado,finalizado,suspendido,suspendidoEntregado,utilizado,ministrado,devuelto,facturado,fragmentado,contratado,enProcedimientoQx',true)"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="resumenAnestesiologoActivos"}}
    {{#find}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.categoria"}}
      {{include field="base.descripcion"}}
      {{!-- {{include field="base.fechaHoraCita"}} --}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="persona.id" eq="=id"}}
      
      {{filter field="base.tipoSolicitud" in="cirugia,cirugiaAmbulatoria,tococirugia,procedimiento,imagenologia"}}
      {{filter field="base.requiereAnestesiologo" eq="='si'"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,suspedido,rechazado,finalizado,descartado,utilizado,ministrado,devuelto,esterilizado,facturado',true)"}}

    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(calc.format('date', base.fechaHoraCita, 'DD/MMM/YYYY h:mma'), _updated._moment)"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="anestesiologoActivos"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="reprogramado"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}

      {{!-- para que use el indice: base.tipoSolicitud, _updated.moment, base.requiereAnestesiologo --}}
      {{filter field="base.tipoSolicitud" in="cirugia,cirugiaAmbulatoria,tococirugia,procedimiento,imagenologia"}}
      {{filter field="base.requiereAnestesiologo" eq="='si'"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,cancelado,rechazado,finalizado,suspendido,suspendidoEntregado,utilizado,ministrado,devuelto,facturado,fragmentado',true)"}}

      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="resumen" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="misActivos"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{!-- {{search field="persona.fechaNacimiento"}} --}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.prestadorServicios" in="=user.myUsers"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="activosPersona"}}
    {{#find limit="1000"}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="info"}}
      {{include field="control"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{search field="base._central"}}
      {{search field="base._solicitante"}}
      {{search field="base._especialidad"}}
      {{search field="base._especialidad3"}}
      {{search field="_created.folio" type="number"}}
      {{search field="info.base.folioReferencia"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=_id" field="persona.id" eq="=_id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}

      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=folio" field="_parent.folio" in="=folio" isNumber="true"}}
      {{filter condition="=solicitud" field="_created.folio" in="=solicitud" isNumber="true"}}
      {{filter condition="=fecha" field="_date" gte="=moment(fecha).format()"}}
      {{filter condition="=fecha" field="_date" lt="=moment(fecha).add(1,'day').format()"}}      
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="_especialidad" type="expr" value="=base._especialidad3||base._especialidad"}}
    {{calc field="estatus" type="expr" value="=calc.getRef(@_updated,'moment')||base.estatus"}}
    {{calc field="_estatus" type="expr" value="=calc.getRef(@_updated,'_moment')||base._estatus"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', estatus)"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
  {{/view}}

  {{#view id="continuarPersonaMuliple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="control"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="merma" type="expr" value="=calc.number(control&&control.merma)"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado-merma"}}
    {{calc field="pendiente" type="expr" value="=(neto>0)?neto:0"}}
    {{calc field="continuar" type="expr" value="=(pendiente)?'si':'no'"}}
  {{/view}}

  {{#view id="continuarAvanceMuliple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="cantidad" type="expr" value="=base.cantidad"}}
    {{calc field="continuar" type="expr" value="='no'"}}
  {{/view}}

  {{#view id="continuarMaterial" removeFields="materiales"}}
    {{#find limit="1000"}}
      {{include field="base.central"}}
      {{include field="base.surtirAlmacenEspecifico"}}
      {{include field="base.ubicacionEspecifica"}}
      {{include field="materiales"}}
      {{include field="base.prioridad"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=solicitud" field="_id" eq="=solicitud" isObjectId="true"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=sinCategorias" field="base.categoria" nin="=sinCategorias"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=subCategoria" field="base.subCategoria" eq="=subCategoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=surtirLoteEspecifico" field="base.surtirLoteEspecifico" eq="=surtirLoteEspecifico"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{unwind field="materiales"}}
    {{calc field="surtirAlmacenEspecifico" type="expr" value="=base.surtirAlmacenEspecifico"}}
    {{calc field="_surtirAlmacenEspecifico" type="expr" value="=base._surtirAlmacenEspecifico"}}
    {{calc field="cuenta" type="expr" value="=materiales.cuenta"}}
    {{calc field="_cuenta" type="expr" value="=materiales._cuenta"}}
    {{calc field="codigo" type="expr" value="=materiales.codigo"}}
    {{calc field="descripcion" type="expr" value="=materiales.descripcion"}}
    {{calc field="cantidad" type="expr" value="=materiales.cantidad"}}
    {{calc field="unidad" type="expr" value="=materiales.unidad"}}
    {{calc field="dosis" type="expr" value="=materiales.dosis"}}
    {{calc field="veces" type="expr" value="=materiales.veces"}}
    {{calc field="dosisTotal" type="expr" value="=dosis*veces"}}
    {{calc field="presentacion" type="expr" value="=materiales.presentacion"}}
    {{calc field="fraccionar" type="expr" value="=materiales.fraccionar"}}
    {{calc field="bioseguridadCantidad" type="expr" value="=calc.isTrue(fraccionar)?materiales.bioseguridadCantidad:null"}}
    {{calc field="bioseguridadUnidad" type="expr" value="=calc.isTrue(fraccionar)?materiales.bioseguridadUnidad:null"}}
    {{calc field="bioseguridadInfo" type="expr" value="=calc.isTrue(fraccionar)?calc.concat(materiales.bioseguridadCantidad, materiales._bioseguridadUnidad):'N/A'"}}
    {{#join2 source="mov" as="disponible" view="abiertoDisponible" id="codigo" key="codigo" value="cantidad"}}
      {{param cuenta="=cuenta"}}
      {{param codigo="=codigo"}}
    {{/join2}}
    {{calc2 field="abiertoDisponible" type="calc" value="=(fraccionar=='si')?Math.floor(disponible*presentacion*100)/100:null"}}
    {{calc2 field="surtirAbierto" type="calc" value="=calc.max(calc.number(abiertoDisponible), dosisTotal)||null"}}
    {{calc2 field="surtirCerrado" type="calc" value="=Math.ceil((dosisTotal-surtirAbierto)/presentacion)*presentacion"}}
    {{calc2 field="faltante" type="calc" value="=calc.missingOver(calc.sumArgs(surtirCerrado,surtirAbierto,-dosisTotal))"}}
    {{calc2 field="sobrante" type="calc" value="=calc.leftOver(calc.sumArgs(surtirCerrado,surtirAbierto,-dosisTotal))"}}
  {{/view}}

  {{#view id="explosionFarmacia"}}
    {{#find limit="1000"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.categoria"}}
      {{include field="base.descripcion"}}
      {{include field="base.central"}}
      {{include field="base.nota"}}
      {{include field="base.prioridad"}}
      {{include field="materiales"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.categoria" in="medicamentos,solucion,mezcla"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{unwind field="materiales"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_tipoSolicitud" type="expr" value="base._tipoSolicitud"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="codigo" type="expr" value="=materiales.codigo"}}
    {{calc field="descripcion" type="expr" value="=materiales.descripcion"}}
    {{calc field="cantidad" type="expr" value="=materiales.cantidad"}}
    {{calc field="tomas" type="expr" value="=materiales.veces"}}
    {{calc field="solicitado" type="expr" value="=materiales.cantidad*materiales.veces"}}
    {{calc field="entregado" type="expr" value="=materiales.cantidad*materiales.veces"}}
  {{/view}}

  {{#view id="continuarPorMinistrar"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_parent.name"}}
      {{include field="_updated.moment"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="control.siguienteDosis" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,ministrado"}}
      {{filter field="control.porMinistrar" gt="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=calc.concatEnter(_parent.name, moment(_created.date).format('DD/MMM hh:mma'))"}}
    {{calc field="usuario" type="expr" value="=user.id"}}
    {{calc field="_usuario" type="expr" value="=user.name"}}
    {{calc field="minutos" type="expr" value="=moment().diff(moment(control.siguienteDosis), 'minutes')"}}
    {{calc field="color" type="expr" value="=fn('semaforoMinistracion', minutos)"}}
    {{calc field="icono" type="expr" value="='record'"}}
    {{calc field="fechaRequerida" type="expr" value="=control.siguienteDosis"}}
    {{calc field="horaRequerida" type="expr" value="=moment(control.siguienteDosis).format('DD/MMM hh:mma')"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado"}}
    {{calc field="pendiente" type="expr" value="=control.porMinistrar"}}
  {{/view}}

  {{#view id="continuarPorDevolver"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_parent.name"}}
      {{include field="_updated.moment"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="control.siguienteDosis" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,ministrado,suspendidoEntregado,sobrante"}}
      {{filter condition="=esSobrante" field="_updated.moment" eq="sobrante"}}
      {{filter condition="=!@esSobrante" field="control.porMinistrar" gt="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="usuario" type="expr" value="=user.id"}}
    {{calc field="_usuario" type="expr" value="=user.name"}}
    {{calc field="minutos" type="expr" value="=moment().diff(moment(control.siguienteDosis), 'minutes')"}}
    {{calc field="color" type="expr" value="=fn('semaforoMinistracion', minutos)"}}
    {{calc field="icono" type="expr" value="='record'"}}
    {{calc field="fechaRequerida" type="expr" value="=control.siguienteDosis"}}
    {{calc field="horaRequerida" type="expr" value="=moment(control.siguienteDosis).format('DD/MMM hh:mma')"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado"}}
    {{calc field="pendiente" type="expr" value="=control.porMinistrar"}}
  {{/view}}

  {{#view id="continuarMinistrado"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_updated.moment"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="base"}}
      {{include field="articulo"}}
      {{include field="info"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,ministrado,devuelto,finalizado"}}
      {{filter field="control.ministrado" gt="=0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="usuario" type="expr" value="=user.id"}}
    {{calc field="_usuario" type="expr" value="=user.name"}}
    {{calc field="minutos" type="expr" value="=moment().diff(moment(control.siguienteDosis), 'minutes')"}}
    {{calc field="color" type="expr" value="=fn('semaforoMinistracion', minutos)"}}
    {{calc field="icono" type="expr" value="='record'"}}
    {{calc field="fechaRequerida" type="expr" value="=control.siguienteDosis"}}
    {{calc field="horaRequerida" type="expr" value="=moment(control.siguienteDosis).format('DD/MMM hh:mma')"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante"}}
    {{calc field="pendiente" type="expr" value="=control.ministrado*base.cantidad"}}
    {{calc field="lote" type="expr" value="=info.lote"}}
    {{calc field="vencimiento" type="expr" value="=info.vencimiento"}}
    {{calc field="costoUnitario" type="expr" value="=info.costoUnitario"}}
  {{/view}}

  {{#view id="continuarPorUtilizar"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_updated.moment"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,utilizado"}}
      {{filter field="control.porUtilizar" gt="=0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{!-- {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}} --}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado"}}
    {{calc field="pendiente" type="expr" value="=control.porUtilizar"}}
  {{/view}}

  {{#view id="continuarUtilizado"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_updated.moment"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="articulo"}}
      {{include field="info"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.moment" in="entregado,asignado,utilizado,devuelto,finalizado"}}
      {{filter field="control.utilizado" gt="=0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{!-- {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}} --}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante"}}
    {{calc field="pendiente" type="expr" value="=control.utilizado"}}
    {{calc field="lote" type="expr" value="=info.lote"}}
    {{calc field="vencimiento" type="expr" value="=info.vencimiento"}}
    {{calc field="costoUnitario" type="expr" value="=info.costoUnitario"}}
  {{/view}}

  {{#view id="autorizacionPersonaMuliple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="_parent.name"}}
      {{!-- {{include field="base._tipoSolicitud"}} --}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{!-- {{include field="persona"}} --}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="_updated.moment" eq="='pendiente'"}} {{!-- exists="false" --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" eq="=true"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=tipoControl" field="base.tipoControl" eq="=tipoControl"}}
      {{filter condition="=esAdulto" field="persona.edadActual" gte="=17"}}
      {{filter condition="=esMenor" field="persona.edadActual" lt="=17"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_tipoSolicitud" type="expr" value="base._tipoSolicitud"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="continuar" type="expr" value="='si'"}}
  {{/view}}


  {{#view id="aceptacionPersonaMuliple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_created.sid"}}
      {{include field="_created.short"}}
      {{include field="_parent.name"}}
      {{!-- {{include field="base._tipoSolicitud"}} --}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{include field="control.solicitado"}}
      {{!-- {{include field="persona"}} --}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="_updated.moment" eq="='pendiente'"}} {{!-- exists="false" --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.requiereAutorizacion" exists="false"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=codigo" field="base.codigo" eq="=codigo"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="tipoSolicitud" type="expr" value="base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="base._tipoSolicitud"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="cantidad" type="expr" value="=base.cantidad"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="continuar" type="expr" value="='si'"}}
  {{/view}}

  {{#view id="convocados" scopeParams="true"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="_date"}}
      {{include field="_parent"}}
      {{include field="_attributes"}}
      {{include field="persona"}}
      {{include field="base"}}
      {{include field="control"}}
      {{include field="info"}}
      {{filter field="base.asunto" eq="=asunto"}}
      {{sort field="_id" direction="asc"}}
    {{/find}}
    {{calc field="estatus" type="expr" value="_updated.moment"}}
    {{calc field="_estatus" type="expr" value="_updated._moment"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', _updated.moment)"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', _updated.moment)"}}
  {{/view}}

  {{#view id="listaAlumnosCurso" scopeParams="true"}}
    {{#find limit="1000"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{!-- {{include field="persona.correo"}} --}}
      {{include field="_created.date"}}
      {{include field="_date"}}
      {{filter field="base.curso" eq="=curso"}}
      {{filter field="_updated.moment" eq="=moment"}}
      {{sort field="persona.nombreCompleto" direction="asc"}}
    {{/find}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{!-- {{calc field="correo" type="expr" value="=persona.correo"}} --}}
    {{calc field="fecha" type="expr" value="=_date||_created.date"}}
    {{calc field="continuar" type="expr" value="=continuar"}}
  {{/view}}

  {{#view id="listaAlumnosCursoCapacitacion" scopeParams="true"}}
    {{#find limit="1000"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{!-- {{include field="persona.correo"}} --}}
      {{include field="_created.date"}}
      {{include field="_date"}}
      {{filter field="base.curso" eq="=curso"}}
      {{filter field="_updated.moment" eq="autorizado"}}
      {{sort field="persona.nombreCompleto" direction="asc"}}
    {{/find}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{!-- {{calc field="correo" type="expr" value="=persona.correo"}} --}}
    {{calc field="fecha" type="expr" value="=_date||_created.date"}}
    {{calc field="continuar" type="expr" value="=continuar"}}
  {{/view}}

  {{#view id="continuarEnLote" onlyMapped="true"}}
    {{#find limit="1000"}}
      {{include field="_name"}}
      {{include field="_parent.type"}}
      {{include field="_parent.id"}}
      {{include field="_created.date"}}
      {{include field="_created.short"}}
      {{include field="_created.request"}}
      {{include field="_created._request"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_updated.moment"}}
      {{include field="control.subMoment"}}
      {{include field="_date"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.subTipoSolicitud"}}
      {{include field="base.ubicacion"}}
      {{include field="base.ubicacionDestino"}}
      {{include field="info.subTipoResiduo"}}
      {{include field="info.contenido"}}
      {{include field="info.generador"}}
      {{include field="info.grupo"}}
      {{include field="info.peso"}}
      {{include field="info.base.tiempoEjecucion"}}
      {{include field="info.base.tiempoAlertaEjecucion"}}
      {{include field="info.base.puesto"}}
      {{include field="persona.id"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=desde" field="_date" gt="=moment(desde).format('YYYY-MM-DD')"}}
      {{filter condition="=hasta" field="_date" lt="=moment(hasta).add(1,'day').format('YYYY-MM-DD')"}}
      {{filter condition="=tipoSolicitud" field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=subTipoSolicitud" field="base.subTipoSolicitud" eq="=subTipoSolicitud"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=sinCategorias" field="base.categoria" nin="=sinCategorias"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=ubicacionDestino" field="base.ubicacionDestino" eq="=ubicacionDestino"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=formaEntrega" field="base.formaEntrega" eq="=formaEntrega"}}
      {{filter condition="=_puesto" field="info.base._puesto" eq="=_puesto"}}
      {{filter condition="=grupo" field="info.grupo" eq="=grupo"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="datosRH" as="join" id="persona.id"}}
[.#if esRH.]    
    {{join source="puesto" view="datosRH" as="puesto" id="info.base.puesto"}}
    {{map field="_datosPuesto" type="expr" value="=calc.concatEnter(puesto.base._formacionAcademicaPuesto, puesto.base._experienciaLaboralPuesto)"}}
[./if.]    
    {{map field="_id" type="expr" value="=_id"}}
    {{map field="_name" type="expr" value="=_name"}}
    {{map field="fecha" type="expr" value="=_date||_created.date"}}
    {{map field="persona" type="expr" value="=join._id"}}
    {{map field="_persona" type="expr" value="=join._name"}}
    {{map field="parentLink" type="expr" value="='/doc/'+_parent.type+'/'+_parent.id"}}
    {{map field="personaLink" type="expr" value="='/persona/verPersona?id='+persona.id+'&_name='+join._name"}}
    {{map field="ubicacion" type="expr" value="=base.ubicacion"}}
    {{map field="_ubicacion" type="expr" value="=base._ubicacion"}}
    {{map field="momento" type="expr" value="=_updated.moment"}}
    {{map field="_momento" type="expr" value="=_updated._moment"}}
    {{map field="subMomento" type="expr" value="=control.subMoment"}}
    {{map field="_subMomento" type="expr" value="=control._subMoment"}}
    {{map field="referencia" type="expr" value="=_created.short"}}
    {{map field="referencia2" type="expr" value="=calc.concatSlash(_updated._moment, control._subMoment)"}}
    {{map field="referenciaOrigen" type="expr" value="=_created.requestShort"}}
    {{map field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{map field="subTipoSolicitud" type="expr" value="=base.subTipoSolicitud"}}
    {{map field="subTipoResiduo" type="expr" value="=info.subTipoResiduo"}}
    {{map field="contenido" type="expr" value="=info.contenido"}}
    {{map field="generador" type="expr" value="=info.generador"}}
    {{map field="grupo" type="expr" value="=info.grupo"}}
    {{map field="_calificaciones" type="expr" value="=calc.concatPairsEnter('Formación Académica', join.detalle.calificaciones.formacionAcademica,'Experiencia', join.detalle.calificaciones.tiempoExperiencia)"}}
    {{map field="peso" type="expr" value="=info.peso"}}
    {{map field="nuevoVencimiento" type="expr" value="=(info.base.tiempoEjecucion&&_updated.moment=='programado')?moment().add(info.base.tiempoEjecucion,'minute').format():null"}}
    {{map field="nuevaAlerta" type="expr" value="=(info.base.tiempoAlertaEjecucion&&_updated.moment=='programado')?moment().add(info.base.tiempoAlertaEjecucion,'minute').format():null"}}
    {{map field="continuar" type="expr" value="='si'"}}
    {{map field="resumen" type="expr" value="=(base.tipoSolicitud=='reclutamientoSeleccion')?calc.concatEnter(join._name, calc.concatValueKey(calc.getRef(join, 'detalle.datosPersonales.base.clave'), join.detalle.datosPersonales.base.rfc), calc.getRef(join, 'detalle.datosPersonales.base._profesion'), calc.getRef(join, 'detalle.formacionAcademica.base._nivelAcademico'), calc.getRef(join, 'detalle.formacionAcademica.base._especialidad'), calc.concat('Nivel Medio Superior:', calc.concatValueKey(calc.getRef(join, 'detalle.formacionAcademica.base.nivelMedioSuperior.base.nombreFormacionAcademica'), calc.getRef(join, 'detalle.formacionAcademica.base.nivelMedioSuperior.base._documentoAcademico'))),calc.concat('Nivel Superior:', calc.concatValueKey(calc.getRef(join, 'detalle.formacionAcademica.base.nivelSuperior.base.nombreFormacionAcademica'), calc.getRef(join, 'detalle.formacionAcademica.base.nivelSuperior.base._documentoAcademico')), calc.getRef(join, 'detalle.formacionAcademica.base.nivelSuperior.base.cedulaProfesional')), calc.concatPairs('Tiempo Experiencia Puesto Aspira', calc.getRef(join, 'detalle.tiempoExperiencia.base._tiempoExperienciaPuestoAspira'))):null"}}
  {{/view}}

  {{#view id="solicitudesEmpleo" onlyMapped="true"}}
    {{#find limit="-1"}}
      {{include field="_created.date"}}
      {{include field="_created.short"}}
      {{include field="_created.requestShort"}}
      {{include field="_created.establishment"}}
      {{include field="_updated.moment"}}
      {{include field="control.subMoment"}}
      {{include field="_date"}}
      {{include field="base.reclutamientoSeleccion"}}
      {{include field="persona.id"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='reclutamientoSeleccion'"}}
      {{filter field="base.subTipoSolicitud" eq="='solicitudEmpleo'"}}
    {{/find}}
    {{join source="persona" view="datosRH" as="join" id="persona.id"}}
    {{map field="fecha" type="expr" value="=_date||_created.date"}}
    {{map field="persona" type="expr" value="=join._id"}}
    {{map field="_persona" type="expr" value="=join._name"}}
    {{map field="_puesto" type="expr" value="=base.reclutamientoSeleccion.base._puesto"}}
    {{map field="codigo" type="expr" value="=base.reclutamientoSeleccion.base.codigo"}}
    {{map field="_profesion" type="expr" value="=join.detalle.datosPersonales.base._profesion"}}
    {{map field="_nivelAcademico" type="expr" value="=join.detalle.formacionAcademica.base._nivelAcademico"}}
    {{map field="_especialidad" type="expr" value="=join.detalle.formacionAcademica.base._especialidad"}}
    {{map field="calificacionFormacionAcademica" type="expr" value="=join.detalle.calificaciones.formacionAcademica"}}
    {{map field="calificacionExperiencia" type="expr" value="=join.detalle.calificaciones.tiempoExperiencia"}}
    {{map field="_momento" type="expr" value="=_updated._moment"}}
    {{map field="_subMomento" type="expr" value="=control._subMoment"}}
  {{/view}}

  {{#view id="continuarMultiple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=sinCategorias" field="base.categoria" nin="=sinCategorias"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=subCategoria" field="base.subCategoria" eq="=subCategoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=surtirLoteEspecifico" field="base.surtirLoteEspecifico" eq="=surtirLoteEspecifico"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="merma" type="expr" value="=calc.number(control&&control.merma)"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado-merma"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="continuar" type="expr" value="=(!solicitado||faltante<solicitado)?'si':'no'"}}
  {{/view}}

  {{#view id="continuarMultipleDisponiblePersona"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=sinCategorias" field="base.categoria" nin="=sinCategorias"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=subCategoria" field="base.subCategoria" eq="=subCategoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=surtirLoteEspecifico" field="base.surtirLoteEspecifico" eq="=surtirLoteEspecifico"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{#join source="mov" view="disponibleMultiple" id="base.codigo" key="codigo" value="cantidad" as="disponible"}}
      {{param cuenta="=persona.id"}}
      {{param codigo="=base.codigo"}}
    {{/join}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="merma" type="expr" value="=calc.number(control&&control.merma)"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado-merma"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="continuar" type="expr" value="=(!solicitado||faltante<solicitado)?'si':'no'"}}
  {{/view}}

  {{#view id="continuarEntregaMultiple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=sinCategorias" field="base.categoria" nin="=sinCategorias"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=conOncologia" field="base.oncologia" eq="si"}}
      {{filter condition="=sinOncologia" field="base.oncologia" neq="si"}}
      {{filter condition="=conLisosomal" field="base.lisosomal" eq="si"}}
      {{filter condition="=sinLisosomal" field="base.lisosomal" neq="si"}}
      {{filter condition="=subCategoria" field="base.subCategoria" eq="=subCategoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=surtirLoteEspecifico" field="base.surtirLoteEspecifico" eq="=surtirLoteEspecifico"}}
      {{filter condition="=almacenCuraciones" field="base.surtirAlmacenEspecifico" exists="=false"}}
      {{filter condition="=almacenEspecifico" field="base.surtirAlmacenEspecifico" exists="=true"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="entregaParcial" type="expr" value="=calc.number(control&&control.entregaParcial)"}}
    {{calc field="utilizado" type="expr" value="=(calc.number(control&&control.ministrado)*base.cantidad)+calc.number(control&&control.utilizado)"}}
    {{calc field="merma" type="expr" value="=calc.number(control&&control.merma)"}}
    {{calc field="neto" type="expr" value="=solicitado-entregaParcial-utilizado-merma"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="continuar" type="expr" value="=(!solicitado||entregaParcial<solicitado)?'si':'no'"}}
  {{/view}}

  {{!-- {{#view id="devolverMultiple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=sinCategorias" field="base.categoria" nin="=sinCategorias"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=subCategoria" field="base.subCategoria" eq="=subCategoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
      {{filter condition="=surtirLoteEspecifico" field="base.surtirLoteEspecifico" eq="=surtirLoteEspecifico"}}
    {{/find}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="porUtilizar" type="expr" value="=calc.number(control&&control.porMinistrar||control&&control.porUtilizar)"}}
    {{calc field="utilizado" type="expr" value="=solicitado-faltante-porUtilizar"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante-utilizado"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="continuar" type="expr" value="=((faltante-utilizado)<solicitado)?'si':'no'"}}
  {{/view}} --}}
  
  {{#view id="puedePasarMultiple"}}
    {{#find limit="1000"}}
      {{include field="persona"}}
      {{include field="_created.date"}}
      {{include field="_parent.name"}}
      {{include field="base"}}
      {{include field="materiales"}}
      {{include field="componentes"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="_date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="desc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=nota" field="base.nota" eq="=nota"}}
      {{filter condition="=central" field="base.central" eq="=central"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=subCategoria" field="base.subCategoria" eq="=subCategoria"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{filter condition="=surtirDe" field="base.surtirDe" eq="=surtirDe"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="_persona" type="expr" value="=persona.nombreCompleto"}}
    {{calc field="solicitado" type="expr" value="=calc.number(control&&control.solicitado)"}}
    {{calc field="faltante" type="expr" value="=calc.number(control&&control.faltante)"}}
    {{calc field="neto" type="expr" value="=solicitado-faltante"}}
    {{calc field="central" type="expr" value="=base._central"}}
    {{calc field="cama" type="expr" value="=base._cama"}}
    {{calc field="puedePasar" type="expr" value="=fn('puedePasar', control, join.contexto, base)"}}
    {{calc field="continuar" type="expr" value="=(!solicitado||faltante<solicitado)?'si':'no'"}}
    {{calc field="_readOnly" type="expr" value="=join._readOnly"}}
    {{calc field="_flags" type="expr" value="=join._flags"}}
    {{calc field="noProgramada" type="expr" value="=base.tipoActividad=='noProgramada'"}}
    {{filter field="puedePasar" eq="=true"}}
  {{/view}}

  {{!-- removeFields lo puse como una medida adicional al proyect --}}
  {{#view id="porCobrarPersona" removeFields="base,contexto,persona,info"}} 
    {{#find limit="9999"}}
      {{include field="_name"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="control"}}
      {{include field="base.cantidad"}}
      {{include field="base.dosis"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.tipoEpisodio"}}
      {{include field="base.codigo"}}
      {{include field="base.descripcion"}}
      {{include field="base.descripcionLarga"}}
      {{include field="base.unidad"}}
      {{include field="base.importe"}}
      {{include field="base.precioPublico"}}
      {{include field="_created.date"}}
      {{include field="_created.branch"}}
      {{include field="_created._branch"}}
      {{include field="_created.service"}}
      {{include field="_created._service"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="asc"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}

      {{!-- {{filter field="control.porCobrar" gt="0"}} --}}
      {{filter field="control.porCobrar" neq="0"}}
      {{filter field="control.porCobrar" exists="=true"}}

      {{filter condition="=persona" field="persona.id" in="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
      {{!-- {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}} --}}
      {{filter condition="=incluirTipoSolicitud" field="base.tipoSolicitud" in="=incluirTipoSolicitud"}}
      {{filter condition="=excluirTipoSolicitud" field="base.tipoSolicitud" nin="=excluirTipoSolicitud"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="_name" type="expr" value="=calc.concatDash(fn('referenciaCobro', base.tipoSolicitud, base, _name), control._listaPrecios)"}}
    {{calc field="unidad" type="expr" value="=base.unidad"}}
    {{calc field="_unidad" type="expr" value="=base._unidad"}}
    {{calc field="tipoEpisodio" type="expr" value="=base.tipoEpisodio"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="=control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="cantidadServicio" type="expr" value="=(base.unidad=='servicio'||!calc.in(base.tipoSolicitud,['material','medicamento','solucion','mezcla']))?1:null"}}
    {{calc field="cantidadUtilizada" type="calc" value="=control.ministrado||control.utilizado||cantidadServicio"}}
    {{calc field="cantidadDosis" type="calc" value="=base.dosis*(cantidadUtilizada||1)"}}
    {{!-- {{calc field="cantidadUtilizadaDosis" type="calc" value="=cantidadDosis||cantidadUtilizada"}} --}}
    {{calc field="cantidadIndicada" type="calc" value="=cantidadDosis||base.cantidad"}}
    {{calc field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{calc field="iva" type="expr" value="=sat.iva"}}
    {{calc field="_iva" type="expr" value="=sat._iva"}}
    {{calc field="saldo" type="expr" value="=control.porCobrar"}}
    {{!-- {{calc field="gratuidad" type="expr" value="=(control.esGratis)?saldo:0"}} --}}
    {{!-- {{calc field="importe" type="expr" value="=control.porCobrar-gratuidad"}}
    {{calc field="nuevoSaldo" type="expr" value="=saldo-importe-gratuidad"}} --}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="importePublico" type="calc" value="=base.precioPublico*base.cantidad*cantidadUtilizada"}}
    {{calc field="subsidio" type="calc" value="=(importePublico)?importePublico-(control.porCobrar+control.cobrado):null"}}
    {{calc field="nuevoSaldo" type="expr" value="=saldo-importe"}}
    {{calc field="continuar" type="expr" value="='si'"}}
    {{sort field="fecha"}}
  {{/view}}

  {{#view id="requisicionesProgramadas" removeFields="base"}} 
    {{#find limit="-1"}}
      {{include field="_date"}}
      {{include field="base.requisicion"}}
      {{sort field="_date" direction="asc"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="requisicion"}}
      {{filter field="_updated.moment" eq="programado"}}
      {{filter condition="=codigo" field="base.codigo" eq="=codigo"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="fecha" type="expr" value="=_date"}}
    {{calc field="codigo" type="expr" value="=base.requisicion.base.codigo"}}
    {{calc field="descripcion" type="expr" value="=base.requisicion.base.descripcion"}}
    {{calc field="cantidad" type="expr" value="=base.requisicion.base.cantidad"}}
    {{calc field="areaRequirente" type="expr" value="=base.requisicion.base.areaRequirente"}}
    {{calc field="unidadProveedor" type="expr" value="=base.requisicion.base.unidadProveedor"}}
    {{calc field="_unidadProveedor" type="expr" value="=base.requisicion.base._unidadProveedor"}}
    {{calc field="factorCompra" type="expr" value="=base.requisicion.base.factorCompra"}}
    {{calc field="comentarios" type="expr" value="=base.requisicion.base.comentarios"}}
    {{calc field="continuar" type="expr" value="='si'"}}
  {{/view}}

  {{#view id="porCobrarCuentaPacienteAcum"}}
    {{#pipeline}}
      {{filter field="base.tipoSolicitud" eq="='nota'"}}
      {{filter field="base.servicioOrigen" eq="='cuentaPaciente'"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="control.porCobrar" gt="0"}}
      {{filter field="persona.id" eq="=persona"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
      {{group field="control.porCobrar" type="sum" as="importe"}}
    {{/pipeline}}
  {{/view}}

  {{#view id="porAplicarPersona"}}
    {{#find limit="1000"}}
      {{include field="_name"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="persona"}}
      {{include field="control"}}
      {{include field="_created"}}
      {{include field="_parent.name"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="asc"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="control.porCobrar" gt="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="solicitud" type="expr" value="=_parent.name"}}
    {{calc field="_solicitante" type="expr" value="=calc.concat4(base._solicitante, base._especialidad2)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="saldo" type="expr" value="=control.porCobrar"}}
    {{calc field="importe" type="expr" value="=0"}}
    {{calc field="continuar" type="expr" value="='no'"}}
  {{/view}}

  {{#view id="porCobrarPersonaSiNo"}}
    {{#find limit="1000"}}
      {{include field="_name"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="persona"}}
      {{include field="control"}}
      {{include field="_created"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="asc"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="control.porCobrar" gt="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=subMomento" field="control.subMoment" eq="=subMomento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="saldo" type="expr" value="=control.porCobrar"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="continuar" type="expr" value="='no'"}}
    {{sort field="fecha"}}
  {{/view}}

{{!--  {{#view id="estadoCuentas" mergeSource="notaCobro" mergeView="estadoCuentas" mergeSort="fecha" mergeSource2="notaCancelacionCobro" mergeView2="estadoCuentas" mergeSort2="fecha"}}
    {{#find limit="-1"}}
      {{include field="sat"}}
      {{include field="control"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.categoria"}}
      {{include field="base.descripcion"}}
      {{include field="base.nota._type"}}
      {{include field="_created"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_created.date" direction="asc"}}
      {{filter field="_updated.moment" exists="true"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="base.nota._type" neq="notaCierreCuenta"}}
      {{filter field="control.importe" exists="true"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
    {{/find}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="esAbono" type="expr" value="=base.tipoSolicitud=='anticipo'"}}
    {{calc field="cargo" type="expr" value="=!esAbono?control.importe:null"}}
    {{calc field="abono" type="expr" value="=esAbono?control.importe:null"}}
  {{/view}} --}}

 {{!-- removeFields lo puse como una medida adicional al proyect --}}
 {{#view id="estadoCuentas" removeFields="base,contexto,persona,info" appendHistory="false"}}
    {{#find limit="-1"}}
      {{include field="_name"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="control"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.categoria"}}
      {{include field="base.descripcion"}}
      {{include field="base.dosis"}}
      {{include field="base.unidad"}}
      {{include field="base.cantidad"}}
      {{include field="base.precio"}}
      {{include field="base.precioPublico"}}
      {{include field="base.nota._type"}}
      {{include field="_created.date"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="_date" direction="asc"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="base.precioPublico" exists="true" or="true"}}
      {{filter field="control.importe" exists="true" or="true"}}
      {{filter field="control._hide" neq="=true"}}
      {{filter field="base.tipoSolicitud" nin="ordenPago"}}
      {{filter condition="=persona" field="persona.id" in="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="_name" type="expr" value="=calc.concatDash(_name, control._listaPrecios)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{calc field="esCargo" type="expr" value="=base.tipoSolicitud!='anticipo'"}}
    {{calc field="esAbono" type="expr" value="=!esCargo"}}
    {{calc field="importe" type="calc" value="=control.importe"}}
    {{calc field="porCobrar" type="calc" value="=control.porCobrar"}}
    {{calc field="cobrado" type="calc" value="=importe-porCobrar"}}
    {{calc field="porPagar" type="calc" value="=control.porPagar"}}
    {{calc field="pagado" type="calc" value="=importe-porPagar"}}
    {{calc field="cargo" type="expr" value="=(esCargo)?importe:pagado"}}
    {{calc field="abono" type="expr" value="=(esAbono)?importe:cobrado"}}
    {{!-- {{calc field="gratuidad" type="calc" value="=(control.esGratis)?porCobrar:0"}}
    {{calc field="saldo" type="expr" value="=(esCargo)?porCobrar-gratuidad:porPagar"}}     --}}
    {{calc field="saldo" type="expr" value="=(esCargo)?porCobrar:porPagar"}}    
    {{sort field="fecha"}}
  {{/view}}

 {{#view id="estadoCuentas2" removeFields="base,contexto,persona,info" appendHistory="false"}}
    {{#find limit="-1"}}
      {{include field="_name"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="control"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.categoria"}}
      {{include field="base.descripcion"}}
      {{include field="base.tipoEpisodio"}}
      {{include field="base.dosis"}}
      {{include field="base.unidad"}}
      {{include field="base.cantidad"}}
      {{include field="base.precio"}}
      {{include field="base.precioPublico"}}
      {{include field="base.nota._type"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{!-- si se quita sale mas rapido y creo que no se necesita, porque abajo ya tiene un sort --}}
      {{!-- {{sort field="_date" direction="asc"}}  --}}

      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="base.precioPublico" exists="true" or="true"}}
      {{filter field="control.importe" exists="true" or="true"}}
      {{filter field="control._hide" neq="=true"}}
      {{filter field="base.tipoSolicitud" nin="ordenPago"}}
      {{filter condition="=persona" field="persona.id" in="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="_name" type="expr" value="=calc.concatDash(_name, control._listaPrecios)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{calc field="esPrecioPorDosis" type="expr" value="=calc.in(base.tipoSolicitud, ['medicamento','solucion','mezcla'])"}}
    {{calc field="esAcreedor" type="expr" value="=calc.in(base.tipoSolicitud, ['cargoAcreedor','creditoAcreedor','disposicionFondeo'])"}}
    {{calc field="esCargo" type="expr" value="=base.tipoSolicitud!='anticipo'"}}
    {{calc field="esAbono" type="expr" value="=!esCargo"}}
    {{calc field="importe" type="calc" value="=calc.number(control.importe)"}}
    {{calc field="unidadMinima" type="expr" value="=base.unidad"}}
    {{calc field="_unidadMinima" type="expr" value="=base._unidad"}}
    {{calc field="cantidadServicio" type="expr" value="=(base.unidad=='servicio'||!calc.in(base.tipoSolicitud,['material','medicamento','solucion','mezcla']))?1:null"}}
    {{calc field="cantidadUtilizada" type="calc" value="=control.ministrado||control.utilizado||cantidadServicio"}}
    {{calc field="cantidadDosis" type="calc" value="=base.dosis*(cantidadUtilizada||1)"}}
    {{!-- {{calc field="cantidadUtilizadaDosis" type="calc" value="=cantidadDosis||cantidadUtilizada"}} --}}
    {{calc field="cantidadIndicada" type="calc" value="=cantidadDosis||base.cantidad"}}
    {{calc field="precioUnitario" type="calc" value="=esAcreedor?control.importeBase:(importe/(cantidadUtilizada||cantidadIndicada))"}}
    {{calc field="importePublico" type="calc" value="=base.precioPublico*cantidadUtilizada*(esPrecioPorDosis?base.cantidad:1)"}}
    {{calc field="subsidio" type="calc" value="=(importePublico)?importePublico-importe:null"}}
    {{calc field="porCobrar" type="calc" value="=control.porCobrar"}}
    {{calc field="cobrado" type="calc" value="=importe-porCobrar"}}
    {{calc field="porPagar" type="calc" value="=control.porPagar"}}
    {{calc field="pagado" type="calc" value="=importe-porPagar"}}
    {{calc field="cargo" type="expr" value="=esCargo?importe:pagado"}}
    {{calc field="abono" type="expr" value="=esAcreedor?pagado:(esAbono?importe:cobrado)"}}
    {{!-- {{calc field="gratuidad" type="calc" value="=(control.esGratis)?porCobrar:0"}}
    {{calc field="saldo" type="expr" value="=(esCargo)?porCobrar-gratuidad:porPagar"}}     --}}
    {{calc field="saldo" type="expr" value="=esAcreedor?porPagar:(esCargo?porCobrar:porPagar)"}}
    {{sort field="fecha" having="cantidadUtilizada"}}
  {{/view}}

  {{#view id="cierreCuenta" appendHistory="false"}}
    {{#find limit="9999"}}
      {{include field="_name"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona.nivelSocioeconomico"}}
      {{include field="base.codigo"}}
      {{include field="base.codigos"}}
      {{include field="base.cantidad"}}
      {{include field="base.veces"}}
      {{include field="base.dosis"}}
      {{include field="control"}}
      {{include field="_created"}}
      {{sort field="_date" direction="asc"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{!-- {{filter field="base.tipoEpisodio" neq="ambulatorio"}} --}}
      {{filter field="control.porCobrar" gt="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{!-- {{reprocess type="cierreCuenta" id="=persona"}} --}}
    {{calc field="_name" type="expr" value="=calc.concatDash(_name, control._listaPrecios)"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="codigos" type="expr" value="=base.codigos"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{!-- {{calc field="nivelSocioeconomico" type="expr" value="=persona.nivelSocioeconomico||calc.lookupConfigException('general', 'nivelSocioeconomico')||'2'"}} --}}
    {{!-- creo que no es buena reprocesar aqui, mas bien hay que hacerlo en otra nota, esta es unicamente es para concentrar --}}    
    {{!-- {{calc field="gratis" type="expr" value="=control.esGratis?'si':'no'"}}
    {{calc field="gratuidad" type="expr" value="=control.esGratis?importe:0"}} --}}
    {{!-- {{calc field="montoPaciente" type="expr" value="=importe-gratuidad"}} --}}
    {{calc field="montoPaciente" type="expr" value="=importe"}}
    {{calc field="continuar" type="expr" value="='si'"}}
    {{sort field="fecha"}}
  {{/view}}

  {{#view id="actualizacionSaldos" appendHistory="false"}}
    {{#find limit="9999"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona.nivelSocioeconomico"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.codigo"}}
      {{include field="base.codigos"}}
      {{include field="base.cantidad"}}
      {{include field="base.veces"}}
      {{include field="base.dosis"}}
      {{include field="control"}}
      {{include field="materiales"}}
      {{include field="_created"}}
      {{sort field="_date" direction="asc"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{!-- aqui puede hacer un OR para ver si fue modificado previamente, porque si se mueve a nivel 0 ya no hay forma de leerlo de vuelta --}}
      {{filter field="control.porCobrar" gt="0" or="true"}}
      {{filter field="control.porMinistrar" gt="0" or="true"}}
      {{filter field="control.porUtilizar" gt="0" or="true"}}      
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{reprocess type="actualizacionSaldos" id="=persona"}} {{!-- request="=solicitud" --}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="codigos" type="expr" value="=base.codigos"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="nivelSocioeconomico" type="expr" value="=persona.nivelSocioeconomico||calc.lookupConfigException('general', 'nivelSocioeconomico')||'2'"}}
    {{calc field="continuar" type="expr" value="='si'"}}
    {{sort field="fecha"}}
  {{/view}}

  {{#view id="ajustePrecios" appendHistory="false"}}
    {{#find limit="9999"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona.nivelSocioeconomico"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.codigo"}}
      {{include field="base.codigos"}}
      {{include field="base.cantidad"}}
      {{include field="base.veces"}}
      {{include field="base.dosis"}}
      {{include field="control"}}
      {{include field="materiales"}}
      {{include field="_created"}}
      {{sort field="_date" direction="asc"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="control.porCobrar" gt="0" or="true"}}
      {{filter field="control.porMinistrar" gt="0" or="true"}}
      {{filter field="control.porUtilizar" gt="0" or="true"}}      
      {{filter field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{reprocess type="actualizacionPrecios" id="=persona" price="=listaPrecios"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="codigos" type="expr" value="=base.codigos"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="nivelSocioeconomico" type="expr" value="=persona.nivelSocioeconomico||calc.lookupConfigException('general', 'nivelSocioeconomico')||'2'"}}
    {{calc field="continuar" type="expr" value="='si'"}}
    {{sort field="fecha"}}
  {{/view}}

  {{#view id="ajustePreciosHospitalizacion2" appendHistory="false"}}
    {{#find limit="9999"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona.nivelSocioeconomico"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.servicioOrigen"}}
      {{include field="base.codigo"}}
      {{include field="base.codigos"}}
      {{include field="base.cantidad"}}
      {{include field="base.veces"}}
      {{include field="base.dosis"}}
      {{include field="control"}}
      {{include field="materiales"}}
      {{include field="_created"}}
      {{sort field="_date" direction="asc"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="base.servicioOrigen" neq="urgencias"}}
      {{filter field="control.porCobrar" gt="0"}}
      {{filter field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{reprocess type="actualizacionPrecios" id="=persona" price="=listaPrecios"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="codigos" type="expr" value="=base.codigos"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="nivelSocioeconomico" type="expr" value="=persona.nivelSocioeconomico||calc.lookupConfigException('general', 'nivelSocioeconomico')||'2'"}}
    {{calc field="continuar" type="expr" value="=(base.servicioOrigen=='urgencias')?'no':'si'"}}
    {{sort field="fecha"}}
  {{/view}}

 {{#view id="ajustePreciosUrgencias2" appendHistory="false"}}
    {{#find limit="9999"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona.nivelSocioeconomico"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.servicioOrigen"}}
      {{include field="base.codigo"}}
      {{include field="base.codigos"}}
      {{include field="base.cantidad"}}
      {{include field="base.veces"}}
      {{include field="base.dosis"}}
      {{include field="control"}}
      {{include field="materiales"}}
      {{include field="_created"}}
      {{sort field="_date" direction="asc"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="base.servicioOrigen" eq="urgencias"}}
      {{filter field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{reprocess type="actualizacionPrecios" id="=persona" price="=listaPrecios"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="codigos" type="expr" value="=base.codigos"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="nivelSocioeconomico" type="expr" value="=persona.nivelSocioeconomico||calc.lookupConfigException('general', 'nivelSocioeconomico')||'2'"}}
    {{calc field="continuar" type="expr" value="=(base.servicioOrigen=='urgencias')?'no':'si'"}}
    {{sort field="fecha"}}
  {{/view}}

  {{#view id="ajustePreciosAmbulatorio2" appendHistory="false"}}
    {{#find limit="9999"}}
      {{include field="_date"}}
      {{include field="persona.id"}}
      {{include field="persona.nombreCompleto"}}
      {{include field="persona.clave"}}
      {{include field="persona.nivelSocioeconomico"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.servicioOrigen"}}
      {{include field="base.codigo"}}
      {{include field="base.codigos"}}
      {{include field="base.cantidad"}}
      {{include field="base.veces"}}
      {{include field="base.dosis"}}
      {{include field="control"}}
      {{include field="materiales"}}
      {{include field="_created"}}
      {{sort field="_date" direction="asc"}}
      {{filter condition="=tipoEpisodio" field="base.tipoEpisodio" eq="=tipoEpisodio"}}
      {{filter condition="=desde" field="_date" gte="=desde"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,rechazado',true)"}}
      {{filter field="control.porCobrar" gt="0"}}
      {{filter field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{reprocess type="actualizacionPrecios" id="=persona" price="=listaPrecios"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="control.horaMinistracion||control.horaUtilizacion||_date||_created.date"}}
    {{calc field="codigo" type="expr" value="=base.codigo"}}
    {{calc field="codigos" type="expr" value="=base.codigos"}}
    {{calc field="importe" type="expr" value="=control.porCobrar"}}
    {{calc field="nivelSocioeconomico" type="expr" value="=persona.nivelSocioeconomico||calc.lookupConfigException('general', 'nivelSocioeconomico')||'2'"}}
    {{calc field="continuar" type="expr" value="=(base.servicioOrigen=='urgencias')?'no':'si'"}}
    {{sort field="fecha"}}
  {{/view}}

  {{#view id="porPagarPersona"}}
    {{#find limit="-1"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="persona"}}
      {{include field="control"}}
      {{include field="_created"}}
      {{include field="base.vencimiento"}}
      {{include field="base.tipoSolicitud"}}
      {{sort field="_date" direction="asc"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente',true)"}}
      {{filter field="control.porPagar" exists="=true"}}
      {{filter field="control.porPagar" neq="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="vencimiento" type="expr" value="=base.vencimiento"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="saldo" type="expr" value="=control.porPagar"}}
    {{calc field="importe" type="expr" value="=control.porPagar"}}
    {{calc field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{calc field="iva" type="expr" value="=sat.iva"}}
    {{calc field="_iva" type="expr" value="=sat._iva"}}
    {{calc field="continuar" type="expr" value="=(importe)?'si':'no'"}}
  {{/view}}

  {{#view id="porPagarPendiente"}}
    {{#find limit="-1"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="persona"}}
      {{include field="control"}}
      {{include field="_created"}}
      {{include field="base.vencimiento"}}
      {{include field="base.tipoSolicitud"}}
      {{sort field="_date" direction="asc"}}
      {{filter field="_updated.moment" eq="='pendiente'"}}
      {{filter field="control.porPagar" exists="=true"}}
      {{filter field="control.porPagar" neq="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="vencimiento" type="expr" value="=base.vencimiento"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="saldo" type="expr" value="=control.porPagar"}}
    {{calc field="importe" type="expr" value="=control.porPagar"}}
    {{calc field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{calc field="iva" type="expr" value="=sat.iva"}}
    {{calc field="_iva" type="expr" value="=sat._iva"}}
    {{calc field="continuar" type="expr" value="=(importe)?'si':'no'"}}
  {{/view}}

  {{#view id="porPagarIntereses"}}
    {{#find limit="1000"}}
      {{include field="_date"}}
      {{include field="sat"}}
      {{include field="persona"}}
      {{include field="control"}}
      {{include field="info.devengadoHasta"}}
      {{include field="_created"}}
      {{include field="base.vencimiento"}}
      {{include field="base.tipoSolicitud"}}
      {{sort field="_date" direction="asc"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente',true)"}}
      {{filter field="control.porPagar" exists="=true"}}
      {{filter field="control.porPagar" neq="0"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
      {{filter condition="=servicio" field="base.servicio" eq="=servicio" orInPresetPartOf="cfg.servicio"}}
      {{filter condition="=momento" field="_updated.moment" eq="=momento"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="vencimiento" type="expr" value="=base.vencimiento"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="moment(_date||_created.date).format('YYYY-MM-DD')"}}
    {{calc field="saldo" type="expr" value="=control.porPagar"}}
    {{calc field="tasa" type="expr" value="=control.tasa"}}
    {{calc field="tipoSolicitud" type="expr" value="=base.tipoSolicitud"}}
    {{calc field="_tipoSolicitud" type="expr" value="=base._tipoSolicitud"}}
    {{calc field="devengadoDesde" type="expr" value="=calc.getRef(@info,'devengadoHasta')||fecha"}}
    {{calc field="devengadoHasta" type="expr" value="=_params.fechaPago"}}
    {{calc field="dias" type="expr" value="=calc.diffDays(devengadoDesde, devengadoHasta)"}}
    {{calc field="intereses" type="expr" value="=saldo*(tasa/100/360)*dias"}}
    {{calc field="retencionIsr" type="expr" value="=saldo*(0.97/100/360)*dias"}}
    {{calc field="totalAPagar" type="expr" value="=intereses-retencionIsr"}}
    {{calc field="continuar" type="expr" value="=(totalAPagar)?'si':'no'"}}
  {{/view}}

  {{#view id="anticiposPorAplicar"}}
    {{#find limit="-1"}}
      {{include field="_date"}}
      {{include field="_created"}}
      {{include field="control"}}
      {{include field="base.nota"}}
      {{sort field="_date" direction="asc"}}
      {{filter field="control.porPagar" gt="0"}}
      {{filter field="base.tipoSolicitud" eq="='anticipo'"}}
      {{filter condition="=id" field="persona.id" eq="=id"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="referencia" type="expr" value="=base._nota"}}
    {{calc field="ahora" type="expr" value="=moment().format()"}}
    {{calc field="fecha" type="expr" value="_date||_created.date"}}
    {{calc field="saldo" type="expr" value="=control.porPagar"}}
    {{calc field="importe" type="expr" value="=control.porPagar"}}
  {{/view}}

  {{#view id="resumenActivos"}}
    {{#find}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{include field="base.tipoSolicitud"}}
      {{include field="base.categoria"}}
      {{include field="base.descripcion"}}
      {{!-- {{include field="base.fechaHoraCita"}} --}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','cancelado,suspedido,rechazado,finalizado,descartado,utilizado,ministrado,devuelto,esterilizado,facturado',true)"}}
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(calc.format('date', base.fechaHoraCita, 'DD/MMM/YYYY h:mma'), _updated._moment)"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="resumenTxDx"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_updated"}}
      {{include field="control"}}
      {{!-- {{include field="base.tipoSolicitud"}}
      {{!-- {{include field="base.categoria"}} --}}
      {{!-- {{include field="base.descripcion"}}
      {{sort field="_updated.date" direction="desc"}}
      {{filter field="_created.service" in="laboratorio,imagenologia,patologia,hemodinamia,endoscopia,endourologia,electrodiagnostico,medicinaNuclear"}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="_updated.date" gte="=moment().add(-1, 'months').format('YYYY-MM-DD')"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="finalizado"}}
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(calc.format('date', _updated.date, 'DD/MMM/YYYY'), _updated._moment)"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="resumenAnticiposPorAplicar"}}
    {{#find}}
      {{include field="_date"}}
      {{include field="base._tipoSolicitud"}}
      {{include field="control.porPagar"}}
      {{sort field="_date" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="persona.id" eq="=id"}}      
      {{filter field="base.tipoSolicitud" eq="anticipo"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,cancelado,rechazado',true)"}}
      {{filter field="control.porPagar" exists="true"}}
      {{filter field="control.porPagar" neq="0"}}
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(base._tipoSolicitud, calc.format('date', _date, 'DD/MMM/YYYY'))"}}
    {{calc field="nombre" type="expr" value="=calc.format('number', control.porPagar, 'currency')"}}
  {{/view}}

  {{#view id="resumenPorCobrar"}}
    {{#find}}
      {{include field="_date"}}
      {{include field="control.porCobrar"}}
      {{sort field="_date" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="persona.id" eq="=id"}}      
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente,cancelado,rechazado',true)"}}
      {{filter field="control.porCobrar" exists="true"}}
      {{filter field="control.porCobrar" neq="0"}}
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(calc.format('date', _date, 'DD/MMM/YYYY'), calc.format('number', control.porCobrar, 'currency'))"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="resumenPorPagarPendiente"}}
    {{#find}}
      {{include field="_date"}}
      {{include field="control.porPagar"}}
      {{sort field="_date" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="_updated.moment" eq="='pendiente'"}}
      {{filter field="control.porPagar" exists="true"}}
      {{filter field="control.porPagar" neq="0"}}
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(calc.format('date', _date, 'DD/MMM/YYYY'), calc.format('number', control.porPagar, 'currency'))"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="resumenPorPagarProgramado"}}
    {{#find}}
      {{include field="_date"}}
      {{include field="control.porPagar"}}
      {{sort field="_date" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{filter field="persona.id" eq="=id"}}
      {{filter field="_updated.moment" eq="='programado'"}}
      {{filter field="control.porPagar" exists="true"}}
      {{filter field="control.porPagar" neq="0"}}
    {{/find}}
    {{calc field="etiqueta" type="expr" value="=calc.concat(calc.format('date', _date, 'DD/MMM/YYYY'), calc.format('number', control.porPagar, 'currency'))"}}
    {{calc field="nombre" type="expr" value="=_name"}}
  {{/view}}

  {{#view id="pendientesEstatus"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base.estatus"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="base.duracionCita"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{!-- {{search field="persona.fechaNacimiento"}} --}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{filter field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter field="base.estatus" eq="=estatus"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
    {{/find}}    
    {{calc field="color" type="expr" value="=fn('solicitudColor', base.estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', base.estatus)"}}
  {{/view}}

  {{!-- {{#view id="consultaExternaPuedePasar"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base.estatus"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="base.duracionCita"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="persona.fechaNacimiento"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="consultaExterna"}}
    {{/find}}
    {{mergeSql table="orden" key="solicitud" value="porCobrar" id="=_id"}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="porCobrar" type="calc" value="=0"}}
    {{calc field="enAtencion" type="expr" value="=join.contexto.consultaExterna.estaActivo"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', base.estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', base.estatus)"}}
    {{calc2 field="puedePasar" type="expr" value="=!porCobrar&&!enAtencion"}}
  {{/view}} --}}

  {{!-- {{#view id="programadosPuedePasar"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base.servicio"}}
      {{include field="base.estatus"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="base.duracionCita"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{search field="persona.fechaNacimiento"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{filter field="base.estatus" eq="programado"}}
      {{filter field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
    {{/find}}
    {{mergeSql table="orden" key="solicitud" value="porCobrar" id="=_id"}}
    {{join source="persona" view="contexto" as="join" id="persona.id"}}
    {{calc field="nombre" type="expr" value="=join._name"}}
    {{calc field="cuentaPaciente" type="expr" value="=join.contexto.hospitalizacion.estaActivo"}}
    {{calc field="enAtencion" type="expr" value="=calc.getRef(join.contexto, base.servicio+'.estaActivo')&&(calc.getRef(join.contexto, base.servicio+'.momento')!='programado')"}}
    {{calc field="porCobrar" type="calc" value="=0"}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', base.estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', base.estatus)"}}
    {{calc2 field="puedePasar" type="expr" value="=(cuentaPaciente||!porCobrar)&&!enAtencion"}}
  {{/view}} --}}

  {{#view id="programados"}}
    {{#find}}
      {{include field="_created"}}
      {{include field="_parent"}}
      {{include field="persona"}}
      {{include field="base.estatus"}}
      {{include field="base.fechaHoraCita"}}
      {{include field="base.duracionCita"}}
      {{sort condition="=conPrioridad" field="base.prioridad" direction="asc"}}
      {{sort field="base.fechaHoraCita" direction="asc"}}
      {{sort field="_id" direction="desc"}}
      {{search field="_name"}}
      {{search field="_parent.name"}}
      {{search field="persona.id"}}
      {{search field="persona.nombreCompleto"}}
      {{search field="persona.clave" directSearchIfLength="9,10,11,12,13,14,15,16,17,18"}}
      {{!-- {{search field="persona.fechaNacimiento"}} --}}
      {{search field="_date" type="date"}}
      {{search field="base.fechaHoraCita" type="date"}}
      {{search field="base._cita"}}
      {{search field="base._prioridad"}}
      {{search field="base._servicioOrigen"}}
      {{filter field="base.estatus" in="programado"}}
      {{filter field="base.tipoSolicitud" eq="=tipoSolicitud"}}
      {{filter condition="=categoria" field="base.categoria" eq="=categoria"}}
      {{filter condition="=prioridad" field="base.prioridad" eq="=prioridad"}}
      {{filter condition="=conPrioridad" field="base.prioridad" in="urgente,alta"}}
      {{filter condition="=sinPrioridad" field="base.prioridad" nin="urgente,alta"}}
[.#if esMulti.]
      {{filter field="_created.establishment" in="=user.establishment"}}
[./if.]
    {{/find}}
    {{calc field="color" type="expr" value="=fn('solicitudColor', base.estatus)"}}
    {{calc field="icono" type="expr" value="=fn('solicitudIcono', base.estatus)"}}
  {{/view}}

  {{#view id="totalConsultaExterna"}}
    {{#pipeline}}
      {{filter field="base.fechaHoraCita" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.fechaHoraCita" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_updated.moment" eq="finalizado"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='consultaExterna'"}}
      {{group field="base.consultaExterna.base.cita.base._especialidad" as="_especialidad"}}
      {{group field="base._categoria" as="_categoria"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}
  {{#grid id="totalConsultaExterna" view="totalConsultaExterna" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="_especialidad" label="Especialidad"}}
    {{column field="_categoria" label="Categoría"}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}
  {{#grid id="adjuntos" section="adjuntos"}}
    {{column field="nombre" width="350"}}
    {{column field="tipo" width="200"}}
    {{column field="fecha" width="100" readOnly="true"}}
    {{column field="ext" width="100" readOnly="true"}}
    {{column field="tamano" width="100" readOnly="true"}}
    {{column field="orden" width="60"}}
  {{/grid}}

  {{#view id="totalAtencionesUrgencias"}}
    {{#pipeline}}
      {{filter field="_date" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_date" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{!-- {{filter field="_updated.moment" eq="='finalizado'"}} --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='urgencias'"}}
      {{!-- {{filter field="_moment.revisionAdultos" exists="true" or="true"}}
      {{filter field="_moment.revisionObstetrico" exists="true" or="true"}}
      {{filter field="_moment.revisionPediatrico" exists="true" or="true"}} --}}
      {{group field="_updated._moment" as="_momento"}}
      {{!-- {{group field="persona._genero" as="_genero"}} --}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}
  {{#grid id="totalAtencionesUrgencias" view="totalAtencionesUrgencias" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="_momento" label="Momento"}}
    {{!-- {{column field="_genero" label="Genero"}} --}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}

  {{#view id="totalQuirurgicos"}}
    {{#pipeline}}
      {{filter field="base.fechaHoraCita" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.fechaHoraCita" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','pendiente',true)"}}
      {{!-- {{filter field="_updated.moment" in="post,finalizado"}} --}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.servicio" in="cirugia,endourologia,hemodinamia"}}
      {{group field="base.servicio" as="servicio"}}
      {{group field="base._servicioOrigen" as="_servicioOrigen"}}
      {{group field="base._tipoCita" as="_tipoCita"}}
      {{group field="base.cirugia.base.cirugiaRealizar.base.procedimientoCirugia.base.cirugiaCie9" as="cie9"}}
      {{group field="base.cirugia.base.cirugiaRealizar.base.procedimientoCirugia.base._cirugiaCie9" as="_cie9"}}
      {{group field="_updated._moment" as="_moment"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
    {{calc field="_servicio" type="expr" value="=calc.presetName('cfg.central', servicio)"}}
  {{/view}}
  {{#grid id="totalQuirurgicos" view="totalQuirurgicos" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="_servicio" label="Servicio"}}
    {{column field="_servicioOrigen" label="Servicio Origen"}}
    {{column field="_tipoCita" label="Tipo Cita"}}
    {{column field="cie9" label="CIE9"}}
    {{column field="_cie9" label="Descripción"}}
    {{column field="_moment" label="Momento"}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}

  {{#view id="totalNoQuirurgicos"}}
    {{#pipeline}}
      {{filter field="base.fechaHoraCita" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.fechaHoraCita" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_updated.moment" in="post,finalizado"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="base.servicio" nin="cirugia,endourologia,hemodinamia,laboratorio,patologia,imagenologia"}} --}}
      {{filter field="base.servicio" in="=calc.presetNotIn('cfg.servicio','cirugia,endourologia,hemodinamia,laboratorio,patologia,imagenologia',true)"}}
      {{group field="base.servicio" as="servicio"}}
      {{group field="base.codigo" as="codigo"}}
      {{group field="base.descripcion" as="descripcion"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
    {{calc field="_servicio" type="expr" value="=calc.presetName('cfg.central', servicio)"}}
  {{/view}}
  {{#grid id="totalNoQuirurgicos" view="totalNoQuirurgicos" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="_servicio" label="Servicio"}}
    {{column field="codigo" label="Código"}}
    {{column field="descripcion" label="Descripción"}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}

  {{#view id="totalTococirugia"}}
    {{#pipeline}}
      {{filter field="_date" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_date" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='tococirugia'"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
      {{group field="base.codigo" as="codigo"}}
      {{group field="base.descripcion" as="descripcion"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}
  {{#grid id="totalTococirugia" view="totalTococirugia" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="codigo" label="Código"}}
    {{column field="descripcion" label="Descripción"}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}

  {{#view id="totalLaboratorios"}}
    {{#pipeline}}
      {{filter field="_date" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_date" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{filter field="base.tipoSolicitud" eq="='laboratorio'"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
      {{group field="base.codigo" as="codigo"}}
      {{group field="base.descripcion" as="descripcion"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}
  {{#grid id="totalLaboratorios" view="totalLaboratorios" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="codigo" label="Código"}}
    {{column field="descripcion" label="Descripción"}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}

  {{#view id="totalEstudios"}}
    {{#pipeline}}
      {{filter field="_date" gte="=calc.fromYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="_date" lte="=calc.toYearMonth(ejercicio,periodo)" required="true"}}
      {{filter field="base.estatus" in="=fn('listaEstatus','activos')"}}
      {{!-- {{filter field="_updated.moment" exists="true"}} --}}
      {{filter field="_updated.moment" in="=calc.presetNotIn('cfg.moment','rechazado,cancelado,suspendido,suspendidoEntregado,fragmentado',true)"}}
      {{filter field="base.articulo.grupo" exists="true"}}
      {{group field="base.articulo._grupo" as="_grupo"}}
      {{group field="_id" type="count" as="conteo"}}
    {{/pipeline}}
  {{/view}}
  {{#grid id="totalEstudios" view="totalEstudios" pdfFontSize="6" filters="false" exportToExcel="true" allowRefresh="true" columnChooser="false" allowSearch="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="_grupo" label="Grupo"}}
    {{column field="conteo" label="Conteo" summaryType="sum"}}
  {{/grid}}

  {{#view id="sinbaConsultaExterna"}}
    {{complexView type="sinbaConsultaExterna"}}
  {{/view}}
  {{#grid id="sinbaConsultaExterna" name="SINBA - Consulta Externa" view="sinbaConsultaExterna" exportToExcel="true" allowRefresh="true" columnChooser="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="clues"}}
    {{column field="paisNacimiento"}}
    {{column field="curpPrestador"}}
    {{column field="nombrePrestador"}}
    {{column field="primerApellidoPrestador"}}
    {{column field="segundoApellidoPrestador"}}
    {{column field="tipoPersonal"}}
    {{column field="curpPaciente"}}
    {{column field="nombre"}}
    {{column field="primerApellido"}}
    {{column field="segundoApellido"}}
    {{column field="fechaNacimiento" format="DD/MMM/YYYY"}}
    {{column field="entidadNacimiento"}}
    {{column field="sexo"}}
    {{column field="seConsideraIndigena"}}
    {{column field="seAutodenominaAfromexicano"}}
    {{column field="genero"}}
    {{column field="derechohabiencia"}}
    {{column field="programaSMyMG"}}
    {{column field="fechaConsulta" format="DD/MMM/YYYY"}}
    {{column field="servicioAtencion"}}
    {{column field="peso"}}
    {{column field="talla"}}
    {{column field="circunferenciaCintura"}}
    {{column field="sistolica"}}
    {{column field="diastolica"}}
    {{column field="frecuenciaCardiaca"}}
    {{column field="frecuenciaRespiratoria"}}
    {{column field="temperatura"}}
    {{column field="saturacionOxigeno"}}
    {{column field="glucemia"}}
    {{column field="tipoMedicion"}}
    {{column field="numeroTirasControlUtilizadas"}}
    {{column field="embarazadaSinDiabetes"}}
    {{column field="primeraVezAnio"}}
    {{column field="primeraVezUnemeSaih"}}
    {{column field="tipoDificultad"}}
    {{column field="gradoDificultad"}}
    {{column field="origenDificultad"}}
    {{column field="migrante"}}
    {{column field="relacionTemporal"}}
    {{column field="descripcionDiagnostico1"}}
    {{column field="codigoCIEDiagnostico1"}}
    {{column field="descripcionDiagnostico2"}}
    {{column field="primeraVezDiagnostico2"}}
    {{column field="codigoCIEDiagnostico2"}}
    {{column field="descripcionDiagnostico3"}}
    {{column field="primeraVezDiagnostico3"}}
    {{column field="codigoCIEDiagnostico3"}}
    {{column field="sintomaticoRespiratorioTb"}}
    {{column field="atencionPregestacionalRT"}}
    {{column field="riesgo"}}
    {{column field="relacionTemporalEmbarazo"}}
    {{column field="trimestreGestacional"}}
    {{column field="primeraVezAltoRiesgo"}}
    {{column field="complicacionPorDiabetes"}}
    {{column field="complicacionPorInfeccionUrinaria"}}
    {{column field="complicacionPorPreeclampsiaEclampsia"}}
    {{column field="complicacionPorHemorragia"}}
    {{column field="sospechaCovid19"}}
    {{column field="covid19Confirmado"}}
    {{column field="otrasAccPrescAcidoFolico"}}
    {{column field="otrasAccApoyoTranslado"}}
    {{column field="puerpera"}}
    {{column field="infeccionPuerperal"}}
    {{column field="terapiaHormonal"}}
    {{column field="periPostMenopausia"}}
    {{column field="its"}}
    {{column field="patologiaMamariaBenigna"}}
    {{column field="cancerMamario"}}
    {{column field="colposcopia"}}
    {{column field="cancerCervicouterino"}}
    {{column field="ninoSanoRT"}}
    {{column field="pesoParaTalla"}}
    {{column field="pruebaEDI"}}
    {{column field="resultadoEDI"}}
    {{column field="resultadoBattelle"}}
    {{column field="aplicacionCedulaCancer"}}
    {{column field="confirmacionCancer"}}
    {{column field="edasRT"}}
    {{column field="edasPlanTratamiento"}}
    {{column field="recuperadoDeshidratacion"}}
    {{column field="numeroSobresVSOTratamiento"}}
    {{column field="numeroSobresVSOPromocion"}}
    {{column field="irasRT"}}
    {{column field="irasPlanTratamiento"}}
    {{column field="neumoniaRT"}}
    {{column field="informaPrevencionAccidentes"}}
    {{column field="sintomaDepresiva"}}
    {{column field="alteracionMemoria"}}
    {{column field="aivd_ABVD"}}
    {{column field="sindromeCaidas"}}
    {{column field="incontinenciaUrinaria"}}
    {{column field="motricidad"}}
    {{column field="asesoriaNutricional"}}
    {{column field="lineaVida"}}
    {{column field="cartillaSalud"}}
    {{column field="referidoPor"}}
    {{column field="contrarreferido"}}
    {{column field="telemedicina"}}
  {{/grid}}

  {{#view id="sinbaEgresos"}}
    {{complexView type="sinbaEgresos"}}
  {{/view}}
  {{#grid id="sinbaEgresos" name="SINBA - Egresos" view="sinbaEgresos" exportToExcel="true" allowRefresh="true" columnChooser="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="clues"}}
    {{column field="folio"}}
    {{column field="curp"}}
    {{column field="nombres"}}
    {{column field="apellidoPaterno"}}
    {{column field="apellidoMaterno"}}
    {{column field="fechaNacimiento"}}
    {{column field="paisOrigen"}}
    {{column field="entidadNacimiento"}}
    {{column field="nacioHospital"}}
    {{column field="genero"}}
    {{column field="peso"}}
    {{column field="estatura"}}
    {{column field="tieneDependencia"}}
    {{column field="tipoBeneficiario"}}
    {{column field="estadoCivil"}}
    {{column field="seConsideraIndigena"}}
    {{column field="hablaLenguaIndigena"}}
    {{column field="lenguaIndigena"}}
    {{column field="seAutodenominaAfromexicano"}}
    {{column field="paisResidencia"}}
    {{column field="entidadResidencia"}}
    {{column field="municipioResidencia"}}
    {{column field="localidadResidencia"}}
    {{column field="otraLocalidad"}}
    {{column field="codigoPostal"}}
    {{column field="desde"}}
    {{column field="fechaIngresoHospitalario"}}
    {{column field="tipoServicioOtorgado"}}
    {{column field="claveServicioAdicional"}}
    {{column field="numeroServicio"}}
    {{column field="claveServicioAdicional"}}
    {{column field="diasTerapiaIntensiva"}}
    {{column field="horasTerapiaIntensiva"}}
    {{column field="diasTerapiaIntermedia"}}
    {{column field="horasTerapiaIntermedia"}}
    {{column field="procedenciaIngreso"}}
    {{column field="especifiqueProcedencia"}}
    {{column field="cluesDestino"}}
    {{column field="motivoEgreso"}}
    {{column field="cluesReferido"}}
    {{column field="mujerFertil"}}
    {{column field="detalle"}}
    {{column field="diagnostico"}}
    {{column field="primeraVezSubsecuente"}}
    {{column field="numeroComorbilidades"}}
    {{column field="descripcionComorbilidad"}}
    {{column field="codigoCIEComorbilidad"}}
    {{column field="causaExterna"}}
    {{column field="codigoCausaExterna"}}
    {{column field="codigoMorfologiaTumor"}}
    {{column field="existioInfeccion"}}
    {{column field="numerpProcedimiento"}}
    {{column field="descripcionProcedimiento"}}
    {{column field="codigoCIEProcedimiento"}}
    {{column field="tipoAnestesia"}}
    {{column field="enQuirofanoOFuera"}}
    {{column field="tiempoQuirofano"}}
    {{column field="cedulaProfesional"}}
    {{column field="folioLesion"}}
    {{column field="ministerioPublico"}}
    {{column field="numeroCertificado"}}
    {{column field="gestas"}}
    {{column field="paras"}}
    {{column field="abortos"}}
    {{column field="cesareas"}}
    {{column field="edadGestacionalAmenorrea"}}
    {{column field="tipoAtencionObstetrica"}}
    {{column field="tipoNacimiento"}}
    {{column field="tipoProcedimientoAborto"}}
    {{column field="tipoEmbarazo"}}
    {{column field="totalProductos"}}
    {{column field="metodoAnticonceptivo"}}
    {{column field="otroMetodo"}}
    {{column field="totalProductos"}}
    {{column field="condicionNacimiento"}}
    {{column field="condicionNacidoVivo"}}
    {{column field="folioCertificadoNacimiento"}}
    {{column field="pagar"}}
    {{column field="reanimacionNeonatal"}}
    {{column field="alojamientoConjunto"}}
    {{column field="lactanciaExclusiva"}}
    {{column field="tipoUnidadPsiquiatrica"}}
    {{column field="tipoServicioOtorgado"}}
    {{column field="paisNacimientoResponsable"}}
    {{column field="curpResponsable"}}
    {{column field="nombresResponsable"}}
    {{column field="apellidoPaternoResponable"}}
    {{column field="apellidoMaternoResponsable"}}
    {{column field="cedulaResponsable"}}
  {{/grid}}  

  {{#view id="sinbaLesiones"}}
    {{complexView type="sinbaLesiones"}}
  {{/view}}
  {{#grid id="sinbaLesiones" name="SINBA - Lesiones" view="sinbaLesiones" exportToExcel="true" allowRefresh="true" columnChooser="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="notaId"}}
    {{column field="notaFolio"}}
    {{column field="notaNombre"}}
    {{column field="notaTipo"}}
    {{column field="notaEstatus"}}
    {{column field="notaMomento"}}
    {{column field="clues"}}
    {{column field="folio"}}
    {{column field="nombre"}}
    {{column field="primerApellido"}}
    {{column field="segundoApellido"}}
    {{column field="fechaNacimiento"}}
    {{column field="paisNacimiento"}}
    {{column field="entidadNacimiento"}}
    {{column field="escolaridad"}}
    {{column field="leerEscribir"}}
    {{column field="sexo"}}
    {{column field="derechohabiencia"}}
    {{column field="gratuidad"}}
    {{column field="seConsideraIndigena"}}
    {{column field="hablaLenguaIndigena"}}
    {{column field="lenguaInfigena"}}
    {{column field="seAutodenominaAfromexicano"}}
    {{column field="mujerFertil"}}
    {{column field="edadGestacional"}}
    {{column field="discapacidad"}}
    {{column field="usuarioReferido"}}
    {{column field="fechaEvento"}}
    {{column field="horaEvento"}}
    {{column field="diaFestivo"}}
    {{column field="sitioOcurrencia"}}
    {{column field="entidadOcurrencia"}}
    {{column field="municipioOcurrencia"}}
    {{column field="localidadOcurrencia"}}
    {{column field="otraLocalidad"}}
    {{column field="codigoPostal"}}
    {{column field="nombreVialidad"}}
    {{column field="numeroExterior"}}
    {{column field="tipoAsentamiento"}}
    {{column field="nombreAsentamiento"}}
    {{column field="seOtorgaAtencionPrehospitalaria"}}
    {{column field="tiempoTranscurridoAtencionHospital"}}
    {{column field="tipoDroga"}}
    {{column field="intencionalidadEventoLesion"}}
    {{column field="eventoRepetido"}}
    {{column field="agenteLesion"}}
    {{column field="otroAgente"}}
    {{column field="accidenteVehiculoMotor"}}
    {{column field="usoEquipoSeguridad"}}
    {{column field="equipoUtilizadoAccidenteAuto"}}
    {{column field="otroEquipoSeguridad"}}
    {{column field="tipoAccidenteViolencia"}}
    {{column field="numeroAgresores"}}
    {{column field="tipoParentesco"}}
    {{column field="genero"}}
    {{column field="edadAgresor"}}
    {{column field="agresorEfectoTipoDroga"}}
    {{column field="fechaAtencion"}}
    {{column field="horaAtencion"}}
    {{column field="servicioAtencionLesion"}}
    {{column field="especifiqueAtencion"}}
    {{column field="tipoAtencionLesion"}}
    {{column field="areaAnatomica"}}
    {{column field="otraAreaAfectada"}}
    {{column field="consecuenciaLesion"}}
    {{column field="especifiqueConsecuencia"}}
    {{column field="descripcionAfeccion"}}
    {{column field="diagnosticoLesion"}}
    {{column field="numeroAfectacion"}}
    {{column field="descripcionAfectacion"}}
    {{column field="codigoAfectacion"}}
    {{column field="diagnosticoLesion"}}
    {{column field="descripcionCausas"}}
    {{column field="codigoCausasExternas"}}
    {{column field="destinoAtencionLesion"}}
    {{column field="especificarDestino"}}
    {{column field="envioMinisterioPublico"}}
    {{column field="folioCertificadoDefuncion"}}
    {{column field="responsableAtencionMedica"}}
    {{column field="curpResponsable"}}
    {{column field="nombresResponsable"}}
    {{column field="apellidoPaternoResponable"}}
    {{column field="apellidoMaternoResponsable"}}
    {{column field="cedulaResponsable"}}
  {{/grid}}

  {{#view id="sinbaUrgencias"}}
    {{complexView type="sinbaUrgencias"}}
  {{/view}}

  {{#grid id="sinbaUrgencias" name="SINBA - Urgencias" view="sinbaUrgencias" exportToExcel="true" allowRefresh="true" columnChooser="true" wordWrapEnabled="true" columnAutoWidth="wordWrapEnabled"}}
    {{column field="clues"}}
    {{column field="folio"}}
    {{column field="curpPaciente"}}
    {{column field="nombre"}}
    {{column field="primerApellido"}}
    {{column field="segundoApellido"}}
    {{column field="fechaDeNacimiento"}}
    {{column field="paisOrigen"}}
    {{column field="entidadNacimiento"}}
    {{column field="sexo"}}
    {{column field="derechoabiencia"}}
    {{column field="gratuidad"}}
    {{column field="seConsideraIndigena"}}
    {{column field="seConsideraAfroamericano"}}
    {{column field="paisResidencia"}}
    {{column field="entidadDeResidencia"}}
    {{column field="municipioDeResidencia"}}
    {{column field="localidadDeResidencia"}}
    {{column field="otraLocalidad"}}
    {{column field="codigoPostal"}}
    {{column field="atencionPrehospitalaria"}}
    {{column field="tiempoTraslado"}}
    {{column field="fechaDeIngreso"}}
    {{column field="horaDeIngreso"}}
    {{column field="tipoDeUrgencia"}}
    {{column field="motivoDeAtención"}}
    {{column field="tipoCama"}}
    {{column field="trasladoTransitorio"}}
    {{column field="cluesTraslado"}}
    {{column field="fechaAlta"}}
    {{column field="horaAlta"}}
    {{column field="altaPor"}}
    {{column field="cluesReferido"}}
    {{column field="ministerioPúblico"}}
    {{column field="folioCertificadoDefunción"}}
    {{column field="mujerFertil"}}
    {{column field="edadGestacional"}}
    {{column field="descripcionAfeccionPrincipal"}}
    {{column field="codigoCieAfeccionPrincipal"}}
    {{column field="numeroComorbilidades"}}
    {{column field="descripcionComorbilidad"}}
    {{column field="codigoCieComorbilidad"}}
    {{column field="afeccionPrincipalReseleccionada"}}
    {{column field="tipoEspecialidad"}}
    {{column field="especifiqueEspecialidad"}}
    {{column field="paisNacimientoEspecialista"}}
    {{column field="curpEspecialista"}}
    {{column field="nombreMedico"}}
    {{column field="primerApellidoMedico"}}
    {{column field="segundoApellidoMedico"}}
    {{column field="cedulaEspecialidad"}}
    {{column field="numeroProcedimiento"}}
    {{column field="codigoCieProcedimiento"}}
    {{column field="numeroMedicamentoMinistrado"}}
    {{column field="codigoMedicamento"}}
    {{column field="planIras"}}
    {{column field="planEdas"}}
    {{column field="numeroSobres"}}
    {{column field="paisNacimientoEspecialista"}}
    {{column field="curpEspecialista"}}
    {{column field="nombreMedico"}}
    {{column field="primerApellidoMedico"}}
    {{column field="segundoApellidoMedico"}}
    {{column field="cedulaEspecialidad"}}
  {{/grid}}  

  {{#view id="interconsultaFinalizados"}}
    {{#find limit="-1"}}
      {{include field="_name"}}
      {{sort field="_created.date" direction="desc"}}
      {{!-- {{search field="_name"}} --}}
      {{filter field="_updated.moment" eq="='finalizado'"}}
      {{filter field="base.tipoSolicitud" eq="='interconsulta'"}}
      {{filter condition="=persona" field="persona.id" eq="=persona"}}
    {{/find}}
  {{/view}}

  {{#transform id="copiar"}}
    {{update section="persona" value="=persona"}}
  {{/transform}}

  {{#transform id="copiarAlumno"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set nombreAlumno="=_params.persona.nombreCompleto"}}
      {{set nombreCurso="=base.descripcion"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarGenerarAdquisicion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{setRef ref="adquisicion.base.articulo" value="=articulo.id"}}
      {{setRef ref="adquisicion.base.codigo" value="=base.codigo"}}
      {{setRef ref="adquisicion.base.descripcion" value="=base.descripcion"}}
      {{setRef ref="adquisicion.base.existenciaActual" value="=calc.sumRef(_items2, 'cantidad')"}}
      {{setRef ref="adquisicion.base.cantidad" value="=calc.sumRef(_items, 'cantidad')"}}
      {{setRef ref="adquisicion.base.estatus" value="='nuevo'"}}
      {{setRef ref="adquisicion._name" value="=calc.concat(base.descripcion,'('+base.codigo+')')"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRetroceso"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="cancel"}}
      {{set hint="=_params.hint"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAvance"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="next"}}
      {{set hint="=_params.hint"}}
      {{set origen="=_params._parent.id"}}
      {{set _origen="=_params._parent.name"}}
      {{set solicitud="=_params"}}
      {{set cantidadAdjuntosSolicitud="=adjuntos.length"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set tipoVencimiento="=_params.tipoVencimiento"}}
      {{set tiempo="=calc.dueTimes(_params.servicio, _params.subTipoSolicitud, _params.motivo, _params.momentoDieta, _params.criticidadZona, calc.getRef(_items[0], 'detalle.datosContrato.tiempos'))"}}
      {{set tiempoEspecifico="=_params.tiempoEspecifico"}}
      {{set tiempoAlertaEspecifico="=_params.tiempoAlertaEspecifico"}}
      {{set tieneDiagnostico="=_params.subType=='evaluacion'"}}
      {{set tieneResolucion="=_params.subType=='resolucion'"}}
      {{set tieneMedicionesParametros="=_params.tieneMedicionesParametros"}}
      {{set tieneRadioactividadAtenuada="=_params.tieneRadioactividadAtenuada"}}
      {{set tieneMobiliario="=_params.tieneMobiliario"}}
      {{set tieneEquipoMedico="=_params.tieneEquipoMedico"}}
      {{set tieneElementoTecnologico="=_params.tieneElementoTecnologico"}}
      {{set tieneMoi="=_params.tieneMoi"}}
      {{set tieneResiduosHospitalarios="=_params.tieneResiduosHospitalarios"}}
      {{set tieneComentariosActivoFijo="=_params.tieneComentariosActivoFijo"}}
      {{set tieneComentariosTercero="=_params.tieneComentariosTercero"}}
      {{set tieneCostos="=_params.tieneCostos"}}
      {{set tieneHorasHombre="=_params.tieneHorasHombre"}}
      {{set tieneHojaCostos="=_params.tieneHojaCostos"}}
      {{set tieneReemplazo="=_params.tieneReemplazo"}}
      {{set tieneDatosEntregaMezcla="=_params.tieneDatosEntregaMezcla"}}
      {{set errorAsignacionPersonal="=_params.errorAsignacionPersonal"}}
      {{set requiereAdjuntos="=_params.requiereAdjuntos"}}
      {{set referencias="=_params.referencias"}}
      {{set esReprogramacion="=_params.esReprogramacion||tieneResolucion"}}
      {{set esVencimientoNuevo="=_params.esVencimientoNuevo"}}
      {{set subTipoSolicitudNueva="=_params.subTipoSolicitud"}}
      {{set _subTipoSolicitudNueva="=_params._subTipoSolicitud||calc.presetName('cfg.subTipoSolicitudActivoFijo', _params.subTipoSolicitud)"}}
      {{set plantillaEvaluacion="=_params.plantillaEvaluacion"}}
      {{set _plantillaEvaluacion="=_params._plantillaEvaluacion"}}
      {{set diagnostico="=fn('diagnosticoOmision', _params.subType, _params.base.subTipoSolicitud, calc.getRef(_params, 'info.base.datosActivoFijo.base.tipoInstalacion'))"}}
      {{set condition="=_params.tieneMobiliario" mobiliario="=_params.base.mobiliario"}}
      {{set condition="=_params.tieneMobiliario" _mobiliario="=calc.tpl('mobiliario', _params.base._mobiliario.base)"}}
      {{set condition="=_params.tieneEquipoMedico" equipoMedico="=_params.base.equipoMedico"}}
      {{set condition="=_params.tieneEquipoMedico" _equipoMedico="=calc.tpl('equipoMedico', _params.base.equipoMedico.base)"}}
      {{set condition="=_params.tieneElementoTecnologico" elementoTecnologico="=_params.base.elementoTecnologico"}}
      {{set condition="=_params.tieneElementoTecnologico" _elementoTecnologico="=calc.tpl('elementoTecnologico', _params.base.equipoMedico.base)"}}
      {{set notificarSubPersonas="=_params.notificarSubPersonas"}}
    {{/update}}
    {{#update condition="=_params.tieneMobiliario" section="base" newRef="mobiliario"}}
      {{setRef ref="mobiliario.base.subTipoSolicitud" value="=_params.subTipoSolicitud"}}
      {{setRef ref="mobiliario.base._subTipoSolicitud" value="=calc.presetName('cfg.subTipoSolicitudActivoFijo', _params.subTipoSolicitud)"}}
      {{setRef ref="mobiliario.base.contrato" value="=_params.info.base.contrato"}}
      {{setRef ref="mobiliario.base._contrato" value="=_params.info.base._contrato"}}
      {{setRef ref="mobiliario.base.estatus" value="='nuevo'"}}
    {{/update}}
    {{#update condition="=_params.tieneEquipoMedico" section="base" newRef="equipoMedico"}}
      {{setRef ref="equipoMedico.base.subTipoSolicitud" value="=_params.subTipoSolicitud"}}
      {{setRef ref="equipoMedico.base._subTipoSolicitud" value="=calc.presetName('cfg.subTipoSolicitudActivoFijo', _params.subTipoSolicitud)"}}
      {{setRef ref="equipoMedico.base.contrato" value="=_params.info.base.contrato"}}
      {{setRef ref="equipoMedico.base._contrato" value="=_params.info.base._contrato"}}
      {{setRef ref="equipoMedico.base.estatus" value="='nuevo'"}}
    {{/update}}
    {{#update condition="=@tieneElementoTecnologico" section="base" newRef="elementoTecnologico"}}      
      {{set elementoTecnologico="=[
        fn('copiarSolicitud', _params.base.elementoTecnologico, subTipoSolicitudNueva, _subTipoSolicitudNueva, _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=@tieneMoi" section="base" newRef="moi"}}      
      {{set moi="=[
        fn('copiarSolicitud', _params.base.moi, subTipoSolicitudNueva, _subTipoSolicitudNueva, _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=@tieneResiduosHospitalarios" section="base" newRef="residuosHospitalarios"}}      
      {{set residuosHospitalarios="=[
        fn('copiarSolicitud', _params.base.residuosHospitalarios, subTipoSolicitudNueva, _subTipoSolicitudNueva, _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{update section="articulos" value="=_params.articulos"}}
    {{update condition="=_params.copiarMateriales" section="materiales" value="=materiales"}}
  {{/transform}}

  {{#transform id="copiarAvanceMobiliarioReposicion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="next"}}
      {{set hint="=_params.hint"}}
      {{set origen="=_params._parent.id"}}
      {{set _origen="=_params._parent.name"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set tieneDiagnostico="=_params.subType=='evaluacion'"}}
      {{set tieneResolucion="=_params.subType=='resolucion'"}}
      {{set tieneInstalacionProvisional="=_params.tieneInstalacionProvisional"}}
      {{set tieneMobiliario="=true"}}
      {{set tieneAdquisicionMobiliario="=true"}}
    {{/update}}
    {{#update section="base" newRef="adquisicionMobiliario"}}      
      {{set adquisicionMobiliario="=[
        fn('copiarSolicitud', _params.base.mobiliario, 'reposicion', 'Reposición',_params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=tieneInstalacionProvisional" section="base" newRef="mobiliario"}}      
      {{set mobiliario="=[
        fn('copiarSolicitud', _params.base.mobiliario, 'desinstalacion',         'Desinstalación',          _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
        fn('copiarSolicitud', _params.base.mobiliario, 'instalacionProvisional', 'Instalación Provisional', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=!@tieneInstalacionProvisional" section="base" newRef="mobiliario"}}      
      {{set mobiliario="=[
        fn('copiarSolicitud', _params.base.mobiliario, 'desinstalacion', 'Desinstalación', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAvanceMoiReposicion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="next"}}
      {{set hint="=_params.hint"}}
      {{set origen="=_params._parent.id"}}
      {{set _origen="=_params._parent.name"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set tieneDiagnostico="=_params.subType=='evaluacion'"}}
      {{set tieneResolucion="=_params.subType=='resolucion'"}}
      {{set tieneInstalacionProvisional="=_params.tieneInstalacionProvisional"}}
      {{set tieneMoi="=true"}}
    {{/update}}
    {{#update condition="=tieneInstalacionProvisional" section="base" newRef="moi"}}      
      {{set moi="=[
        fn('copiarSolicitud', _params.base.moi, 'desinstalacion',         'Desinstalación',          _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
        fn('copiarSolicitud', _params.base.moi, 'instalacionProvisional', 'Instalación Provisional', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
        fn('copiarSolicitud', _params.base.moi, 'reposicion',             'Reposición',              _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=!@tieneInstalacionProvisional" section="base" newRef="moi"}}      
      {{set moi="=[
        fn('copiarSolicitud', _params.base.moi, 'desinstalacion', 'Desinstalación', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
        fn('copiarSolicitud', _params.base.moi, 'reposicion',     'Reposición',     _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAvanceEquipoMedicoReposicion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="next"}}
      {{set hint="=_params.hint"}}
      {{set origen="=_params._parent.id"}}
      {{set _origen="=_params._parent.name"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set tieneDiagnostico="=_params.subType=='evaluacion'"}}
      {{set tieneResolucion="=_params.subType=='resolucion'"}}
      {{set tieneInstalacionProvisional="=_params.tieneInstalacionProvisional"}}
      {{set tieneEquipoMedico="=true"}}
      {{set tieneAdquisicionEquipo="=true"}}
    {{/update}}
    {{#update section="base" newRef="adquisicionEquipo"}}      
      {{set adquisicionEquipo="=[
        fn('copiarSolicitud', _params.base.equipoMedico, 'reposicion', 'Reposición', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=tieneInstalacionProvisional" section="base" newRef="equipoMedico"}}      
      {{set equipoMedico="=[
        fn('copiarSolicitud', _params.base.equipoMedico, 'desinstalacion',         'Desinstalación',          _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
        fn('copiarSolicitud', _params.base.equipoMedico, 'instalacionProvisional', 'Instalación Provisional', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=!@tieneInstalacionProvisional" section="base" newRef="equipoMedico"}}      
      {{set equipoMedico="=[
        fn('copiarSolicitud', _params.base.equipoMedico, 'desinstalacion', 'Desinstalación', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAvanceElementoTecnologicoReposicion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="next"}}
      {{set hint="=_params.hint"}}
      {{set origen="=_params._parent.id"}}
      {{set _origen="=_params._parent.name"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set tieneDiagnostico="=_params.subType=='evaluacion'"}}
      {{set tieneResolucion="=_params.subType=='resolucion'"}}
      {{set tieneInstalacionProvisional="=_params.tieneInstalacionProvisional"}}
      {{set tieneElementoTecnologico="=true"}}
      {{set tieneAdquisicionEquipo="=true"}}
    {{/update}}
    {{#update section="base" newRef="adquisicionEquipo"}}      
      {{set adquisicionEquipo="=[
        fn('copiarSolicitud', _params.base.elementoTecnologico, 'reposicion', 'Reposición',_params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=tieneInstalacionProvisional" section="base" newRef="elementoTecnologico"}}      
      {{set elementoTecnologico="=[
        fn('copiarSolicitud', _params.base.elementoTecnologico, 'desinstalacion',         'Desinstalación',          _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
        fn('copiarSolicitud', _params.base.elementoTecnologico, 'instalacionProvisional', 'Instalación Provisional', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
    {{#update condition="=!@tieneInstalacionProvisional" section="base" newRef="elementoTecnologico"}}      
      {{set elementoTecnologico="=[
        fn('copiarSolicitud', _params.base.elementoTecnologico, 'desinstalacion', 'Desinstalación', _params.info.base.contrato, _params.info.base._contrato, 'nuevo'),
      ]"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAvanceLote"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="next"}}
      {{set hint="=_params.hint"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.vencimiento"}}
      {{set tieneProveedor="=_params.tieneProveedor"}}
      {{set tieneContenido="=_params.tieneContenido"}}
      {{set tieneGenerador="=_params.tieneGenerador"}}
      {{set tienePeso="=_params.tienePeso"}}
      {{set tieneSubTipoResiduo="=_params.tieneSubTipoResiduo"}}
      {{set tieneResumen="=_params.tieneResumen"}}
      {{set tieneCalificaciones="=_params.tieneCalificaciones"}}
      {{set tieneVencimiento="=_params.tieneVencimiento"}}
      {{set requiereAdjuntos="=_params.requiereAdjuntos"}}
    {{/update}}
  {{/transform}}

    {{#transform id="copiarCancelacionLote"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set tipoAvance="cancel"}}
      {{set hint="=_params.hint"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.vencimiento"}}
      {{set tieneProveedor="=_params.tieneProveedor"}}
      {{set tieneContenido="=_params.tieneContenido"}}
      {{set tieneGenerador="=_params.tieneGenerador"}}
      {{set tienePeso="=_params.tienePeso"}}
      {{set tieneSubTipoResiduo="=_params.tieneSubTipoResiduo"}}
      {{set tieneResumen="=_params.tieneResumen"}}
      {{set tieneCalificaciones="=_params.tieneCalificaciones"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAvanceMultiple"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set momento="=_params.momentoSiguente"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarSubMoment"}}
    {{update section="persona" transform="copiarPersona"}}
    {{#update section="base"}}
      {{set subMoment="=_params.control.subMoment"}}
      {{set _subMoment="=_params.control._subMoment"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRegistroEvento"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set referencias="=calc.pluck(articulos, 'codigo')"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRegistroProveedor"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set referencias="=calc.pluck(articulos, 'codigo')"}}
      {{set proveedores="=_.uniq(calc.pluck(_items, 'nombreProveedor'))"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRegistroCotizacionProveedor"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
    {{/update}}
    {{update section="articulos" value="=articulos"}}
  {{/transform}}

  {{#transform id="copiarRegistroReciboProveedor"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set referencias="=calc.pluck(articulos, 'codigo')"}}
      {{set proveedores="=_.uniq(calc.pluck(_items, 'nombreProveedor'))"}}
      {{!-- {{set costos="=calc.valueMap(_items2[0].articulos, 'codigo', 'costoUnitario')"}} --}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRegistroInfoProveedor"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set proveedores="=_.uniq(calc.pluck(_items, 'nombreProveedor'))"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRegistroCNO"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set referencias="=calc.pluck(articulos, 'codigo')"}}
      {{set proveedores="=_.uniq(calc.pluck(_items, 'nombreProveedor'))"}}
      {{!-- {{set articulos="=_.uniq(calc.pluckExpr(articulos, '=calc.concatValueKey(descripcion, codigo)'))"}} --}}
      {{set articulos="=_.uniq(calc.pluck(articulos, 'codigo'))"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarEntregaAlimentosBandeja"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base" newRef="alimentacionPacientes"}}
      {{set solicitud="=_params"}}
      {{set tipoSolicitud="=_params.base.tipoSolicitud"}}
      {{set subTipoSolicitud="=_params.base.subTipoSolicitud"}}
      {{set formaEntrega="=_params.base.formaEntrega"}}
      {{set formaDevolucion="=_params.base.formaDevolucion"}}
      {{set momento="=_params._updated.moment"}}
      {{set subMomento="=_params.subMomento"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{!-- {{set prioridad="=_params.info.base.prioridad"}} --}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.subTipoSolicitud" value="='retiroBandeja'"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base._subTipoSolicitud" value="='Retiro Bandeja'"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.paciente" value="=_params.info.base.paciente"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base._paciente" value="=_params.info.base._paciente"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.clave" value="=_params.info.base.clave"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.cama" value="=_params.info.base.cama"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base._cama" value="=_params.info.base._cama"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.contrato" value="=_params.info.base.contrato"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base._contrato" value="=_params.info.base._contrato"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.vencimiento" value="=moment().add(30,'minutes').format()"}}
      {{setRef condition="=_params.info.base.formaDevolucion=='retiroBandeja'" ref="alimentacionPacientes.base.estatus" value="='nuevo'"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarSolicitud"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAdjuntos"}}
    {{update section="persona" value="=persona"}}
    {{update section="adjuntos" value="=adjuntos"}}
  {{/transform}}

  {{#transform id="copiarVenta"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set venta="=_params.base.venta"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarCompra"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set compra="=_params.base.compra"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarEvaluacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{!-- {{set solicitud="=info.base.solicitud"}} --}}
      {{set plantillaEvaluacion="=info.base.plantillaEvaluacion"}}
      {{set _plantillaEvaluacion="=info.base._plantillaEvaluacion"}}
      {{set tipoPruebaEvaluacion="=info.base.tipoPruebaEvaluacion"}}
      {{set _tipoPruebaEvaluacion="=info.base._tipoPruebaEvaluacion"}}
      {{set bibliografia="=info.base.bibliografia"}}
      {{set instrucciones="=info.base.instrucciones"}}
      {{set limiteTiempo="=info.base.limiteTiempo"}}
      {{set _limiteTiempo="=info.base._limiteTiempo"}}
      {{set conLimiteTiempo="=info.base.conLimiteTiempo"}}
      {{set tiempoMaximo="=info.base.tiempoMaximo"}}
      {{set comentarios="=info.base.comentarios"}}
    {{/update}}
    {{update section="temas" value="=info.temas"}}
    {{update section="preguntas" value="=info.preguntas"}}
  {{/transform}}

  {{#transform id="copiarValidacionEvaluacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set puntaje="=info.base.puntaje"}}
      {{set totalPuntos="=info.base.totalPuntos"}}
      {{set aprobacion="=info.base.aprobacion"}}
      {{set resultadoCualitativo="=control.resultadoCualitativo"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarEntregaDocumentacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{!-- {{set solicitud="=info.base.solicitud"}} --}}
      {{set documentacionEntregada="=info.base.documentacion"}}
      {{set _documentacionEntregada="=info.base._documentacion"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarSolicitudVencimiento"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set vencimiento="=_params.base.vencimiento"}}
      {{set tieneVencimiento="=true"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarValidacionInventario"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set tipoArticulo="=info.base.tipoArticulo"}}
      {{set _tipoArticulo="=info.base._tipoArticulo"}}
    {{/update}}
    {{update section="articulos" value="=articulos"}}
  {{/transform}}

  {{#transform id="copiarRegistroEvaluacionDesempeno"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set tipoArticulo="=info.base.subTipoSolicitud=='evaluacionCompetencias'?'competencia':'meta'"}}
      {{set cantidadTotal="=calc.round(calc.sumRef(articulos, 'cantidad'),2)"}}
      {{set calificacionTotal="=calc.round(calc.sumExpr(articulos, '=cantidad*(cumplimiento/100)'),2)"}}
      {{set validar100="=calc.in(info.base.subTipoSolicitud, ['registroMetasColectivas','registroMetasIndividuales'])"}}
    {{/update}}
    {{update section="articulos" value="=articulos"}}
  {{/transform}}

  {{#transform id="copiarAsignacionAcceso"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set usuario="=calc.getRef(_params, 'info.notaAsignacionAcceso.base.usuario')||[]"}}
      {{set _usuario="=_params.info.notaAsignacionAcceso.base._usuario"}}
      {{set empleado="=calc.getRef(_params, 'info.notaAsignacionAcceso.base.empleado')||[]"}}
      {{set _empleado="=_params.info.notaAsignacionAcceso.base._empleado"}}
      {{set procedimientoMantenimiento="=calc.getRef(_params, 'info.notaAsignacionAcceso.base.procedimientoMantenimiento')||[]"}}
      {{set _procedimientoMantenimiento="=_params.info.notaAsignacionAcceso.base._procedimientoMantenimiento"}}
[.#if esSIC.]
      {{set validarEmpleadoActivo="=true"}}
[./if.]    
    {{/update}}
    {{!-- {{update section="usuarios" value="=_.map(_access,function(user){return{usuario:user.user,_usuario:user._user,estatus:'Continuar'}})"}} --}}
  {{/transform}}

  {{#transform id="copiarAsignacionAccesoLote"}}
    {{#update section="base"}}
      {{set servicio="=_params.servicio"}}
[.#if esSIC.]
      {{set validarEmpleadoActivo="=true"}}
[./if.]    
    {{/update}}
    {{update section="persona" value="=persona"}}
    {{update section="usuarios" value="=_.map(_access,function(user){return{usuario:user.user,_usuario:user._user,estatus:'Continuar'}})"}}
  {{/transform}}

  {{#transform id="copiarAsignacionManualTiempoEjecucion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set nuevoVencimiento="=_params.base.vencimiento"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRecoleccionRopa"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base" newRef="conteoRopa"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set ubicacionOrigen="=_params.info.base.ubicacionOrigenRopaLimpia"}}
      {{set _ubicacionOrigen="=_params.info.base._ubicacionOrigenRopaLimpia"}}
      {{set ubicacionDestino="=_params.info.base.ubicacionEntregaRopaSucia"}}
      {{set _ubicacionDestino="=_params.info.base._ubicacionEntregaRopaSucia"}}
      {{setRef ref="conteoRopa.base" value="=_params.info.base"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarConteoRopa"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base" newRef="entregaRopa"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set ubicacionOrigen="=_params.info.base.ubicacionOrigenRopaLimpia"}}
      {{set _ubicacionOrigen="=_params.info.base._ubicacionOrigenRopaLimpia"}}
      {{set ubicacionDestino="=_params.info.base.ubicacionEntregaRopaSucia"}}
      {{set _ubicacionDestino="=_params.info.base._ubicacionEntregaRopaSucia"}}
      {{setRef ref="entregaRopa.base.contrato" value="=_params.info.base.contrato"}}
      {{setRef ref="entregaRopa.base._contrato" value="=_params.info.base._contrato"}}
      {{setRef ref="entregaRopa.base.vencimiento" value="=moment().add(3,'hours').format()"}}
      {{setRef ref="entregaRopa.base.ubicacionRecoleccionRopaLimpia" value="=_params.info.base.ubicacionRecoleccionRopaLimpia"}}
      {{setRef ref="entregaRopa.base._ubicacionRecoleccionRopaLimpia" value="=_params.info.base._ubicacionRecoleccionRopaLimpia"}}
      {{setRef ref="entregaRopa.base.ubicacionEntregaRopaLimpia" value="=_params.info.base.ubicacionOrigenRopaLimpia"}}
      {{setRef ref="entregaRopa.base._ubicacionEntregaRopaLimpia" value="=_params.info.base._ubicacionOrigenRopaLimpia"}}
      {{setRef ref="entregaRopa.base.estatus" value="='nuevo'"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarEntregaRopa"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{!-- {{set prioridad="=_params.info.base.prioridad"}} --}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set ubicacionOrigen="=_params.info.base.ubicacionRecoleccionRopaLimpia"}}
      {{set _ubicacionOrigen="=_params.info.base._ubicacionRecoleccionRopaLimpia"}}
      {{set ubicacionDestino="=_params.info.base.ubicacionEntregaRopaLimpia"}}
      {{set _ubicacionDestino="=_params.info.base._ubicacionEntregaRopaLimpia"}}
    {{/update}}
    {{update section="articulos" value="=articulos"}}
  {{/transform}}

  {{#transform id="copiarRechazoRopa"}}
    {{update section="persona" value="=persona"}}
    {{update section="articulos" value="=articulos"}}
    {{#update section="base" newRef="entregaRopa"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{!-- {{set prioridad="=_params.info.base.prioridad"}} --}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set ubicacionOrigen="=_params.info.base.ubicacionRecoleccionRopaLimpia"}}
      {{set _ubicacionOrigen="=_params.info.base._ubicacionRecoleccionRopaLimpia"}}
      {{set ubicacionDestino="=_params.info.base.ubicacionEntregaRopaSucia"}}
      {{set _ubicacionDestino="=_params.info.base._ubicacionEntregaRopaSucia"}}
      {{set pesoTotal="=calc.sumExpr(articulos, '=peso*cantidad')"}}
      {{setRef ref="entregaRopa.base.contrato" value="=_params.info.base.contrato"}}
      {{setRef ref="entregaRopa.base._contrato" value="=_params.info.base._contrato"}}
      {{setRef ref="entregaRopa.base.vencimiento" value="=moment().add(1,'hours').format()"}}
      {{setRef ref="entregaRopa.base.ubicacionRecoleccionRopaLimpia" value="=calc.getRef(_items[0], 'detalle.datosContrato.ubicacionCentralRopaLimpia')"}}
      {{setRef ref="entregaRopa.base._ubicacionRecoleccionRopaLimpia" value="=calc.getRef(_items[0], 'detalle.datosContrato._ubicacionCentralRopaLimpia')"}}
      {{setRef ref="entregaRopa.base.ubicacionEntregaRopaLimpia" value="=_params.info.base.ubicacionRecoleccionRopaLimpia"}}
      {{setRef ref="entregaRopa.base._ubicacionEntregaRopaLimpia" value="=_params.info.base._ubicacionRecoleccionRopaLimpia"}}
      {{setRef ref="entregaRopa.base.estatus" value="='nuevo'"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarDevolucionRopa"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{!-- {{set prioridad="=_params.info.base.prioridad"}} --}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{set ubicacionOrigen="=_params.info.base.ubicacionDevolucionRopa"}}
      {{set _ubicacionOrigen="=_params.info.base._ubicacionDevolucionRopa"}}
      {{set ubicacionDestino="=_params.info.base.ubicacionEntregaRopaSucia"}}
      {{set _ubicacionDestino="=_params.info.base._ubicacionEntregaRopaSucia"}}
    {{/update}}
    {{update section="articulos" value="=articulos"}}
  {{/transform}}

  {{#transform id="copiarSolicitudServicio"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set proveedor="=_params.info.base.proveedor"}}
      {{set _proveedor="=_params.info.base._proveedor"}}
      {{set prioridad="=_params.info.base.prioridad"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarProgramaReparacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base" newRef="incumplimiento"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set proveedor="=_params.info.base.proveedor"}}
      {{set _proveedor="=_params.info.base._proveedor"}}
      {{set prioridad="=_params.info.base.prioridad"}}
      {{set vencimiento="=_params.info.base.vencimiento"}}
      {{set alerta="=_params.info.base.alerta"}}
      {{set vigente="=moment(_params.info.base.vencimiento).format()>moment().format()?'si':'no'"}}
      {{setRef ref="incumplimiento.base.contrato" value="=base.contrato"}}
      {{setRef ref="incumplimiento.base._contrato" value="=base._contrato"}}
      {{setRef ref="incumplimiento.base.servicio" value="=base.servicio"}}
      {{setRef ref="incumplimiento.base._servicio" value="=base._servicio"}}
      {{setRef ref="incumplimiento.base.subTipoSolicitud" value="='registro'"}}
      {{setRef ref="incumplimiento.base._subTipoSolicitud" value="='Registro'"}}
      {{setRef ref="incumplimiento.base.ubicacion" value="=base.ubicacion"}}
      {{setRef ref="incumplimiento.base._ubicacion" value="=base._ubicacion"}}
      {{setRef ref="incumplimiento.base.area" value="=base.area"}}
      {{setRef ref="incumplimiento.base._area" value="=base._area"}}
      {{setRef ref="incumplimiento.base.criticidadZona" value="=base.criticidadZona"}}
      {{setRef ref="incumplimiento.base._criticidadZona" value="=base._criticidadZona"}}
      {{setRef ref="incumplimiento.base.vencimiento" value="=base.vencimiento"}}
      {{setRef ref="incumplimiento.base.estatus" value="='nuevo'"}}
      {{setRef ref="incumplimiento.base._estatus" value="='Nuevo'"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarIniciaReparacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set vencimiento="=moment().add(1,'d').format()"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarFacturaSolicitud"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set subTotal="=_params.base.importe"}}
      {{set importeTotal="=_params.base.importe"}}
      {{set datosCfdi="{_name:_params.base.descripcion,base:{concepto:_params.base.descripcion,satCodigo:'85121600',satUnidad:'C62',satIva:'0'}}"}}
      {{set _datosCfdi="=_params.base.descripcion"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarSolicitudCargo"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set diasHospitalizado="=fn('diasHospitalizado', contexto)"}}
      {{set nombreCompleto="=persona.nombreCompleto"}}
      {{set clave="=persona.clave"}}
      {{set fechaNacimiento="=persona.fechaNacimiento"}}
      {{set direccion="=calc.first(persona.direccion)._name"}}
      {{set identificacion="=calc.first(persona.identificacion)._name"}}      
    {{/update}}
  {{/transform}}

  {{#transform id="copiarSolicitudCirugia"}}
    {{update section="contexto" value="=_params.join.contexto"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set esMujer="=persona.esMujer"}}
      {{set esHombre="=!esMujer"}}
      {{set tipoSanguineo="=persona.tipoSanguineo"}}
      {{set _tipoSanguineo="=persona._tipoSanguineo"}}
      {{set solicitud="=(_params._type=='cama')?calc.getRef(_params, 'join.contexto.'+_params.base.central+'.info.solicitud'):_params"}}
    {{/update}}
    {{update section="resumen" value="=_params.join.resumen"}}
  {{/transform}}

  {{#transform id="copiarFinalizaSolicitud"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set importeCotizacion="=_params.info.base.importeCotizacion"}}
      {{set fechaCompromiso="=_params.info.base.fechaCompromiso"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarIniciaAsignacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set noEsVehiculo="=!base.asignacionActivoFijo.base.esVehiculo"}}
      {{set esVehiculo="=base.asignacionActivoFijo.base.esVehiculo"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarFinalizaAsignacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set nivelesIniciales="=_params.info.base.nivelesIniciales"}}
      {{set noEsVehiculo="=!base.asignacionActivoFijo.base.esVehiculo"}}
      {{set esVehiculo="=base.asignacionActivoFijo.base.esVehiculo"}}
      {{set contrato="=_params.info.base.contrato"}}
      {{set _contrato="=_params.info.base._contrato"}}
      {{set importeCotizacion="=_params.info.base.importeCotizacion"}}
      {{set fechaCompromiso="=_params.info.base.fechaCompromiso"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarIniciaAsignacionSubTipoActivoFijo"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set tipoActivoFijo="=_params.info.base.tipoActivoFijo"}}
      {{set _tipoActivoFijo="=_params.info.base._tipoActivoFijo"}}
      {{set subTipoActivoFijo="=_params.info.base.subTipoActivoFijo"}}
      {{set _subTipoActivoFijo="=_params.info.base._subTipoActivoFijo"}}
      {{set terminosCondiciones="=_params.info.base.terminosCondiciones"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarFinalizaAsignacionSubTipoActivoFijo"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set tipoActivoFijo="=_params.info.base.tipoActivoFijo"}}
      {{set _tipoActivoFijo="=_params.info.base._tipoActivoFijo"}}
      {{set subTipoActivoFijo="=_params.info.base.subTipoActivoFijo"}}
      {{set _subTipoActivoFijo="=_params.info.base._subTipoActivoFijo"}}
      {{set nivelesIniciales="=_params.info.base.nivelesIniciales"}}
      {{set articulo="=_params.info.base.articulo"}}
      {{set _articulo="=_params.info.base._articulo"}}
    {{/update}}
  {{/transform}}

  {{!-- {{#transform id="copiarUtilizado"}}
    {{update section="persona" transform="copiarPersona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set cantidad="=_params.control.utilizado"}}
    {{/update}}
  {{/transform}} --}}

  {{#transform id="copiarEdicionSolicitud"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set factorActual="=base.factor"}}
      {{set cantidadActual="=base.cantidad"}}
      {{set cantidad="=base.cantidad"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarEdicionSolicitudProtocoloInvestigacion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set protocoloInvestigacion="=_params.base.protocoloInvestigacion"}}
      {{set _protocoloInvestigacion="=_params.base._protocoloInvestigacion"}}
    {{/update}}
  {{/transform}}

  {{!-- {{#transform id="copiar2"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set categoria="=_params._categoria"}}
    {{/update}}
  {{/transform}} --}}

  {{#transform id="copiarCategoria"}}
    {{#update section="base"}}
      {{set categoria="=_params._categoria"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarCategoriaPersona"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set categoria="=_params._categoria"}}
      {{set tieneDatosRechazoMezcla="=_params.tieneDatosRechazoMezcla"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarPrepararMezcla"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set solicitud="=_params"}}
      {{set _solicitud="=_params._name"}}
      {{set indicacion="=_params._parent.id"}}
      {{set _indicacion="=_params._parent.name"}}
      {{set solicitante="=_params.base.solicitante"}}
      {{set _solicitante="=_params.base._solicitante"}}
      {{set persona="=_params.persona.id"}}
      {{set _persona="=_params.persona.nombreCompleto"}}
      {{set central="=_params.base.central"}}
      {{set _central="=_params.base._central"}}
      {{set cama="=_params.base.cama"}}
      {{set _cama="=_params.base._cama"}}
      {{set codigo="=_params.base.codigo"}}
      {{set descripcion="=_params.base.descripcion"}}
      {{set solicitado="=_params.control.solicitado"}}
      {{set fechaHoraRequerida="=_params.base.fechaHoraRequerida"}}
      {{set categoria="=_params._categoria"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAceptacionNutricion"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set dieta="=base.dieta"}}
      {{set _dieta="=base._dieta"}}
      {{setRef ref="dieta.base.estatus" value="programado"}}
      {{setRef ref="dieta.base._estatus" value="Programado"}}
    {{/update}}
  {{/transform}}

[.#if esRH.]
  {{#transform id="copiarCompatibilidadEmpleoRH"}}
    {{update section="persona" transform="copiarPersona"}}
    {{#update section="base"}}
      {{set declaraOtroTrabajo="='trabajoActual'"}}
      {{set puestoActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.puestoContrato"}}
      {{set puestoPostulado="=calc.concatValueKey(_items[0].puesto.descripcion, _items[0].puesto.codigo)"}}
      {{set codigoPresupuestalActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.codigoPresupuestalGrupo"}}
      {{set codigoPresupuestalPostulado="=calc.concatValueKey(_items[0].estructuraProgramatica.descripcion, _items[0].estructuraProgramatica.codigo)"}}
      {{set unidadAdscripcionActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.unidadAdscripcion"}}
      {{set unidadAdscripcionPostulado="=calc.concatValueKey(_items[0].adscripcion.descripcion, _items[0].adscripcion.codigo)"}}
      {{set fechaAltaActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.fechaAlta"}}
      {{set tipoNombramientoActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.tipoNombramiento"}}
      {{set tipoNombramientoPostulado="=_items2[0].base.descripcionPuesto.base._nombramientoPuesto"}}
      {{set remuneracionMensualActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.remuneracionMensual"}}
      {{set remuneracionMensualPostulado="=_items[0].puesto.sueldo"}}
      {{set partidaClavePresupuestalActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.partidaClavePresupuestal"}}
      {{set ubicacionCentroTrabajoActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.ubicacionCentroTrabajo"}}
      {{set jornadaActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.jornadaLaboral"}}
      {{set jornadaPostulado="=_items2[0].base.condicionEspecificaPuesto.base._jornadaPuesto"}}
      {{set horarioActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.horario"}}
      {{set horarioPostulado="=calc.replaceAll('\n', ', ', _items2[0].base.condicionEspecificaPuesto.base._horarioLaboral)"}}
      {{set riesgoPuestoPostulado="=_items[0].puesto.riesgoPuesto"}}
      {{set tiempoTrasladoActual="=calc.findWhereRef(detalle.experienciaLaboral, 'base.tipoTrabajo', 'trabajoActual').base.tiempoTraslado"}}
    {{/update}}
  {{/transform}}
[./if.]

  {{#transform id="copiarModificarDieta"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set central="=base.central"}}
      {{set _central="=base._central"}}
      {{set cama="=base.cama"}}
      {{set _cama="=base._cama"}}
      {{set dieta="=base.dieta"}}
      {{set _dieta="=base._dieta"}}
      {{set prioridad="=base.prioridad"}}
      {{set _prioridad="=base._prioridad"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarComidaLista"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set dieta="=base.dieta"}}
      {{set _dieta="=base._dieta"}}
      {{setRef ref="dieta.base.estatus" value="completado"}}
      {{setRef ref="dieta.base._estatus" value="Completado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarCobroConsultaExterna"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set consultaExterna="=base.consultaExterna"}}
      {{set _consultaExterna="=base._consultaExterna"}}
      {{set importe="=base.consultaExterna.base.precio"}}
      {{setRef ref="consultaExterna.base.estatus" value="cobrado"}}
      {{setRef ref="consultaExterna.base._estatus" value="Cobrado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarLlegaPacienteConsultaExterna"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set consultaExterna="=base.consultaExterna"}}
      {{set _consultaExterna="=base._consultaExterna"}}
      {{set importe="=base.consultaExterna.base.precio"}}
      {{setRef ref="consultaExterna.base.estatus" value="arribo"}}
      {{setRef ref="consultaExterna.base._estatus" value="Arribo"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarCancelacionSolicitudConsultaExterna"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set consultaExterna="=base.consultaExterna"}}
      {{set _consultaExterna="=base._consultaExterna"}}
      {{set importe="=base.consultaExterna.base.precio"}}
      {{setRef ref="consultaExterna.base.estatus" value="cancelado"}}
      {{setRef ref="consultaExterna.base._estatus" value="Cancelado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAceptacionCirugia"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set cirugia="=base.cirugia"}}
      {{set _cirugia="=base._cirugia"}}
      {{set importe="=base.cirugia.base.precio"}}
      {{setRef ref="cirugia.base.estatus" value="programado"}}
      {{setRef ref="cirugia.base._estatus" value="Programado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarRechazoCirugia"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set cirugia="=base.cirugia"}}
      {{set _cirugia="=base._cirugia"}}
      {{set importe="=base.cirugia.base.precio"}}
      {{setRef ref="cirugia.base.estatus" value="rechazado"}}
      {{setRef ref="cirugia.base._estatus" value="Rechazado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarLlegaPacienteCirugia"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set cirugia="=base.cirugia"}}
      {{set _cirugia="=base._cirugia"}}
      {{set importe="=base.cirugia.base.precio"}}
      {{setRef ref="cirugia.base.estatus" value="arribo"}}
      {{setRef ref="cirugia.base._estatus" value="Arribo"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarCancelacionSolicitudCirugia"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set nivelSocioeconomico="=persona.nivelSocioeconomico"}}
      {{set _nivelSocioeconomico="=persona._nivelSocioeconomico"}}
      {{set cirugia="=base.cirugia"}}
      {{set _cirugia="=base._cirugia"}}
      {{set importe="=base.cirugia.base.precio"}}
      {{setRef ref="cirugia.base.estatus" value="cancelado"}}
      {{setRef ref="cirugia.base._estatus" value="Cancelado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarFarmaciaMezclaRealizada"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set esMezcla="=base.esMezcla"}}
      {{set mezcla="=base.mezcla"}}
      {{set _mezcla="=base._mezcla"}}
      {{setRef condition="=base.esMezcla" ref="mezcla.base.estatus" value="mezclado"}}
      {{setRef condition="=base.esMezcla" ref="mezcla.base._estatus" value="Mezclado"}}
    {{/update}}
  {{/transform}}

  {{#transform id="copiarAceptacionMaterial"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set esMateria="=base.esMaterial"}}
      {{set material="=base.material"}}
      {{set _material="=base._material"}}
      {{setRef ref="material.base.estatus" value="programado"}}
      {{setRef ref="material.base._estatus" value="Programado"}}
    {{/update}}
  {{/transform}}

[.#if esGRP.]
  {{#transform id="copiarFoCon"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set fechaEmision="=moment().format('YYYY-MM-DD')"}}
      {{!-- {{set fechaRequerida="=base.vencimiento"}} --}}
      {{set nombreDependenciaEntidad="=calc.lookupInPreset('app.variableGlobal', 'campo=nombreDependenciaEntidad').valor"}}
    {{/update}}
    {{#update section="totales"}}
      {{set subTotalMinimo="=calc.sum(articulos, 'importeMinimo')"}}
      {{set subTotalMaximo="=calc.sum(articulos, 'importeMaximo')"}}
      {{set ivaMinimo="=calc.sumExpr(articulos, '=calc.tax(importeMinimo, iva)')"}}
      {{set ivaMaximo="=calc.sumExpr(articulos, '=calc.tax(importeMaximo, iva)')"}}
      {{set totalMinimo="=calc.sumExpr(articulos, '=calc.addTax(importeMinimo, iva)')"}}
      {{set totalMaximo="=calc.sumExpr(articulos, '=calc.addTax(importeMaximo, iva)')"}}
    {{/update}}    
    {{update section="articulos" value="=articulos"}}
  {{/transform}}

  {{#transform id="copiarFoConSinTotales"}}
    {{update section="persona" value="=persona"}}
    {{#update section="base"}}
      {{set fechaEmision="=moment().format('YYYY-MM-DD')"}}
      {{!-- {{set fechaRequerida="=base.vencimiento"}} --}}
      {{set nombreDependenciaEntidad="=calc.lookupInPreset('app.variableGlobal', 'campo=nombreDependenciaEntidad').valor"}}
    {{/update}}
    {{update section="articulos" value="=calc.removeKeys(articulos, ['cantidadMinima','cantidadMaxima','importeMinimo','importeMaximo','precioReferencia'])"}}
  {{/transform}}
[./if.]

  {{#report id="diplomaParticipacion" fontSize="15" pageOrientation="landscape" pageMargins="40,40,40,40"}}
    {{#stack}}
      {{image id="logo" url="https://his-imagenes.s3-accelerate.amazonaws.com/logos/hraei3b.png"}}
      {{image id="logoSaludNess" url="https://his-imagenes.s3-accelerate.amazonaws.com/logos/saludNess.png"}}
    {{/stack}}
    {{#stack}}
      {{row image="logo" alignment="center" imageWidth="500"}}
      {{row text=" "}}
      {{row text="El Hospital Regional de Alta Especialidad de Ixtapaluca" alignment="center"}}
      {{row text="otorga la presente" alignment="center"}}
      {{row text=" "}}
      {{row text=" "}}
      {{row text="CONSTANCIA A:" bold="true" alignment="center" fontSize="20" color="#9e2141"}}
      {{row text=" "}}
      {{#box layout="noBorders" width="710"}}
        {{row expr="=persona.nombreCompleto" bold="true" color="white" fillColor="#c29e69" align="center" fontSize="45"}}
      {{/box}}
      {{row text=" "}}
      {{row text="Por su participación como asistente al evento académico de:" alignment="center"}}
      {{row text=" "}}
      {{row expr="=base.inscripcionCurso.base.nombreCurso" bold="true" alignment="center" fontSize="30" color="#9e2141"}}
      {{row text=" "}}
      {{row expr="='Que se llevó a cabo el día '+moment(base.inscripcionCurso.base.desde).format('LL')+','" alignment="center"}}
      {{row expr="=calc.concat('con duración de', base.inscripcionCurso.base.duracion, base.inscripcionCurso.base._tipoDuracion)" alignment="center"}}
      {{row text=" "}}
      {{row expr="=calc.concat('Ixtapaluca, Estado de México a', moment().format('LL')+',')" alignment="center"}}
      {{row text=" "}}
      {{row text=" "}}
      {{row text=" "}}
      {{#columns}}
        {{#column}}
          {{row expr="=base.inscripcionCurso.base._responsableAcademico" alignment="center" bold="true"}}
          {{row text="Responsable Académico" alignment="center"}}
        {{/column}}
        {{#column}}
          {{row expr="=base.inscripcionCurso.base._impartidoPor" alignment="center" bold="true"}}
          {{row text="Profesor Titular del Curso" alignment="center"}}
        {{/column}}
      {{/columns}}
    {{/stack}}
  {{/report}}

  {{action id="infoMomento" hide="true" type="message" width="800" height="800" title="=control._subMoment" message="=calc.momentInfo(control.subMoment).information" label="Información" color="grey" condition="=calc.momentInfo(control.subMoment).information"}}

[.#if esSIC.]
  {{action id="plano" hide="true" type="menu" menu="plano" label="Plano" color="grey" forceReadOnly="true" hideExternalUser="true"}}
  {{#menu id="plano" color="grey"}}
    {{item action="bim" text="BIM"}}
    {{item action="planta" text="Planta"}}
  {{/menu}}  
  {{#action id="bim" hide="true" type="bim360" label="BIM" title="=calc.concat('BIM', _items[0].persona.planta)" bim="=_items[0].persona.bim" color="grey" visibleMode="close" fromSource="persona" fromView="datosUbicacion"}}
    {{param ubicacion="=base.ubicacion"}}
  {{/action}}
  {{#action id="planta" hide="true" type="openPreview" label="Planta" title="Planta" color="grey" visibleMode="close" fromSource="persona" fromView="datosUbicacion"}}
    {{param ubicacion="=base.ubicacion"}}
    {{link title="=calc.concat('Planta', _items[0].persona.planta)" href="=fn('urlPlanta', _items[0].persona.planta)"}}
  {{/action}}
[./if.]

  {{action id="adjuntos" condition="=true" type="openFolder" label="Adjuntos" items="=adjuntos" color="grey" visibleMode="close"}}
  {{action id="notaAdministracionAdjuntosSolicitud" source="notaAdministracionAdjuntosSolicitud" hide="true" transform="copiarAdjuntos" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Administrar Adjuntos" userRole="administrarAdjuntos"}}

  {{#action id="adjuntosDelCurso" condition="=true" type="openFolder" label="Adjuntos del Curso" items="=_items[0].adjuntos" color="grey" visibleMode="close" fromSource="articulo" fromView="todo"}}
    {{param codigo="=info.base.codigo"}}
  {{/action}}

  {{action id="menuAdjuntos" hide="true" type="menu" menu="menuAdjuntos" label="Adjuntos" color="grey"}}
  {{#menu id="menuAdjuntos" color="grey"}}
    {{item action="adjuntos" text="Ver Adjuntos"}}
    {{item action="notaAdministracionAdjuntosSolicitud" text="Administrar Adjuntos" userRole="administrarAdjuntos"}}
  {{/menu}}  

  {{#menu id="menuFlujo" color="grey" hideExternalUser="true"}}
    {{item action="verSubProcesos" text="Ver Sub Procesos" userRole="verFlujoSubProcesos"}}
    {{item action="flujoResumen" text="Flujo Resumen" beginGroup="true" userRole="verFlujoResumen"}}
    {{item action="flujoGeneral" text="Flujo General" userRole="verFlujoGeneral"}}
    {{item action="flujoEjecucion" text="Flujo Ejecución" userRole="verFlujoEjecucion"}}
  {{/menu}}  
  {{action  id="flujoResumen"   type="bpmn" color="green"  label="Flujo Resumen"   title="_params._name||'Resumen'"               visibleMode="close" bpmn="=calc.first(fn('bpmn', 'resumen')).fileName" moment="=fn('resumenMomento', _updated.moment)" moments="=_moment"}}
  {{action  id="flujoGeneral"   type="bpmn" color="orange" label="Flujo General"   title="_params._name||'Proceso General'"       visibleMode="close" bpmn="=calc.first(fn('bpmn', 'general')).fileName" moment="=_updated.moment" moments="=_moment" condition="=!calc.in(_updated.moment, ['entregado','finalizado'])"}}
  {{#action id="flujoEjecucion" type="bpmn" color="blue"   label="Flujo Ejecución" title="_params._name||'Sub Proceso Ejecución'" visibleMode="close" bpmn="=calc.first(fn('bpmn', _params.base.tipoSolicitud, _params.base.subTipoSolicitud)).fileName" moment="=control.subMoment||_updated.moment" moments="=_subMoment||_moment" condition="=calc.in(_updated.moment,['programado','programado2','entregado','finalizado','autorizado','incumplimiento'])||control.subMoment" fromSource="solicitud" fromView="activos" subProcess="=_items" subProcessLabel="Sub Procesos" subProcessAction="verSubProcesos"}}
    {{param request="=_id"}}
  {{/action}}

  {{!-- {{#action id="infoCentralMezclas" type="sub-link" label="Diagrama" visibleMode="close" color="grey"}}
    {{link newTab="true" href="https://docs.google.com/document/d/1wZOiOIpWw8NDMN1usSA6Dm1WfqEt9rH4KtapbOFIoVo/edit?usp=sharing" name="Central Mezclas"}}
  {{/action}}     --}}

[.#if esSIC.]
  {{action id="menuFlujo" hide="true" type="menu" menu="menuFlujo" label="Flujo" color="grey" forceReadOnly="true"}}
[./if.]
[.#if esRH.]
  {{action id="menuFlujo" hide="true" type="menu" menu="menuFlujo" label="Flujo" color="grey" forceReadOnly="true"}}
[./if.]  

  {{#action id="analisisSIC" type="sub-link" label="Análisis SIC" isBrowserAction="true" visibleMode="close" beginGroup="true"}}
    {{link newTab="true" href="/_quickSight/visor?id=13489b84-b4e3-4b5c-bfd1-f6dfe04366e2" name="SIC"}}
  {{/action}}    

{{!--   {{#action id="impresionEtiquetasAlimentacionPaciente" type="sub-link" label="Impresión Etiquetas" isBrowserAction="true" visibleMode="close" beginGroup="true"}}
    {{link newTab="true" href="https://www.google.com/"}}
  {{/action}}     --}}

  {{!-- Tableros Historial --}}
  {{#action id="verHistorial" hide="true" type="sub-link" label="Historial" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Historial'" name="=calc.concat('Historial',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Historial',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}
  {{#action id="verEntregados" hide="true" type="sub-link" label="Entregados" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Entregados'" name="=calc.concat('Entregados',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Rechazados',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}  
  {{#action id="verAsignados" hide="true" type="sub-link" label="Asignados" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Asignados'" name="=calc.concat('Asignados',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Rechazados',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}  
  {{#action id="verMinistrados" hide="true" type="sub-link" label="Ministrados" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Ministrados'" name="=calc.concat('Ministrados',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Rechazados',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}  
  {{#action id="verDevueltos" hide="true" type="sub-link" label="Devueltos" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Devueltos'" name="=calc.concat('Devueltos',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Rechazados',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}  
  {{#action id="verRechazados" hide="true" type="sub-link" label="Rechazados" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Rechazados'" name="=calc.concat('Rechazados',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Rechazados',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}  
  {{#action id="verCancelados" hide="true" type="sub-link" label="Cancelados" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Cancelados'" name="=calc.concat('Cancelados',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Cancelados',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}  
  {{#action id="verSuspendidos" hide="true" type="sub-link" label="Suspendidos" isBrowserAction="true" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{link href="'/solicitud/'+_params.service+'Suspendidos'" name="=calc.concat('Suspendidos',_params._service, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=calc.concat('Suspendidos',_params._service)" newTab="true" error="=moment(hasta).diff(moment(desde), 'days')>30?'La ventana de tiempo de esta consulta no puede exceder a 30 días.':null"}}
  {{/action}}
  {{!-- Hasta Aqui --}}

  {{action id="menuExpediente" hide="true" type="menu" menu="menuExpediente" label="Expediente" color="green" forceReadOnly="true"}}
  {{#menu id="menuExpediente" color="green"}}
    {{item action="expedienteActual" text="Clínico - Administrativo"}}
    {{item action="expedienteOficial" text="Clínico"}}
    {{item action="expedienteAnterior" text="Anterior"}}
  {{/menu}}  

  {{#action id="expedienteActual" hide="true" type="sub-link" label="Expediente Clínico - Administrativo" color="green" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde" value="='2019-08-18'"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{#link href="='/nota/lista'" name="=calc.concat('Exp. Clínico Admin:', persona.nombreCompleto, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=persona.nombreCompleto"}}
      {{param id="persona.id"}}
    {{/link}}
  {{/action}}

  {{#action id="expedienteOficial" hide="true" type="sub-link" label="Expediente Clínico" color="teal" visibleMode="close"}}
    {{ask field="desde" type="date" label="Desde" value="='2019-08-18'"}}
    {{ask field="hasta" type="date" label="Hasta"}}
    {{#link href="='/nota/lista'" name="=calc.concat('Expediente Clínico:', persona.nombreCompleto, '- Desde:', moment(desde).format('DD/MMM/YYYY'), 'Hasta:', moment(hasta).format('DD/MMM/YYYY'))" title="=persona.nombreCompleto"}}
      {{param id="persona.id"}}
      {{param esOficial="=true"}}
    {{/link}}
  {{/action}}

  {{#action id="expedienteAnterior" hide="true" type="openPreview" label="Expediente Anterior" color="blue" visibleMode="close"}}
    {{link href="=calc.firstLike(adjuntos, 'nombre', 'Reporte ECE').url" else="='http://hraei-ea.saludness.com/reportes/pdf.php?CURP='+persona.clave"}}
  {{/action}} 

  {{#action id="cobrosRelacionados" hide="true" type="quickReport" label="Cobros Relacionados" color="green" source="notaCobro" view="cobros"}}
    {{param solicitud="=_id"}}
    {{#grid exportToExcel="true" allowSearch="true" allowRefresh="true" wordWrapEnabled="true" pdfFontSize="6" columnAutoWidth="wordWrapEnabled"}}
      {{column field="_name" label="Movimiento"}}
      {{column field="_created.date" label="Fecha Cobro" type="date" format="DD/MMM/YYYY hh:mma"}}
      {{column field="persona.nombreCompleto" label="Nombre"}}
      {{column field="aplicacion.importe" label="Importe" type="number" format="currency" summaryType="sum" summaryFormat="currency" summaryPrecision="2"}}
      {{column field="_formaPago" label="Forma Pago"}}
    {{/grid}}
  {{/action}}

  {{action id="gasto"  source="notaRegistroGasto"  label="Gasto"  transform="copiarSolicitud"      hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true"}} 
  {{action id="evento" source="notaRegistroEvento" label="Evento" transform="copiarRegistroEvento" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true"}} 
[.#if esSIC.]
  {{action id="asignar" hide="true" type="menu" menu="asignar" label="Asignar" color="blue-grey"}}
  {{#menu id="asignar" color="blue-grey"}}
    {{item action="notaAsignacionAcceso" text="Acceso a la Solicitud"}}
    {{item action="notaAsignacionAccesoLote" text="Acceso en Lote"}}
    {{item action="notaAsignacionManualTiempoEjecucion" text="Tiempo Ejecución (Manual)"}}
  {{/menu}}

  {{#action id="notaAsignacionAcceso" source="notaAsignacionAcceso" label="Asignar" transform="copiarAsignacionAcceso" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" userRole="asignacionAcceso" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{#action id="notaAsignacionAccesoLote" source="notaAsignacionAccesoLote" label="Asignar" transform="copiarAsignacionAccesoLote" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" userRole="asignacionAcceso" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion" condition="=_params.base.servicio=='aseo'"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{action id="notaAsignacionManualTiempoEjecucion" source="notaAsignacionManualTiempoEjecucion" label="Asignar" transform="copiarAsignacionManualTiempoEjecucion" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" userRole="asignacionManualTiempoEjecucion" condition="=_updated.moment=='enEjecucion'"}} 
  [./if.]
  {{action id="menuInsumos" hide="true" type="menu" menu="menuInsumos" label="Insumos" color="blue-grey"}}
  {{#menu id="menuInsumos" color="blue-grey"}}
    {{item action="asignarInsumos" text="Asignar Insumos"}}
    {{item action="consumirInsumos" text="Consumir Insumos" beginGroup="true"}}
    {{item action="salidaInsumosPorDano" text="Salida Insumos por Daño"}}
    {{item action="devolverInsumos" text="Devolver Insumos" beginGroup="true"}}
    {{item action="verInsumosAsignados" text="Ver Insumos Asignados" beginGroup="true"}}
    {{item action="insumosUtilizados" text="Insumos Utilizados" beginGroup="true"}}
  {{/menu}}  

  {{action id="asignarInsumos"        source="notaAsignacionInsumos" label="Asignar Insumos"  transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true"}}
  {{action id="consumirInsumos"       source="notaConsumoInsumos"    label="Consumir Insumos" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true"}}
  {{action id="salidaInsumosPorDano"  source="notaConsumoInsumos"    label="Salida Insumos por Daño" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" subType="salidaInsumosPorDano" subTypeName="Salida Insumos por Daño"}}
  {{#action id="devolverInsumos"      source="notaDevolucionInsumos" label="Devolver Insumos" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" fromSource="mov" fromView="sugerirInventarioUbicacion" toSection="articulos"}}
    {{param ubicacion="=_id"}}
  {{/action}}
  {{#action id="insumosUtilizados"   source="notaInsumosUtilizados"    label="Insumos Utilizados" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" fromSource="articulo" fromView="sugerirInsumosUtilizados" toSection="articulos" condition="=base.servicio=='aseo'"}}
    {{param servicio="='aseo'"}}
  {{/action}}
  {{#action id="verInsumosAsignados" type="sub-link" label="Ver Insumos Asignados" btnSolid="true" color="primary" visibleMode="close"}}
    {{#link href="'/_invSolicitud/cubo'" name="=_created.short" title="=_created.short"}}
      {{param id="_id"}}
    {{/link}}
  {{/action}}

  {{!-- {{#action id="verCandidato" type="sub-link" label="Candidato" color="green" visibleMode="close"}}
    {{link href="'/persona/portalCandidato?id='+persona.id" name="=persona.nombreCompleto" title="Portal del Candidato"}}
  {{/action}} --}}

  {{#action id="listaAlumnos" label="Lista Alumnos" hide="true" type="sub-link" visibleMode="close" color="green"}}
    {{#link href="'/solicitud/listaAlumnos'" name="=calc.concat('Lista Alumnos', _created.short)" title="='Lista Alumnos'"}}
      {{param request="=_id"}}
    {{/link}}
  {{/action}}

  {{#action id="listaAlumnosEvaluacion" label="Lista Alumnos" hide="true" type="sub-link" visibleMode="close" color="green"}}
    {{#link href="'/solicitud/listaAlumnosEvaluacion'" name="=calc.concat('Lista Alumnos', _created.short)" title="='Lista Alumnos'"}}
      {{param request="=_id"}}
    {{/link}}
  {{/action}}

  {{#action id="verSubProcesos" label="Sub Procesos" hide="true" type="sub-link" visibleMode="close" color="green"}}
    {{#link href="'/solicitud/subProcesos'" name="=calc.concat('Sub Procesos', _created.short)" title="='Sub Procesos'"}}
      {{param request="=_id"}}
    {{/link}}
  {{/action}}

  {{action id="bitacora" hide="true" type="menu" menu="bitacora" label="Ver" color="green"}}
  {{#menu id="bitacora" color="green"}}
    {{item action="verBitacora" text="Bitácora"}}
[.#if esSIC.]
    {{item action="imprimirBitacora" text="Reporte de una Solicitud o Actividad Programada Específica" beginGroup="true"}}
[.else.]
    {{item action="imprimirBitacora" text="Imprimir Bitácora" beginGroup="true"}}
[./if.]
  {{/menu}}  

  {{action id="bitacoraActivo" hide="true" type="menu" menu="bitacoraActivo" label="Ver" color="green"}}
  {{#menu id="bitacoraActivo" color="green"}}
    {{item action="verBitacora" text="Bitácora"}}
    {{item action="verArticulo" text="Información del Activo"}}
[.#if esSIC.]    
    {{item action="verProcedimientosAsignados" text="Procedimientos Mantenimiento"}}
    {{item action="imprimirBitacora" text="Reporte de una Solicitud o Actividad Programada Específica" beginGroup="true"}}
[.else.]
    {{item action="imprimirBitacora" text="Imprimir Bitácora" beginGroup="true"}}
[./if.]    
  {{/menu}}  

  {{action id="bitacoraAdquisiciones" hide="true" type="menu" menu="bitacoraAdquisiciones" label="Ver" color="green"}}
  {{#menu id="bitacoraAdquisiciones" color="green"}}
    {{item action="verBitacora" text="Bitácora"}}
    {{item action="verInventarioParent" text="Inventario Pendiente"}}
    {{item action="verProveedoresParticipantes" text="Proveedores Participantes" beginGroup="true"}}
    {{item action="verConsultaCotizaciones" text="Consulta Ofertas Económicas"}}
    {{item action="verAnalisisCotizaciones" text="Análisis Ofertas Económicas"}}
    {{item action="verSeleccionProveedor" text="Selección Proveedor"}}
[.#if esSIC.]    
    {{item action="imprimirBitacora" text="Reporte de una Solicitud o Actividad Programada Específica" beginGroup="true"}}
[.else.]
    {{item action="imprimirBitacora" text="Imprimir Bitácora" beginGroup="true"}}
[./if.]    
  {{/menu}}  

  {{#action id="verBitacora" label="Bitácora" hide="true" type="sub-link" visibleMode="close" color="green" hideExternalUser="true"}}
    {{#link href="'/nota/lista'" name="=calc.concat('Solicitud', base._tipoSolicitud,_created.folio)" title="=calc.concat('Solicitud', base._tipoSolicitud,_created.folio)"}}
      {{param request="=_id"}}
    {{/link}}
  {{/action}}
  {{#action id="verArticulo" label="Artículo" hide="true" type="openPreview" visibleMode="close" color="green" hideExternalUser="true" condition="=articulo.id"}}
    {{link href="'/doc/articulo/'+articulo.id" name="=calc.concat('Solicitud', base._tipoSolicitud,_created.folio)" title="=calc.concat('Solicitud', base._tipoSolicitud,_created.folio)"}}
  {{/action}}
  {{#action id="verProveedoresParticipantes" label="Proveedores Participantes" hide="true" type="sub-link" visibleMode="close" color="green" hideExternalUser="true" fromSource="notaRegistroCotizacionProveedor" fromView="listaProveedores"}}
    {{param request="=_id"}}
    {{#link href="'/persona/proveedores'" name="=calc.concat('Proveedores Participantes', base._tipoSolicitud,_created.folio)" title="=calc.concat('Proveedores Participantes', base._tipoSolicitud,_created.folio)"}}
      {{param ids="=_.pluck(_items, 'proveedor')||'(null)'"}}
    {{/link}}
  {{/action}}
  {{#action id="verConsultaCotizaciones" label="Consulta Ofertas Económicas" hide="true" type="sub-link" visibleMode="close" color="green" hideExternalUser="true"}}
    {{#link href="'/nota/lista'" name="=calc.concat('Ofertas Económicas', base._tipoSolicitud,_created.folio)" title="=calc.concat('Ofertas Económicas', base._tipoSolicitud,_created.folio)"}}
      {{param request="=_id"}}
      {{param tipo="notaRegistroCotizacionProveedor"}}
    {{/link}}
  {{/action}}
  {{#action id="verAnalisisCotizaciones" label="Análisis Ofertas Económicas" hide="true" type="sub-link" visibleMode="close" color="green" hideExternalUser="true"}}
    {{#link href="'/_cotizaciones/cubo'" name="=calc.concatDash('Ofertas Económicas', base._tipoSolicitud,_created.folio)" title="=calc.concatDash('Ofertas Económicas', base._tipoSolicitud,_created.folio)"}}
      {{param request="=_id"}}
    {{/link}}
  {{/action}}
  {{#action id="imprimirBitacora" report="preliminar" type="print-all-log" frontPage="preliminar" source="nota" view="todo" label="Imprimir Bitácora" color="grey" visibleMode="close" forceReadOnly="true" fromSource="solicitud" fromView="hojaFrontal" hideExternalUser="true"}}
    {{param request="=_id"}}
  {{/action}}
  {{#action id="verProcedimientosAsignados" label="Procedimientos Mantenimiento" hide="true" type="sub-link" visibleMode="close" color="green" hideExternalUser="true" condition="=info.notaAsignacionAcceso.base.procedimientoMantenimiento"}}
    {{#link href="'/articulo/lista'" name="=calc.concat('Procedimientos Mantenimiento', base._tipoSolicitud,_created.folio)" title="=calc.concat('Procedimientos Mantenimiento', base._tipoSolicitud,_created.folio)"}}
      {{param ids="=info.notaAsignacionAcceso.base.procedimientoMantenimiento"}}
    {{/link}}
  {{/action}}

  {{#action id="verSeleccionProveedor" label="Ver Selección" hide="true" type="sub-link" visibleMode="close" color="green" hideExternalUser="true" condition="=info.registroSeleccionProveedor"}}
    {{#link href="'/nota/lista'" name="=calc.concat('Solicitud', base._tipoSolicitud,_created.folio)" title="=calc.concat('Solicitud', base._tipoSolicitud,_created.folio)"}}
      {{param notaId="=info.registroSeleccionProveedor"}}
    {{/link}}
  {{/action}}

  {{#action id="controlEntregaCeye" label="Control Entrega CEYE" hide="true" type="sub-link" visibleMode="close" color="green" btnSolid="true"}}
    {{#link href="'/nota/lista'" name="=calc.concat4('Control Entrega CEYE', persona.nombreCompleto)" title="Control Entrega CEYE"}}
      {{param request="=_id"}}
      {{param tipo="notaPorEntregarDirecto"}}
      {{param subTipo="entregaCeye"}}
    {{/link}}
  {{/action}}
  {{#action id="verExpedienteCurso" hide="true" type="sub-link" label="Expediente Curso" color="green" visibleMode="close"}}
    {{#link href="='/nota/lista'" name="=calc.concat('Curso -',base.nombreCorto)" title="=calc.concat('Curso -',base.nombreCorto)"}}
      {{param request="_id"}}
    {{/link}}
  {{/action}}
  {{#action id="verAlumnosCurso" hide="true" type="sub-link" label="Alumnos" color="green" visibleMode="close"}}
    {{#link href="='/solicitud/alumnosCurso'" name="=calc.concat('Alumnos -',base.nombreCorto)" title="=calc.concat('Alumnos -',base.nombreCorto)"}}
      {{param curso="_id"}}
    {{/link}}
  {{/action}}
  {{#action id="verEvaluacionesCurso" hide="true" type="sub-link" label="Evaluaciones de Alumnos" color="green" visibleMode="close"}}
    {{#link href="='/notaEvaluacionCurso/lista'" name="=calc.concat('Evaluaciones -',base.nombreCorto)" title="=calc.concat('Evaluaciones -',base.nombreCorto)"}}
      {{param curso="_id"}}
    {{/link}}
  {{/action}}
  {{#action id="verInvestigacion" label="Investigación" hide="true" type="openPreview" visibleMode="close" color="green"}}
    {{link href="'/doc/investigacion/'+base.protocoloInvestigacion.base.investigacion" name="=base.protocoloInvestigacion.base._investigacion" title="=base.protocoloInvestigacion.base._investigacion"}}
  {{/action}}
{{!--   {{#action id="verInvestigacion" hide="true" type="sub-link" label="Investigación" color="green" visibleMode="close"}}
    {{#link href="='/investigacion/lista'" name="=base.protocoloInvestigacion.base._investigacion" title="=base.protocoloInvestigacion.base._investigacion"}}
      {{param _id="=base.protocoloInvestigacion.base.investigacion"}}
    {{/link}}
  {{/action}} --}}
  {{#action id="verExpedienteInvestigacion" hide="true" type="sub-link" label="Expediente Investigación" color="green" visibleMode="close"}}
    {{#link href="='/nota/lista'" name="=calc.concat('Protocolo Investigación -',base.nombreCorto)" title="=calc.concat('Investigación -',base.nombreCorto)"}}
      {{param request="_id"}}
    {{/link}}
  {{/action}}
  {{#action id="verPacientesVinculados" hide="true" type="sub-link" label="Pacientes" color="green" visibleMode="close"}}
    {{#link href="='/vinculoInterno/pacientes'" name="=calc.concat('Pacientes -',base.nombreCorto)" title="=calc.concat('Pacientes -',base.nombreCorto)"}}
      {{param solicitud="_id"}}
    {{/link}}
  {{/action}}
  {{#action id="verInvestigadoresVinculados" hide="true" type="sub-link" label="Investigadores" color="green" visibleMode="close"}}
    {{#link href="='/vinculoInterno/investigadores'" name="=calc.concat('Investigadores -',base.nombreCorto)" title="=calc.concat('Investigadores -',base.nombreCorto)"}}
      {{param solicitud="_id"}}
    {{/link}}
  {{/action}}

  {{#action id="verInventarioPersona" type="sub-link" label="Ver Inventario" color="grey" visibleMode="close"}}
    {{#link href="'/_invUbicacion/cubo'" name="=_params.persona.nombreCompleto" title="=_params.persona.nombreCompleto"}}
      {{param id="_params.persona.id"}}
    {{/link}}
  {{/action}}

  {{#action id="verInventarioParent" type="sub-link" label="Ver Inventario" color="grey" visibleMode="close"}}
    {{#link href="'/_invPersona2/cubo'" name="=_created.short" title="=_created.short"}}
      {{param id="=_parent.id"}}
    {{/link}}
  {{/action}}

  {{#action id="notasServicio" hide="true" type="sub-link" label="Notas Servicio" color="indigo" isBrowserAction="true" visibleMode="close"}}
    {{#link href="'/nota/servicio'" name="='Notas Servicio'" title="='Servicio'"}}
      {{param servicio="_params.service"}}
    {{/link}}
  {{/action}}  

  {{!-- estan en el tablero "solicitud.lista" --}}
[.#if esHRAEI.]
  {{action id="notaAnestesiologoRequerido" source="notaAnestesiologoRequerido" label="Anestesiólogo Requerido" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=fn('esServicioQx', base.tipoSolicitud)" userRole="jefeAnestesiologia"}}
[./if.]

[.#if esRH.]
  {{action id="notaDescartoCandidato"         source="notaDescartoCandidato"        label="Descartar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="solicitudRH" hide="true" type="menu" menu="solicitudRH" label="Solicitar" color="deep-orange"}}
  {{#menu id="solicitudRH" color="deep-orange"}}
    {{item action="notaSolicitudDocumentacion" text="Documentacion"}}
    {{item action="notaSolicitudEvaluacion" text="Evaluaciones"}}
  {{/menu}}
[./if.]

  {{action id="pruebasPsicometricas" hide="true" type="menu" menu="pruebasPsicometricas" label="Pruebas Psicométricas" color="deep-orange"}}
  {{#menu id="pruebasPsicometricas" color="deep-orange"}}
    {{item action="notaEntrevistaPsicologicaRH" text="Entrevista Psicológica"}}
    {{item action="notaReporteIntegralRH" text="Reporte Integral"}}
    {{item action="notaDictamenEvaluacionRH" text="Dictamen Evaluación"}}
    {{item action="notaEntregaResultadosRH" text="Entrega Resultados"}}
  {{/menu}}

  {{action id="notaAnalisisCurriculumRH" source="notaAnalisisCurriculumRH" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Análisis Curriculum"}}
  {{action id="notaSolicitudDocumentacion" source="notaSolicitudDocumentacion" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Documentación"}}
  {{action id="notaSolicitudEvaluacion" source="notaSolicitudEvaluacion" hide="true" transform="copiarSubMoment" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Evaluaciones"}}
  {{action id="notaEntrevistaJefeInmediatoRH" source="notaEntrevistaJefeInmediatoRH" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Entrevista Jefe Inmediato"}}

  {{action id="notaEntrevistaPsicologicaRH" source="notaEntrevistaPsicologicaRH" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Entrevista Psicológica"}}
  {{action id="notaReporteIntegralRH" source="notaReporteIntegralRH" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Reporte Integral"}}
  {{action id="notaDictamenEvaluacionRH" source="notaDictamenEvaluacionRH" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Dictamen Evaluación"}}
  {{action id="notaEntregaResultadosRH" source="notaEntregaResultadosRH" hide="true" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Entrega Resultados"}}

  {{action id="notaPreoperatoriaProcedimientoSinAnestesia" source="notaPreoperatoria" label="Nota Preoperatoria" transform="copiarSolicitudCirugia" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params._updated.moment, ['pendiente','solicitado','programado','pre'])&&base.tipoSolicitud=='procedimiento'&&base.requiereAnestesiologo=='no'" userRole="medico"}}
  {{action id="notaPostoperatoriaProcedimientoSinAnestesia" source="notaPostoperatoria" label="Postoperatoria" transform="copiarSolicitudCirugia" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params._updated.moment, ['trans','post'])&&base.tipoSolicitud=='procedimiento'&&base.requiereAnestesiologo=='no'" userRole="medico"}} 
  {{action id="notaAdjuntosSolicitud" source="notaAdjuntosSolicitud" label="Adjuntar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaEdicionSolicitud" source="notaEdicionSolicitud" label="Editar Solicitud" transform="copiarEdicionSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaEdicionSolicitudProtocoloInvestigacion" source="notaEdicionSolicitudProtocoloInvestigacion" label="Editar" transform="copiarEdicionSolicitudProtocoloInvestigacion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{!-- {{action id="notaCancelacionUtilizacion" source="notaCancelacionUtilizacion" label="Cancelación Utilización" transform="copiarUtilizado" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}} --}}
  {{action id="diplomaParticipacion" label="Constancia Participación" type="report-pdf" report="diplomaParticipacion" hide="true" type="add-subdoc" visibleMode="close" color="grey" onlyPost="true" btnSolid="true" condition="=calc.in(_params.estatus,['post','finalizado'])"}}
  {{action id="bajaAlumno" source="notaCancelacionSolicitud" label="Baja Alumno" subType="bajaAlumno" subTypeName="Baja Alumno" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=!calc.in(_params.estatus,['post','finalizado'])"}}
  {{action id="notaLibreInvestigacion" source="notaLibreInvestigacion" label="Nota Libre Investigación" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaEvaluacionInvestigacion" source="notaEvaluacionInvestigacion" label="Evaluación Investigación" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}

  {{action id="notaPreoperatoria" source="notaPreoperatoria" label="Nota Preoperatoria" transform="copiarSolicitudCirugia" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params._updated.moment, ['pendiente','solicitado','programado','pre'])"}}
  {{action id="notaValoracionPreanestesica" source="notaValoracionPreanestesica" label="Valoración Preanestésica" transform="copiarSolicitudCirugia" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params._updated.moment, ['pendiente','solicitado','programado','pre'])"}}
  {{action id="notaPostoperatoria" source="notaPostoperatoria" label="Postoperatoria" transform="copiarSolicitudCirugia" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params._updated.moment, ['trans','post'])"}}
  {{action id="notaPostanestesica" source="notaPostanestesica" label="Postanestésica" transform="copiarSolicitudCirugia" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params._updated.moment, ['trans','post'])"}}  

  {{action id="cancelacionParcialAdquisicion" source="notaRegistroCancelacionParcialAdquisicion" label="Cancelación Parcial" transform="copiarRegistroProveedor" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="anular" source="notaCancelacionSolicitud" label="Anular" transform="copiarSolicitud" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=calc.in(_params.estatus,['pendiente','programado'])&&_params._created.user==user.id"}}
  {{action id="anular2" source="notaCancelacionSolicitud" label="Cancelar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" hideExternalUser="true" condition="=calc.in(_params.estatus,['pendiente','programado'])&&_params._created.user==user.id"}}
  {{action id="notaNoProcedeSolicitud" source="notaCancelacionSolicitud" subType="noProcede" subTypeName="No Procede Solicitud" label="No Procede" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaCancelacionSolicitud" source="notaCancelacionSolicitud" label="Cancelar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" hideExternalUser="true" userRole="cancelacionSolicitud"}}
  {{action id="notaRetornoSolicitud" source="notaRetornoSolicitud" label="Retornar Solicitud" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" hideExternalUser="true"}}
  {{action id="cancelacionFusionado" source="notaCancelacionSolicitud" label="Cancelar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" condition="=join.fusionadoEn&&join._readOnly"}}
  {{action id="notaRechazoSolicitud" source="notaRechazoSolicitud" label="Rechazar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" forceReadOnly="true"}}
  {{action id="notaRechazoEsCita" source="notaRechazoSolicitud" label="Rechazar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" forceReadOnly="true" condition="=fn('esSolicitudTipoCita', _params.base.tipoSolicitud, _params._updated.moment)"}}
  {{action id="notaFragmentacionSolicitud" source="notaFragmentacionSolicitud" label="Fragmentar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaAvanceSolicitud" source="notaAvanceSolicitud" label="Reportar Avance" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaAvanceEsTarea" source="notaAvanceSolicitud" label="Reportar Avance" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true" condition="=fn('esSolicitudTipoTarea', _params.base.tipoSolicitud, _params._updated.moment)"}}
  {{action id="notaFacturaSolicitud" source="notaFacturaSolicitud" label="Facturar" transform="copiarFacturaSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}

  {{action id="notaJustificacionAlumno" source="notaJustificacionAlumno" label="Justificación Alumno" transform="copiarAlumno" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaBajaAlumno" source="notaBajaAlumno" label="Baja Alumno" transform="copiarAlumno" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaEvaluacionInstructor" source="notaEvaluacionInstructor" label="Evaluación Instructor" transform="copiarAlumno" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaEvaluacionCompetencias" source="notaEvaluacionCompetencias" label="Evaluación Competencias" transform="copiarAlumno" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}

  {{action id="notaEvaluacion" source="notaEvaluacion" hide="true" transform="copiarEvaluacion" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Responder Evaluación" btnSolid="true"}}
  {{action id="notaEvaluacionVigente" source="notaEvaluacion" hide="true" transform="copiarEvaluacion" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Responder Evaluación" btnSolid="true" condition="=base.vencimiento>moment().format()"}}
  {{action id="notaEntregaDocumentacion" source="notaEntregaDocumentacion" hide="true" transform="copiarEntregaDocumentacion" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Entregar Documentación" btnSolid="true"}}

  {{action id="notaRecoleccionRopa" source="notaRecoleccionRopa" label="Recolectar Ropa" transform="copiarRecoleccionRopa" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}}
  {{action id="notaConteoRopa" source="notaConteoRopa" label="Contar Ropa" transform="copiarConteoRopa" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}}
  {{action id="notaEntregaRopa" source="notaEntregaRopa" label="Entregar Ropa" transform="copiarEntregaRopa" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}} 
  {{#action id="notaRechazoRopa" source="notaRechazoRopa" label="Rechazar Ropa" transform="copiarRechazoRopa" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="ropa"}}
  {{/action}}
  {{action id="notaDevolucionRopa" source="notaDevolucionRopa" label="Devolver Ropa" transform="copiarDevolucionRopa" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}} 
  {{action id="copiarLoteMezcla" label="Copiar Lote" hide="true" type="copy-to-clipboard" visibleMode="close" color="grey" btnSolid="true" value="=base.loteMezcla" message="Lote Copiado" onlyPost="true"}}
  {{#action id="porElaborarDesayuno" label="Elaborar Desayuno" transform="copiarCategoriaPersona" source="notaPorElaborar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="desayuno"}}
    {{param _categoria="Desayuno"}}
  {{/action}}
  {{#action id="porElaborarMediaManana" label="Elaborar Media Mañana" transform="copiarCategoriaPersona" source="notaPorElaborar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="mediaManana"}}
    {{param _categoria="Media Mañana"}}
  {{/action}}
  {{#action id="porElaborarComida" label="Elaborar Comida" transform="copiarCategoriaPersona" source="notaPorElaborar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="comida"}}
    {{param _categoria="Comida"}}
  {{/action}}
  {{#action id="porElaborarMediaTarde" label="Elaborar Media Tarde" transform="copiarCategoriaPersona" source="notaPorElaborar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="mediaTarde"}}
    {{param _categoria="Media Tarde"}}
  {{/action}}
  {{#action id="porElaborarCena" label="Elaborar Cena" transform="copiarCategoriaPersona" source="notaPorElaborar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="cena"}}
    {{param _categoria="Cena"}}
  {{/action}}

  {{#action id="porEntregarDesayuno" label="por Entregar Desayuno" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="elaboracion"}}
    {{param categoria="desayuno"}}
    {{param _categoria="Desayuno"}}
  {{/action}}
  {{#action id="porEntregarMediaManana" label="por Entregar Media Mañana" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="elaboracion"}}
    {{param categoria="mediaManana"}}
    {{param _categoria="Media Mañana"}}
  {{/action}}
  {{#action id="porEntregarComida" label="por Entregar Comida" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="elaboracion"}}
    {{param categoria="comida"}}
    {{param _categoria="Comida"}}
  {{/action}}
  {{#action id="porEntregarMediaTarde" label="por Entregar Media Tarde" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="elaboracion"}}
    {{param categoria="mediaTarde"}}
    {{param _categoria="Media Tarde"}}
  {{/action}}
  {{#action id="porEntregarCena" label="por Entregar Cena" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="elaboracion"}}
    {{param categoria="cena"}}
    {{param _categoria="Cena"}}
  {{/action}}

  {{#action id="reciboDesayuno" label="Recibo Desayuno" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entrega"}}
    {{param categoria="desayuno"}}
    {{param _categoria="Desayuno"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="reciboMediaManana" label="Recibo Media Mañana" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entrega"}}
    {{param categoria="mediaManana"}}
    {{param _categoria="Media Mañana"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="reciboComida" label="Recibo Comida" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entrega"}}
    {{param categoria="comida"}}
    {{param _categoria="Comida"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="reciboMediaTarde" label="Recibo Media Tarde" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entrega"}}
    {{param categoria="mediaTarde"}}
    {{param _categoria="Media Tarde"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="reciboCena" label="Recibo Cena" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entrega"}}
    {{param categoria="cena"}}
    {{param _categoria="Cena"}}
    {{param central="=_params.central"}}
  {{/action}}

  {{#action id="ministrarDesayuno" label="Ministrar Desayuno" transform="copiarCategoriaPersona" source="notaPorMinistrar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorMinistrar" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="desayuno"}}
    {{param _categoria="Desayuno"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}
  {{#action id="ministrarMediaManana" label="Ministrar Media Mañana" transform="copiarCategoriaPersona" source="notaPorMinistrar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorMinistrar" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="mediaManana"}}
    {{param _categoria="Media Mañana"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}
  {{#action id="ministrarComida" label="Ministrar Comida" transform="copiarCategoriaPersona" source="notaPorMinistrar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorMinistrar" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="comida"}}
    {{param _categoria="Comida"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}
  {{#action id="ministrarMediaTarde" label="Ministrar Media Tarde" transform="copiarCategoriaPersona" source="notaPorMinistrar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorMinistrar" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="mediaTarde"}}
    {{param _categoria="Media Tarde"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}
  {{#action id="ministrarCena" label="Ministrar Cena" transform="copiarCategoriaPersona" source="notaPorMinistrar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorMinistrar" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="cena"}}
    {{param _categoria="Cena"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}

  {{action id="modificarDieta" source="notaSolicitudDieta" label="Modificar Dieta" transform="copiarModificarDieta" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}

  {{#action id="porElaborarMezclas" label="Elaborar Mezclas" transform="copiarCategoriaPersona" source="notaPorElaborar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="mezcla"}}
    {{param _categoria="Mezclas"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porPrepararMezcla" label="Preparar y Entregar Mezcla" transform="copiarPrepararMezcla" source="notaPorPrepararEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMaterial" toSection="materiales" color="deep-orange" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param solicitud="=_id"}}
    {{param servicio="=_params.service"}}
    {{param momento="=_params.momento"}}
    {{param categoria="mezcla"}}
    {{param _categoria="Mezclas"}}
    {{!-- {{param surtirDe="=_params.surtirDe||'almacen'"}} --}}
    {{param conOncologia="=_params.conOncologia"}}
    {{param sinOncologia="=_params.sinOncologia"}}
    {{param conLisosomal="=_params.conLisosomal"}}
    {{param sinLisosomal="=_params.sinLisosomal"}}
  {{/action}}
  {{#action id="porPrepararCentralMezclas" label="Preparación Mezcla" subType="centralMezclas" subTypeName="Orden Preparación Mezcla" transform="copiarPrepararMezcla" source="notaPorPrepararEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMaterial" toSection="materiales" color="deep-orange" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param solicitud="=_id"}}
    {{param servicio="=_params.service"}}
    {{param momento="=_params.momento"}}
    {{param sinCategorias="mezcla,medicamento,solucion"}}
    {{param _categoria="Materiales"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{!-- {{#action id="porEntregarDirectoMateriales" label="Entregar Materiales" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" subType="materiales" subTypeName="Entrega Materiales" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarEntregaMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="_params.momento"}}
    {{param sinCategorias="mezcla,medicamento,solucion"}}
    {{param _categoria="Materiales"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param tieneDatosEntregaMezcla="=true"}}
  {{/action}} --}}


{{!--   {{#action id="porReservarFarmaciaLoteEspecifico" label="Reservar Lote Especifico" transform="copiarCategoriaPersona" source="notaPorReservarLote" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param sinCategorias="mezcla"}}
    {{param _categoria="Medicamentos y Soluciones"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param surtirLoteEspecifico="='si'"}}
  {{/action}}
  {{#action id="porReservarFarmacia" label="Reservar" transform="copiarCategoriaPersona" source="notaPorReservar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param sinCategorias="mezcla"}}
    {{param _categoria="Medicamentos y Soluciones"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param surtirLoteEspecifico="='no'"}}
  {{/action}} --}}
  {{#action id="porEntregarDirectoFarmaciaLoteEspecifico" label="Entregar Directo Lote Especifico" transform="copiarCategoriaPersona" source="notaPorEntregarDirectoLote" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarEntregaMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="_params.momento"}}
    {{param sinCategorias="mezcla"}}
    {{param _categoria="Medicamentos y Soluciones"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param surtirLoteEspecifico="='si'"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
    {{param conOncologia="=_params.conOncologia"}}
    {{param sinOncologia="=_params.sinOncologia"}}
    {{param conLisosomal="=_params.conLisosomal"}}
    {{param sinLisosomal="=_params.sinLisosomal"}}
  {{/action}}
  {{#action id="porEntregarDirectoFarmacia" label="Entregar Directo" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarEntregaMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="_params.momento"}}
    {{param sinCategorias="mezcla"}}
    {{param _categoria="Medicamentos y Soluciones"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param surtirLoteEspecifico="='no'"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
    {{param conOncologia="=_params.conOncologia"}}
    {{param sinOncologia="=_params.sinOncologia"}}
    {{param conLisosomal="=_params.conLisosomal"}}
    {{param sinLisosomal="=_params.sinLisosomal"}}
  {{/action}}
  {{#action id="porEntregarDirectoProduccionMezcla" label="Entregar Mezcla" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" subType="produccion" subTypeName="Entrega Mezcla" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarEntregaMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="_params.momento"}}
    {{param sinCategorias="mezcla,medicamento,solucion"}}
    {{param _categoria="Materiales"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="siCumpleProduccionMezcla" source="notaRegistroAvance" label="=_params.subTypeName||'Ok'" subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Sí'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark"}} 
    {{param hint="normal"}}
    {{param tieneDatosEntregaMezcla="=true"}}
    {{param copiarMateriales="=true"}}
  {{/action}}
  {{#action id="noCumpleProduccionMezcla" label="No Cumple Mezcla" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" subType="rechazado" subTypeName="No Cumple Mezcla" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarEntregaMultiple" toSection="aplicacion" color="red" btnSolid="true" icon="close"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="_params.momento"}}
    {{param sinCategorias="mezcla,medicamento,solucion"}}
    {{param _categoria="Materiales"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param tieneDatosRechazoMezcla="=true"}}
  {{/action}}
  {{#action id="porAsignarFarmacia" label="Asignar" transform="copiarCategoriaPersona" source="notaPorAsignar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param _categoria="Farmacia"}}
    {{param surtirDe="ubicacionEspecifica"}}
  {{/action}}

  {{#action id="porRecolectarMedicamentos" label="Recolectar Medicamentos" transform="copiarCategoriaPersona" source="notaPorRecolectar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="medicamento"}}
    {{param _categoria="Medicamentos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porRecolectarSoluciones" label="Recolectar Soluciones" transform="copiarCategoriaPersona" source="notaPorRecolectar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="solucion"}}
    {{param _categoria="Soluciones"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
{{!--   {{#action id="porRecolectarExplosion" label="Recolectar Farmacia" transform="copiarCategoriaPersona" source="notaPorRecolectarExplosion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="explosionFarmacia" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="notaPorEntregarExplosion" label="Entregar Farmacia" transform="copiarCategoriaPersona" source="notaPorEntregarExplosion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="explosionFarmacia" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}} --}}

  {{#action id="porEmpacarMedicamentos" label="Empacar Medicamentos" transform="copiarCategoriaPersona" source="notaPorEmpacar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="recoleccion"}}
    {{param categoria="medicamento"}}
    {{param _categoria="Medicamentos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porEmpacarSoluciones" label="Empacar Soluciones" transform="copiarCategoriaPersona" source="notaPorEmpacar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="recoleccion"}}
    {{param categoria="solucion"}}
    {{param _categoria="Soluciones"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porEmpacarMezclas" label="Empacar Mezclas" transform="copiarCategoriaPersona" source="notaPorEmpacar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="elaboracion"}}
    {{param categoria="mezcla"}}
    {{param _categoria="Mezclas"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}

  {{#action id="porCancelarReservadoFarmacia" label="Cancelar Reservado" transform="copiarCategoriaPersona" source="notaPorCancelarReservado" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="reservado"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porEntregarFarmacia" label="Entregar Farmacia" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="reservado"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porDevolverMateriales" label="Devolver Materiales" transform="copiarCategoriaPersona" source="notaPorDevolverMateriales" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="=_params.momento"}}
    {{param categoria="mezcla"}}
    {{param _categoria="Mezclas"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porEntregarMezclas" label="Entregar Mezclas" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="=_params.momento"}}
    {{param categoria="mezcla"}}
    {{param _categoria="Mezclas"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porRecibirFarmacia" label="Recibir Farmacia" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param central="=_params.central"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porDevolverFarmacia" label="Devolver Farmacia" transform="copiarCategoriaPersona" source="notaPorDevolver" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorDevolver" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param central="=_params.central"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porDevolverFarmaciaSobrante" label="Devolver Farmacia Sobrante" transform="copiarCategoriaPersona" source="notaPorDevolver" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorDevolver" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param central="=_params.central"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param esSobrante="=true"}}
  {{/action}}
  {{#action id="porCancelarMinistrado" source="notaPorCancelarMinistrado" label="Cancelar Ministrado" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="continuarMinistrado" toSection="aplicacion" userRole="cancelacionMinistracion"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}
  {{#action id="porMinistrarFarmacia" source="notaPorMinistrar" label="Ministrar al Paciente" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="continuarPorMinistrar" toSection="aplicacion" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
  {{/action}}
  {{#action id="porCancelarDevolucionFarmacia" label="Cancelar Devolución Farmacia" transform="copiarCategoriaPersona" source="notaPorCancelarDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param central="=_params.central"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porRechazarDevolucionFarmacia" label="Merma Devolución Farmacia" subType="mermaDevolucionFarmacia" subTypeName="Merma Devolución Farmacia" transform="copiar" source="notaPorRechazarDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPersonaMuliple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="porRecibirDevolucionFarmacia" label="Recibir Devolución Farmacia" transform="copiarCategoriaPersona" source="notaPorRecibirDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultipleDisponiblePersona" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{!-- {{param categoria="farmacia"}} --}}
    {{param _categoria="Farmacia"}}
    {{param central="=_params.central"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}

  {{#action id="porAsignarMaterial" label="Asignar" transform="copiarCategoriaPersona" source="notaPorAsignar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Material"}}
    {{param surtirDe="ubicacionEspecifica"}}
    {{param subCategoria="normal"}}
  {{/action}}
  {{#action id="porRecolectarMaterial" label="Recolectar Materiales" transform="copiarCategoriaPersona" source="notaPorRecolectar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Materiales o Insumos"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{!-- {{#action id="porArmarKitsMaterial" label="Armar Kits" transform="copiarCategoriaPersona" source="notaPorArmar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Materiales o Insumos"}}
    {{param subCategoria="kit"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}} --}}
  {{!-- {{#action id="porReservarMaterial" label="Reservar" transform="copiarCategoriaPersona" source="notaPorReservar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Material"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param subCategoria="normal"}}
    {{param almacenCuraciones="true"}}
  {{/action}} --}}
  {{#action id="porEntregarDirectoCeye" label="Entregar" subType="entregaCeye" subTypeName="Entrega CEYE" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{!-- {{param categoria="=_params.base.central"}} --}}
    {{param _categoria="=_params.base._central"}}
    {{param central="=_params.base.central"}}
    {{param _central="=_params.base._central"}}
    {{param surtirDe="ceye"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
  {{/action}}
  {{#action id="porEntregarDirectoMaterial" label="Entregar Directo" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Material"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenCuraciones="=!params.surtirDe"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
  {{/action}}
  {{#action id="porEntregarDirectoRopa" label="Entregar Directo" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="ropa"}}
    {{param _categoria="Ropa"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenCuraciones="=!params.surtirDe"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
  {{/action}}
  {{#action id="porEntregarDirectoTodo" label="Entregar Directo" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenCuraciones="=!params.surtirDe"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
  {{/action}}
  {{!-- {{#action id="porArmarKitsMaterial" label="Reservar Kits" transform="copiarCategoriaPersona" source="notaPorReservar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="armado"}}
    {{param categoria="material"}}
    {{param _categoria="Materiales o Insumos"}}
    {{param subCategoria="kit"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenCuraciones="=!params.surtirDe"}}
  {{/action}} --}}
  {{!-- {{#action id="porReservarMaterialAlmacenEspecifico" label="Reservar" transform="copiarCategoriaPersona" source="notaPorReservar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Material"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenEspecifico="true"}}
  {{/action}} --}}
  {{#action id="porEntregarDirectoMaterialAlmacenEspecifico" label="Entregar Directo" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="material"}}
    {{param _categoria="Material"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenEspecifico="true"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
    {{!-- {{param surtirLoteEspecifico="='no'"}} --}}
  {{/action}}
  {{#action id="porEntregarDirectoCeyeAlmacenEspecifico" label="Entregar Directo" transform="copiarCategoriaPersona" source="notaPorEntregarDirecto" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param nota="=calc.isTrue(_params.porNota)?base.nota:null"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="instrumento"}}
    {{param _categoria="Instrumento"}}
    {{param subCategoria="normal"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenEspecifico="true"}}
    {{param conPrioridad="=_params.conPrioridad"}}
    {{param sinPrioridad="=_params.sinPrioridad"}}
    {{!-- {{param surtirLoteEspecifico="='no'"}} --}}
  {{/action}}
  {{!-- {{#action id="porArmarKitsMaterialAlmacenEspecifico" label="Reservar Kits" transform="copiarCategoriaPersona" source="notaPorReservar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="armado"}}
    {{param categoria="material"}}
    {{param _categoria="Materiales o Insumos"}}
    {{param subCategoria="kit"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param almacenEspecifico="true"}}
  {{/action}} --}}
  {{!-- {{#action id="porRecolectarKitsMaterial" label="Recolectar Materiales" transform="copiarCategoriaPersona" source="notaPorRecolectar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="armado"}}
    {{param categoria="material"}}
    {{param _categoria="Materiales o Insumos"}}
    {{param subCategoria="kit"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}} --}}
  {{#action id="porEmpacarMaterial" label="Empacar Materiales" transform="copiarCategoriaPersona" source="notaPorEmpacar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="recoleccion"}}
    {{param categoria="material"}}
    {{param _categoria="Materiales o Insumos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porCancelarReservadoMaterial" label="Cancelar Reservado" transform="copiarCategoriaPersona" source="notaPorCancelarReservado" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="reservado"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porEntregarMaterial" label="Entregar Materiales" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="reservado"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porRecibirMaterial" label="Recibir Materiales" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entrega"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param central="=_params.central"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porCancelarUtilizado" source="notaPorCancelarUtilizado" label="Cancelar Utilizado" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="continuarUtilizado" toSection="aplicacion" userRole="cancelacionUtilizacion"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="porDevolverMaterial" label="Devolver Materiales" transform="copiarCategoriaPersona" source="notaPorDevolver" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPorUtilizar" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param central="=_params.central"}}
    {{param desde="=_params.desde"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
  {{/action}}
  {{#action id="porUtilizarMaterial" source="notaPorUtilizar" label="Utilización Materiales" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="continuarPersonaMuliple" toSection="aplicacion" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param momento="entregado"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param desde="=_params.desde"}}
  {{/action}}  
  {{#action id="porCancelarDevolucionMaterial" label="Cancelar Devolución Materiales" transform="copiarCategoriaPersona" source="notaPorCancelarDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="porRechazarDevolucionMaterial" label="Merma Devolución Materiales" subType="mermaDevolucionMaterial" subTypeName="Merma Devolución Materiales" transform="copiar" source="notaPorRechazarDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarPersonaMuliple" toSection="aplicacion" color="teal"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param central="=_params.central"}}
  {{/action}}
  {{#action id="porRecibirDevolucionMaterial" label="Recibir Devolución Materiales" transform="copiarCategoriaPersona" source="notaPorRecibirDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{!-- {{param categoria="material"}} --}}
    {{param _categoria="Materiales o Insumos"}}
    {{param surtirDe="=_params.surtirDe||'almacen'"}}
    {{param central="=_params.central"}}
  {{/action}}

  {{!-- {{#action id="porRecolectarVenta" label="Recolectar Ventas" transform="copiarCategoriaPersona" source="notaPorRecolectar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="venta"}}
    {{param _categoria="Ventas"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porEmpacarVenta" label="Empacar Ventas" transform="copiarCategoriaPersona" source="notaPorEmpacar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="recoleccion"}}
    {{param categoria="venta"}}
    {{param _categoria="Ventas"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porEntregarVenta" label="Entregar Ventas" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="empaque"}}
    {{param categoria="venta"}}
    {{param _categoria="Ventas"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porFacturarVenta" source="notaPorFacturar" label="Facturación Venta" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param categoria="venta"}}
    {{param _categoria="Ventas"}}
    {{param momento="porFacturar"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porDevolverVenta" label="Devolver Venta" transform="copiarCategoriaPersona" source="notaPorDevolver" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="facturado"}}
    {{param categoria="venta"}}
    {{param _categoria="Ventas"}}
    {{param central="=_params.central"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porRecibirDevolucionVenta" label="Recibir Devolución Venta" transform="copiarCategoriaPersona" source="notaPorRecibirDevolucion" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="devolucion"}}
    {{param categoria="venta"}}
    {{param _categoria="Ventas"}}
    {{param central="=_params.central"}}
    {{param surtirDe="almacen"}}
  {{/action}} --}}

  {{#action id="porRecibirProveedor" label="Recibir Proveedor" transform="copiarCategoriaPersona" source="notaPorRecibir" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="programado"}}
    {{param categoria="compra"}}
    {{param _categoria="Compras"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porEmpacarTransito" label="Empacar Transito" transform="copiarCategoriaPersona" source="notaPorEmpacar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="compra"}}
    {{param _categoria="Compras"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porEntregarTransito" label="Entregar Transito" transform="copiarCategoriaPersona" source="notaPorEntregar" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="empaque"}}
    {{param categoria="compra"}}
    {{param _categoria="Compras"}}
    {{param surtirDe="almacen"}}
  {{/action}}
  {{#action id="porRecibirTransito" label="Recibir Transito" transform="copiarCategoriaPersona" source="notaPorRecibirTransito" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" fromSource="solicitud" fromView="continuarMultiple" toSection="aplicacion" color="teal" btnSolid="true"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
    {{param momento="entregado"}}
    {{param categoria="compra"}}
    {{param _categoria="Compras"}}
    {{param surtirDe="almacen"}}
  {{/action}}

  {{#action id="notaAvanceMultiple" source="notaAvanceMultiple" label="=_params.pasoSiguiente||'Avanzar Solicitudes'" subType="=calc.concatLodash(_params.servicio,_params.momento)" subTypeName="=_params.pasoSiguiente||'Avanzar Solicitudes'" transform="copiarAvanceMultiple" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="continuarAvanceMuliple" toSection="aplicacion" btnSolid="true"}}
    {{param nota="=calc.isTrue(_params.porNota)?_params.base.nota:null"}}
    {{!-- {{param persona="=persona.id"}} --}}
    {{param momento="=_params.momento"}}
    {{param servicio="=_params.service"}}
  {{/action}}

  {{action id="editarVenta"   source="notaEdicionVenta"  label="Editar" transform="copiarVenta" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="editarCompra"  source="notaEdicionCompra"  label="Editar" transform="copiarCompra" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}

[.#if esRH.]
  {{#action id="notaCompatibilidadEmpleoRHEnPromocion" source="notaCompatibilidadEmpleoRH" hide="true" transform="copiarCompatibilidadEmpleoRH" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" label="Compatibilidad Empleo" fromSource="plaza" fromView="lista" fromSource2="puesto" fromView2="lista" condition="=base.requerimientoPersonal.base.esCedulaPromocion"}}
    {{param puestoId="base.requerimientoPersonal.base.cedulaPromocion.base.puestoPromocion"}}
  {{/action}}
[./if.]

  {{action id="rechazar"                    source="notaRechazoSolicitud"        label="Rechazar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red" icon="close" btnSolid="true" onlyPost="true"}}
  {{action id="notaRechazarSolicitud"       source="notaRechazoSolicitud"        label="Rechazar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red" icon="close" btnSolid="true" onlyPost="true"}}
  {{action id="notaRechazoCandidato"        source="notaRechazoCandidato"        label="Eliminar" subType="eliminacion" subTypeName="Eliminación Candidato" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red" icon="close" btnSolid="true" onlyPost="true"}}
  {{action id="notaRechazoAtencion"         source="notaRechazoAtencion"         label="Rechazar" transform="copiarSolicitudVencimiento" hide="true" type="add-subdoc" visibleMode="close" color="red" icon="close" btnSolid="true" onlyPost="true"}}
  {{action id="notaRechazoPlanEjecucion"    source="notaRechazoPlanEjecucion"    label="Rechazar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red" icon="close" btnSolid="true" onlyPost="true"}}
  {{action id="rechazarPropuesta"           source="notaRechazoPropuesta"        label="Rechazar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red" icon="close" btnSolid="true" onlyPost="true"}}
  {{action id="notaRequiereEspecificacionTecnica" source="notaRequiereEspecificacionTecnica" label="Requiere Especificación Técnica" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" icon="forward"}} 
  {{action id="notaRequiereLicitacion"      source="notaRequiereLicitacion"      label="Requiere Licitación" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" btnSolid="true" icon="forward"}} 
  {{action id="notaEntregaAlimentosBandeja" source="notaEntregaAlimentosBandeja" label="Alimentos Entregados" transform="copiarEntregaAlimentosBandeja"  hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}}
  
  {{action id="retroceder"                  source="notaRegistroRetroceso"       label="=_params.cancelSubTypeName||'Cancelación'"  subType="=_params.cancelSubType" subTypeName="=_params.cancelSubTypeName||'Cancelación'" transform="copiarRetroceso" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" btnSolid="true" color="grey" icon="reply"}} 
  {{action id="retrocesoBolsaTalentos"      source="notaRegistroRetroceso"       label="Bolsa de Talentos" subType="enBolsaTalentosRH" subTypeName="='Retroceso a Bolsa de Talentos'"  transform="copiarRetroceso" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" btnSolid="true" color="grey" icon="reply"}} 
  {{action id="retrocesoElaborarPropuesta"  source="notaRegistroRetroceso"       label="Propuesta Compra" subType="porElaborarPropuesta" subTypeName="='Retroceso a Propuesta Compra'"  transform="copiarRetroceso" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" btnSolid="true" color="grey" icon="reply"}} 
  {{action id="retrocesoRevisiarPropuesta"  source="notaRegistroRetroceso"       label="Revisión Propuesta" subType="enRevision" subTypeName="='Retroceso a Revisión Propuesta'"  transform="copiarRetroceso" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" btnSolid="true" color="grey" icon="reply"}} 

  {{action id="compraDirecta"               source="notaRegistroAvance"          label="=_params.subTypeName||'Compra Directa'" subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Compra Directa'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="arrow-right-a"}} 

  {{#action id="cancelacionLote2"          source="notaRegistroAvanceLote"       label="=_params.cancelSubTypeName||'Cancelación'"  subType="=_params.cancelSubType" subTypeName="=_params.cancelSubTypeName||'Cancelación'" transform="copiarCancelacionLote" hide="true" type="add-subdoc" visibleMode="close" color="red" onlyPost="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}

  {{action id="notaNoRequiereFactura"      source="notaNoRequiereFactura"      label="No Requiere Factura"    transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red"   icon="close"     btnSolid="true" onlyPost="true"}}
  {{action id="notaRechazoRespuesta"       source="notaRechazoRespuesta"       label="Rechazar"               transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red"   icon="close"     btnSolid="true" onlyPost="true"}}
  {{action id="notaCorreccionRespuesta"    source="notaCorreccionRespuesta"    label="Rechazar"               transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="red"   icon="close"     btnSolid="true" onlyPost="true"}}
  {{action id="notaAceptacionRespuesta"    source="notaAceptacionRespuesta"    label="Aceptar"                transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="green" icon="checkmark" btnSolid="true" onlyPost="true"}}
  {{action id="notaValidacionEvaluacion"   source="notaValidacionEvaluacion"   label="Validación Evaluación"  transform="copiarValidacionEvaluacion" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}

  {{action id="notaRegistroCotizacionProveedor" source="notaRegistroCotizacionProveedor" label="Oferta Proveedor" transform="copiarRegistroCotizacionProveedor" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" btnSolid="true" icon="arrow-up-a"}} 
  {{#action id="notaRegistroInfoProveedor"       source="notaRegistroInfoProveedor"       label="Información Adicional del Proveedor" transform="copiarRegistroInfoProveedor" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" btnSolid="true" icon="arrow-up-a" fromSource="notaRegistroCotizacionProveedor" fromView="proveedores"}} 
    {{param request="_id"}}
  {{/action}}
  {{#action id="notaRegistroCertificadoNoObjecion" source="notaRegistroCertificadoNoObjecion"  label="Certificado No Objeción (CNO)"  transform="copiarRegistroCNO" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" btnSolid="true" icon="arrow-up-a" fromSource="notaRegistroCotizacionProveedor" fromView="proveedores"}}
    {{param request="_id"}}
  {{/action}}
  {{#action id="notaRegistroSeleccionProveedor" source="notaRegistroSeleccionProveedor"  label="Selección Proveedor"  transform="copiarRegistroProveedor" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" btnSolid="true" fromSource="notaRegistroCotizacionProveedor" fromView="proveedores"}}
    {{param request="_id"}}
  {{/action}}
  {{#action id="notaRegistroReciboProveedor" source="notaRegistroReciboProveedor"  label="Recibo Proveedor"  transform="copiarRegistroReciboProveedor" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" onlyPost="true" btnSolid="true" fromSource="notaRegistroCotizacionProveedor" fromView="proveedores"}}
    {{param request="_id"}}
  {{/action}}

  {{#action id="notaCierreInscripcionesCurso" source="notaCierreInscripcionesCurso" label="Cierre de Incripciónes" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" fromSource="solicitud" fromView="listaAlumnosCurso" toSection="aplicacion"}}
    {{param curso="=_id"}}
    {{param moment="='programado'"}}
    {{param continuar="='si'"}}
  {{/action}}
  {{#action id="notaIniciaCurso" source="notaIniciaCurso" label="Inicia Curso" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" fromSource="solicitud" fromView="listaAlumnosCurso" toSection="aplicacion"}}
    {{param curso="=_id"}}
    {{param moment="='pre'"}}
    {{param continuar="='si'"}}
  {{/action}}
  {{#action id="notaRegistroAsistenciaCurso" source="notaRegistroAsistenciaCurso" label="Registro Asistencia" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" fromSource="solicitud" fromView="listaAlumnosCurso" toSection="aplicacion"}}
    {{param curso="=_id"}}
    {{param moment="='trans'"}}
  {{/action}}
  {{#action id="notaRegistroAsistenciaCursoCapacitacion" source="notaRegistroAsistenciaCurso" label="Registro Asistencia" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="teal" btnSolid="true" onlyPost="true" fromSource="solicitud" fromView="listaAlumnosCursoCapacitacion" toSection="aplicacion"}}
    {{param curso="=_id"}}
  {{/action}}
  {{#action id="notaTerminaCurso" source="notaTerminaCurso" label="Termina Curso" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" fromSource="solicitud" fromView="listaAlumnosCurso" toSection="aplicacion"}}
    {{param curso="=_id"}}
    {{param moment="='trans'"}}
    {{param continuar="='si'"}}
  {{/action}}
  {{#action id="notaFinalizaCurso" source="notaFinalizaCurso" label="Finaliza Curso" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" fromSource="solicitud" fromView="listaAlumnosCurso" toSection="aplicacion"}}
    {{param curso="=_id"}}
    {{param moment="='post'"}}
    {{param continuar="='si'"}}
  {{/action}}

[.#if esGRP.]
  {{action id="FO-CON-01" source="notaFoCon01" label="FO-CON-01" transform="copiarFoConSinTotales" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" btnSolid="true" onlyPost="true"}}
  {{action id="FO-CON-02" source="notaFoCon02" label="FO-CON-02" transform="copiarFoCon" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" btnSolid="true" onlyPost="true"}}
  {{action id="FO-CON-03" source="notaFoCon03" label="FO-CON-03" transform="copiarFoCon" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" btnSolid="true" onlyPost="true"}}
  {{action id="FO-CON-04" source="notaFoCon04" label="FO-CON-04" transform="copiarFoCon" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" btnSolid="true" onlyPost="true"}}
  {{action id="FO-CON-05" source="notaFoCon05" label="FO-CON-05" transform="copiarFoConSinTotales" hide="true" type="add-subdoc" visibleMode="close" color="blue-grey" btnSolid="true" onlyPost="true"}}
[./if.]

  {{#action id="avanceAlterno" source="notaRegistroAvance" label="=_params.subType2Name||'Alterno'" subType="=calc.concatLodash(_params.servicio,_params.subType2)" subTypeName="=_params.subType2Name||'No'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="red" onlyPost="true" btnSolid="true" icon="close"}}
    {{param hint="alterno"}}
  {{/action}}
  {{#action id="avanceAlternoAdjuntos" source="notaRegistroAvance" label="=_params.subType2Name||'Alterno'" subType="=calc.concatLodash(_params.servicio,_params.subType2)" subTypeName="=_params.subType2Name||'No'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="red" onlyPost="true" btnSolid="true" icon="close"}}
    {{param hint="alterno"}}
    {{param requiereAdjuntos="=true"}}
  {{/action}}
  {{#action id="avanceAlterno2" source="notaRegistroAvance" label="=_params.subType2Name||'Alterno'" subType="=calc.concatLodash(_params.servicio,_params.subType2)" subTypeName="=_params.subType2Name||'No'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="asterisk"}}  
    {{param hint="alterno2"}}
  {{/action}}
  {{#action id="avanceAlterno2Reprogramar" source="notaRegistroAvance" label="=_params.subType2Name||'Alterno'" subType="=calc.concatLodash(_params.servicio,_params.subType2)" subTypeName="=_params.subType2Name||'No'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="asterisk"}}  
    {{param hint="alterno2"}}
    {{param esReprogramacion="=true"}}
  {{/action}}
  {{#action id="avanceAlterno3" source="notaRegistroAvance" label="=_params.subType3Name||'Alterno'" subType="=calc.concatLodash(_params.servicio,_params.subType3)" subTypeName="=_params.subType3Name||'No'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true" icon="plus"}}  
    {{param hint="alterno3"}}
  {{/action}}
  {{#action id="avanceNormal" source="notaRegistroAvance" label="=_params.subTypeName||'Ok'" subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Sí'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark"}} 
    {{param hint="normal"}}
  {{/action}}
  {{#action id="avanceNormalAdjuntos" source="notaRegistroAvance" label="=_params.subTypeName||'Ok'" subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Sí'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark"}} 
    {{param hint="normal"}}
    {{param requiereAdjuntos="=true"}}
  {{/action}}

  {{#action id="avanceReprogramar"    source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" icon="clock" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="base.servicio"}}
    {{param subTipoSolicitud="base.subTipoSolicitud"}}
    {{param motivo="=base.motivo"}}
    {{param momentoDieta="=base.momentoDieta"}}
    {{param criticidadZona="=base.criticidadZona"}}
    {{param tieneVencimientoNuevo="=true"}}
    {{param tipoVencimiento="='atencion'"}}
    {{param esReprogramacion="=true"}}
  {{/action}}

  {{#action id="avanceNuevoVencimiento"    source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" icon="clock" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="base.servicio"}}
    {{param subTipoSolicitud="base.subTipoSolicitud"}}
    {{param motivo="=base.motivo"}}
    {{param momentoDieta="=base.momentoDieta"}}
    {{param criticidadZona="=base.criticidadZona"}}
    {{param tieneVencimientoNuevo="=true"}}
    {{param tipoVencimiento="='atencion'"}}
    {{param esVencimientoNuevo="=true"}}
  {{/action}}

  {{#action id="avanceIniciaAtencion"    source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" icon="clock" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="base.servicio"}}
    {{param subTipoSolicitud="base.subTipoSolicitud"}}
    {{param motivo="=base.motivo"}}
    {{param momentoDieta="=base.momentoDieta"}}
    {{param criticidadZona="=base.criticidadZona"}}
    {{param tieneVencimientoNuevo="=true"}}
    {{param tipoVencimiento="='atencion'"}}
  {{/action}}

  {{#action id="avanceIniciaEjecucion"          source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" icon="clock" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="base.servicio"}}
    {{param subTipoSolicitud="base.subTipoSolicitud"}}
    {{param motivo="=base.motivo"}}
    {{param momentoDieta="=base.momentoDieta"}}
    {{param criticidadZona="=base.criticidadZona"}}
    {{param tieneVencimientoNuevo="=true"}}
    {{param tipoVencimiento="='ejecucion'"}}
    {{param tieneMedicionesParametros="=base.servicio=='moi'&&base.subTipoSolicitud=='inspeccionVisual'"}}
    {{param errorAsignacionPersonal="=base.servicio=='residuosHospitalarios'&&_.isEmpty(calc.getRef(_params, 'info.notaAsignacionAcceso.base.empleado'))"}}
  {{/action}}
  {{#action id="avanceIniciaEjecucionAdjuntos"          source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" icon="clock" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="base.servicio"}}
    {{param subTipoSolicitud="base.subTipoSolicitud"}}
    {{param motivo="=base.motivo"}}
    {{param momentoDieta="=base.momentoDieta"}}
    {{param criticidadZona="=base.criticidadZona"}}
    {{param tieneVencimientoNuevo="=true"}}
    {{param tipoVencimiento="='ejecucion'"}}
    {{param tieneMedicionesParametros="=base.servicio=='moi'&&base.subTipoSolicitud=='inspeccionVisual'"}}
    {{param errorAsignacionPersonal="=base.servicio=='residuosHospitalarios'&&_.isEmpty(calc.getRef(_params, 'info.notaAsignacionAcceso.base.empleado'))"}}
    {{param requiereAdjuntos="=true"}}
  {{/action}}
  {{#action id="avanceIniciaEjecucionAseo"      source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" icon="clock" onlyPost="true" btnSolid="true" fromSource="persona" fromView="contratoDelServicio"}} 
    {{param servicio="base.servicio"}}
    {{param subTipoSolicitud="base.subTipoSolicitud"}}
    {{param motivo="=base.motivo"}}
    {{param momentoDieta="=base.momentoDieta"}}
    {{param criticidadZona="=base.criticidadZona"}}
    {{param tieneVencimientoNuevo="=true"}}
    {{param tipoVencimiento="='ejecucion'"}}
    {{param tiempoEspecifico="=base.aseo.base.tiempoEjecucion"}}
    {{param tiempoAlertaEspecifico="=base.aseo.base.tiempoAlertaEjecucion"}}
  {{/action}}

  {{action id="aceptarAvance"      source="notaRegistroAvance" label="=_params.subTypeName||'Aceptación'"   subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Aceptación'"      transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green"  onlyPost="true" btnSolid="true" icon="checkmark"}} 
  {{action id="autorizarAvance"    source="notaRegistroAvance" label="=_params.subTypeName||'Autorización'" subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Autorización'"    transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green"  onlyPost="true" btnSolid="true" icon="checkmark"}} 
  {{action id="avance"             source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"          transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
  {{action id="avanceSiguiente"    source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"          transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true" icon="forward"}} 
  {{action id="avanceSiguiente2"   source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"          transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward"}} 
  {{#action id="avanceNotificarSubPersonas" source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'" transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward"}} 
    {{param notificarSubPersonas="=true"}}
  {{/action}}
  {{#action id="avanceConAdjuntos2"source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward"}} 
    {{param requiereAdjuntos="=true"}}
    {{param referencias="=calc.pluck(articulos, 'descripcion')"}}
  {{/action}}
  {{#action id="avanceArticulos"   source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" icon="forward"}} 
    {{param articulos="=articulos"}}
  {{/action}}
  {{action id="avanceOk"             source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark"}} 
  {{#action id="avanceConAdjuntosOk" source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark"}} 
    {{param requiereAdjuntos="=true"}}
  {{/action}}

  {{#action id="avanceCotizacionProveedor" source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward" condition="=info.registroCotizacionProveedor" fromSource="notaRegistroCotizacionProveedor" fromView="cotizaciones" fromSource2="mov" fromView2="disponibleEnAlmacen"  error="=calc.differenceError(_.pluck(_items2, 'codigo'), _.uniq(calc.pluckRef(_items, 'articulos.codigo')), 'Artículos Faltantes de Oferta Económica:<br>')"}} 
    {{param request="=_id"}}
    {{param almacen="=_parent.id"}}
  {{/action}}
  {{#action id="avanceCertificadoNoObjecion"   source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"          transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward" fromSource="mov" fromView="disponibleEnAlmacen"  error="=calc.differenceError(_.pluck(_items, 'codigo'), _.uniq(calc.pluckRef(adjuntos, 'referencia2')), 'Artículos Faltantes de CNO:<br>')"}}
    {{param almacen="=_parent.id"}}
  {{/action}}

  {{action id="avanceSeleccionProveedor"  source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward" condition="=info.registroSeleccionProveedor"}} 
  {{action id="avanceReciboProveedor"     source="notaRegistroAvance" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" icon="forward" condition="=info.registroReciboProveedor"}} 

  {{action id="registroMeta" source="notaRegistroMeta" subType="=_params.base.subTipoSolicitud" subTypeName="=calc.concat('Autorización',_params.base._subTipoSolicitud)" label="=_params.base._subTipoSolicitud"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Autorización'"        transform="copiarRegistroEvaluacionDesempeno" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark" condition="=calc.in(base.subTipoSolicitud, ['registroMetasColectivas','registroMetasIndividuales'])"}} 
  {{action id="registroEvaluacionDesempeno" source="notaRegistroEvaluacionDesempeno" subType="=_params.base.subTipoSolicitud" subTypeName="=calc.concat('Validación',_params.base._subTipoSolicitud)" label="=_params.base._subTipoSolicitud"  subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Autorización'"        transform="copiarRegistroEvaluacionDesempeno" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark" condition="=!calc.in(base.subTipoSolicitud, ['registroMetasColectivas','registroMetasIndividuales'])"}} 
  {{action id="registroEvaluacionDesempenoJefeDirecto" source="notaRegistroEvaluacionDesempeno" subType="=_params.base.subTipoSolicitud+'JefeDirecto'" subTypeName="=calc.concat('Autorización Jefe Directo',_params.base._subTipoSolicitud)" label="=calc.concat(_params.base._subTipoSolicitud, 'Jefe Directo')"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Autorización'"        transform="copiarRegistroEvaluacionDesempeno" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark" condition="=!calc.in(base.subTipoSolicitud, ['registroMetasColectivas','registroMetasIndividuales'])"}} 
  {{action id="registroEvaluacionDesempenoJefeIndirecto" source="notaRegistroEvaluacionDesempeno" subType="=_params.base.subTipoSolicitud+'JefeIndirecto'" subTypeName="=calc.concat('Autorización Jefe Indirecto',_params.base._subTipoSolicitud)" label="=calc.concat(_params.base._subTipoSolicitud, 'Jefe Indirecto')"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Autorización'"        transform="copiarRegistroEvaluacionDesempeno" hide="true" type="add-subdoc" visibleMode="close" color="green" onlyPost="true" btnSolid="true" icon="checkmark" condition="=!calc.in(base.subTipoSolicitud, ['registroMetasColectivas','registroMetasIndividuales'])"}} 

  {{#action id="avanceMantenimientoCorrectivo"    source="notaRegistroAvance"        label="='Solicitar Mantenimiento Correctivo'"        subType="=calc.concatLodash(_params.servicio,'mantenimientoCorrectivo')" subTypeName="='Solicitud Mantenimiento Correctivo'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneMobiliario="=_params.service=='mobiliario'"}}
    {{param tieneEquipoMedico="=_params.service=='equipoMedico'"}}
    {{param tieneElementoTecnologico="=_params.service=='elementoTecnologico'"}}
    {{param tieneMoi="=_params.service=='moi'"}}
    {{param subTipoSolicitud="mantenimientoCorrectivo"}}
    {{param esReprogramacion="=true"}}
  {{/action}}
  {{#action id="avanceMobiliarioProvisional"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneMobiliario="=calc.in(_params.control.mensaje, ['tieneGarantiaProvisional','reparacionProvisional','reparacionAutorizadaProvisional'])"}}
    {{param subTipoSolicitud="instalacionProvisional"}}
  {{/action}}
  {{#action id="avanceEquipoMedicoProvisional"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneEquipoMedico="=calc.in(_params.control.mensaje, ['tieneGarantiaProvisional','reparacionProvisional','reparacionAutorizadaProvisional'])"}}
    {{param subTipoSolicitud="instalacionProvisional"}}
  {{/action}}
  {{#action id="avanceElementoTecnologicoProvisional"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneElementoTecnologico="=calc.in(_params.control.mensaje, ['tieneGarantiaProvisional','reparacionProvisional','reparacionAutorizadaProvisional'])"}}
    {{param subTipoSolicitud="instalacionProvisional"}}
  {{/action}}
  {{#action id="avanceMoiProvisional"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"               transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneMoi="=calc.in(_params.control.mensaje, ['tieneGarantiaProvisional','reparacionProvisional','reparacionAutorizadaProvisional'])"}}
    {{param subTipoSolicitud="instalacionProvisional"}}
  {{/action}}
  {{#action id="avanceMobiliarioReposicion"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvanceMobiliarioReposicion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneInstalacionProvisional="=calc.in(_params.control.mensaje, ['reposicionAutorizadaProvisional'])"}}
  {{/action}}
  {{#action id="avanceElementoTecnologicoReposicion"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvanceElementoTecnologicoReposicion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneInstalacionProvisional="=calc.in(_params.control.mensaje, ['reposicionAutorizadaProvisional'])"}}
  {{/action}}
  {{#action id="avanceEquipoMedicoReposicion"  source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvanceEquipoMedicoReposicion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneInstalacionProvisional="=calc.in(_params.control.mensaje, ['reposicionAutorizadaProvisional'])"}}
  {{/action}}
  {{#action id="avanceMoiReposicion"    source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"               subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvanceMoiReposicion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}} 
    {{param tieneInstalacionProvisional="=calc.in(_params.control.mensaje, ['reposicionAutorizadaProvisional'])"}}
  {{/action}}
  {{#action id="avanceLote"         source="notaRegistroAvanceLote"    label="=calc.concat(_params.subTypeName||'Avance', 'en Lote')"  subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Avance','en Lote')" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{#action id="avanceLote2"         source="notaRegistroAvanceLote"    label="=_params.subTypeName||'Avance'"  subType="=_params.subType" subTypeName="=_params.subTypeName||'Avance'" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{#action id="avanceLoteOk"         source="notaRegistroAvanceLote"    label="=calc.concat(_params.subTypeName||'Avance', 'en Lote')"  subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Avance','en Lote')" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion" icon="checkmark"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{#action id="avanceSiguienteLote" source="notaRegistroAvanceLote"    label="=calc.concat(_params.subTypeName||'Avance', 'en Lote')"  subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Avance','en Lote')" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion" icon="forward"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{#action id="avanceLoteTrasladarResiduos"       source="notaRegistroAvanceLote"    label="=calc.concat(_params.subTypeName||'Avance', 'en Lote')"  subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Avance','en Lote')" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param ubicacionDestino="=_params.base.ubicacionDestino"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}
  {{action id="avanceRegistrarResiduos"       source="notaRegistroAvanceResiduos" label="=_params.subTypeName||'Avance'"       subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"condition="=base.subTipoSolicitud!='trasladoResiduosDomiciliarios'"}} 
  {{#action id="avanceLoteRegistrarResiduos"  source="notaRegistroAvanceLote"     label="=calc.concat(_params.subTypeName||'Avance', 'en Lote')"  subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Avance','en Lote')" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion" condition="=base.subTipoSolicitud=='trasladoResiduosDomiciliarios'"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param ubicacionDestino="=_params.base.ubicacionDestino"}}
    {{param tieneContenido="=true"}}
    {{param tieneGenerador="=true"}}
    {{param tienePeso="=true"}}
    {{!-- {{param tieneSubTipoResiduo="=true"}} --}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
  {{/action}}

  {{action id="prepararAlimentos" source="notaRegistroAvance"        label="=_params.subTypeName||'Avance'"        subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Avance'"        transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true" condition="=calc.in(_params.base.formaEntrega, ['requierePreparacion','requierePreparacionAlerta'])"}} 
  {{#action id="prepararAlimentosLote"  source="notaRegistroAvanceLote" label="=calc.concat(_params.subTypeName||'Avance', 'en Lote')"  subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Avance','en Lote')" transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion" condition="=calc.in(_params.base.formaEntrega, ['requierePreparacion','requierePreparacionAlerta'])"}} 
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
    {{param formaEntrega="=_params.base.formaEntrega"}}
  {{/action}}

  {{#action id="avanceFinal"       source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinal', base, info, _items)" errorType="info"}}
    {{param id="=_id"}}
  {{/action}}
  {{#action id="avanceValidarInv"    source="notaRegistroAvance"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinalInv', base, info, _items)" errorType="info"}}
    {{param id="=_id"}}
  {{/action}}
  {{#action id="avanceFinalReemplazo"       source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true"}}
    {{param tieneReemplazo="=true"}}
  {{/action}}
  {{action id="avanceFinalSinValidar" source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true"}}
  {{#action id="avanceFinalEval"      source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true"}}
    {{param plantillaEvaluacion="=info.base.plantillaEvaluacion"}}
    {{param _plantillaEvaluacion="=info.base._plantillaEvaluacion"}}
  {{/action}}
  {{#action id="avanceFinalActivoFijo" source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinal', base, info, _items)" errorType="info"}}
    {{param id="=_id"}}
    {{param tieneComentariosActivoFijo="=true"}}
    {{param tieneCostos="=true"}}
    {{param tieneHorasHombre="=true"}}
  {{/action}}
  {{#action id="avanceFinalTercero" source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinal', base, info, _items)" errorType="info"}}
    {{param id="=_id"}}
    {{param tieneComentariosTercero="=true"}}
  {{/action}}
  {{#action id="avanceFinalHojaCostos" source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinal', base, info, _items)" errorType="info"}}
    {{param id="=_id"}}
    {{param tieneHojaCostos="=true"}}
  {{/action}}
  {{#action id="avanceFinalOk"    source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="green"       onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinal', base, info, _items)" errorType="info" icon="checkmark"}}
    {{param id="=_id"}}
  {{/action}}
  {{action id="avanceFinalValidacionInventario"    source="notaValidacionInventario"  label="Validación Inventario" transform="copiarValidacionInventario" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" condition="=base.subTipoSolicitud=='validacionInventario'"}}
  {{#action id="avanceFinalNoValidacionInventario" source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=fn('validarAvanceFinal', base, info, _items)" errorType="info" condition="=base.subTipoSolicitud!='validacionInventario'"}}
    {{param id="=_id"}}
  {{/action}}
  {{#action id="avanceFinalAdquisiciones"       source="notaRegistroAvanceFinal"   label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="disponibleEnAlmacen" error="=_items&&_items.length?'Tiene Pendientes por Recibir':null"}}
    {{param almacen="=_parent.id"}}
  {{/action}}

  {{action id="mayorJustificacion"         source="notaRegistroRetroceso"     label="Requiere Mayor Justificación" subType="enObjecion" subTypeName="='Mayor Justificación'"  transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" btnSolid="true" color="grey"}} 
  {{action id="rechazarJustificacion"      source="notaRechazoSolicitud"      label="Aceptar Objeción"  transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary"   btnSolid="true" onlyPost="true"}}

  {{action id="rechazoResiduos"  source="notaRechazoSolicitud"      label="Error Etiquetado"  subType="errorEtiquetado" subTypeName="Error Etiquetado" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" btnSolid="true" onlyPost="true" color="red" icon="close"}}
  {{#action id="reciboResiduos"  source="notaRegistroAvanceFinal"   label="Recibir Residuos"  subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"  transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=_items&&_items.length?'Tiene Insumos Asignados':null" errorType="info" color="green" icon="checkmark"}}
    {{param id="=_id"}}
    {{!-- {{param tieneEtiqueta="=_params.base.subTipoSolicitud!='retiroResiduosDomiciliarios'"}} --}}
    {{param tieneRadioactividadAtenuada="=_params.base.subTipoSolicitud=='retiroResiduosRadioactivos'"}}
    {{!-- {{param tieneResiduosHospitalarios="=true"}}
    {{param subTipoSolicitud="=fn('trasladoResiduosHospitalarios', _params.base.subTipoSolicitud)"}}
    {{param _subTipoSolicitud="=fn('_trasladoResiduosHospitalarios', _params.base.subTipoSolicitud)"}} --}}
  {{/action}}
  {{#action id="avanceFinalSolicitudReparacionElementoTecnologico" source="notaRegistroAvanceFinal" label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=_items&&_items.length?'Tiene Insumos Asignados':null" errorType="info"}}
    {{param id="=_id"}}
    {{param tieneElementoTecnologico="=true"}}
    {{param subTipoSolicitud="reparacionHardware"}}
  {{/action}}
  {{#action id="avanceFinalSolicitudReparacionMoi" source="notaRegistroAvanceFinal" label="=_params.subTypeName||'Finalizar'"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=_params.subTypeName||'Finalizar'"     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" fromSource="mov" fromView="resumenInventario" error="=_items&&_items.length?'Tiene Insumos Asignados':null" errorType="info"}}
    {{param id="=_id"}}
    {{param tieneMoi="=true"}}
    {{param subTipoSolicitud="reparacion"}}
  {{/action}}
  {{#action id="avanceLoteFinal"   source="notaRegistroAvanceLoteFinal"   label="=calc.concat(_params.subTypeName||'Finalizar', 'en Lote')"     subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Finalizar','en Lote')"     transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}}
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
    {{param vencimiento="=_params.subType=='terminaEntrega'?moment().add(1,'h').format():null"}}
  {{/action}}
  {{#action id="avanceLoteFinal2"   source="notaRegistroAvanceLoteFinal"   label="=calc.concat(_params.subTypeName||'Finalizar')"     subType="=calc.concatLodash(_params.servicio,_params.subType)" subTypeName="=calc.concat(_params.subTypeName||'Finalizar')"     transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}}
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
    {{param vencimiento="=_params.subType=='terminaEntrega'?moment().add(1,'h').format():null"}}
  {{/action}}
  {{#action id="avanceLoteFinalAdjuntos"   source="notaRegistroAvanceLoteFinal"   label="=calc.concat(_params.subTypeName||'Finalizar', 'en Lote')"     subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Finalizar','en Lote')"     transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}}
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
    {{param vencimiento="=_params.subType=='terminaEntrega'?moment().add(1,'h').format():null"}}
    {{param requiereAdjuntos="=true"}}
  {{/action}}
  {{#action id="avanceLoteDisposicionFinal"   source="notaRegistroAvanceLote"   label="=calc.concat(_params.subTypeName||'Finalizar', 'en Lote')"     subType="=calc.concatLodash(_params.servicio,_params.subType,'en Lote')" subTypeName="=calc.concat(_params.subTypeName||'Finalizar','en Lote')"     transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"}}
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
    {{param vencimiento="=_params.subType=='terminaEntrega'?moment().add(1,'h').format():null"}}
    {{param tieneProveedor="=true"}}
    {{param tieneContenido="=true"}}
    {{param tienePeso="=true"}}
    {{param tieneSubTipoResiduo="=true"}}
  {{/action}}

  {{action id="entregaAlimentos"      source="notaRegistroAvanceFinal"     label="='Entregar'"                          subType="entregaAlimentos"    subTypeName="Entrega al Paciente"   transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" condition="=_params.base.subTipoSolicitud=='alimentacion'&&_params.base.formaEntrega=='entregaDirecta'||_params.base.subTipoSolicitud=='hidratacion'"}}
  {{#action id="entregaAlimentosLote" source="notaRegistroAvanceLoteFinal" label="=calc.concat('Entregar', 'en Lote')"  subType="=calc.concatLodash('entregaAlimentos','en Lote')" subTypeName="=calc.concat('Entrega al Paciente','en Lote')"     transform="copiarAvanceLote" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" btnSolid="true" fromSource="solicitud" fromView="continuarEnLote" toSection="aplicacion"condition="=_params.base.subTipoSolicitud=='alimentacion'&&_params.base.formaEntrega=='entregaDirecta'||_params.base.subTipoSolicitud=='hidratacion'"}}
    {{param tipoSolicitud="=_params.base.tipoSolicitud"}}
    {{param subTipoSolicitud="=_params.base.subTipoSolicitud"}}
    {{param servicio="=_board.service"}}
    {{param momento="=_board.moment"}}
    {{param subMomento="=_board.subMoment"}}
    {{param vencimiento="=_params.subType=='terminaEntrega'?moment().add(1,'h').format():null"}}
    {{param formaEntrega="=_params.base.formaEntrega"}}
  {{/action}}

  {{action id="retiroBandeja"     source="notaRegistroAvanceFinal"   label="='Retiro Bandeja'"  subType="retiroBandeja"       subTypeName="Retiro Bandeja"                     transform="copiarAvance" hide="true" type="add-subdoc" visibleMode="close" color="primary"     onlyPost="true" btnSolid="true" condition="=_params.base.subTipoSolicitud=='retiroBandeja'"}}

  {{#action id="notaAceptacionMultiple" source="notaAceptacionMultiple" label="Aceptación Solicitudes" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="aceptacionPersonaMuliple" toSection="aplicacion" btnSolid="true"}}
    {{param nota="=calc.isTrue(_params.porNota)?_params.base.nota:null"}}
    {{param persona="=persona.id"}}
    {{param servicio="=_params.service"}}
  {{/action}}

  {{#action id="notaAceptacionMultipleRequisicion" source="notaAceptacionMultiple" label="Aceptación Solicitudes" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="teal" onlyPost="true" fromSource="solicitud" fromView="aceptacionPersonaMuliple" toSection="aplicacion" btnSolid="true"}}
    {{param codigo="=_params.base.codigo"}}
    {{param servicio="='requisicion'"}}
  {{/action}}
  {{action id="notaRegistroDGC"    source="notaRegistroDGC"   label="Registro DGC" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true" condition="=!control.registroDGC"}}

  {{#action id="notaPago" source="notaPago" label="Pago Caja" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" fromSource="solicitud" fromView="porPagarPersona" toSection="aplicacion"}}
    {{param persona="=persona.id"}}
  {{/action}}
  {{#action id="notaPagoBancos" source="notaPagoBancos" label="Pago Bancos" transform="copiar" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" fromSource="solicitud" fromView="porPagarPersona" toSection="aplicacion" btnSolid="true"}}
    {{param persona="=persona.id"}}
  {{/action}}

  {{action id="notaAceptacionNutricion" source="notaAceptacionNutricion" label="Aceptar Nutricion" transform="copiarAceptacionNutricion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaComidaLista" source="notaComidaLista" label="Comida Lista" transform="copiarComidaLista" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaCobroConsultaExterna" source="notaCobroConsultaExterna" label="Cobro Consulta Externa" transform="copiarCobroConsultaExterna" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaCancelacionSolicitudConsultaExterna" source="notaCancelacionSolicitudConsultaExterna" label="Cancelar Consulta Externa" transform="copiarCancelacionSolicitudConsultaExterna" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaLlegaPacienteConsultaExterna" source="notaLlegaPacienteConsultaExterna" label="Llega Paciente Consulta Externa" transform="copiarLlegaPacienteConsultaExterna" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true" condition="=puedePasar"}}
  {{action id="notaAceptacionMaterial" source="notaAceptacionMaterial" label="Aceptar Solicitud Material" transform="copiarAceptacionMaterial" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaRecibirSucioSolicitud" source="notaRecibirSucioSolicitud" label="Recibir" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaEsterilizarSolicitud" source="notaEsterilizarSolicitud" label="Esterilizar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaEntregarSolicitud" source="notaEntregarSolicitud" label="Entregar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaDevolverSolicitud" source="notaDevolverSolicitud" label="Devolver" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{#action id="notaSolicitudAdquisicion" source="notaSolicitudAdquisicion" label="Generar Adquisición" transform="copiarGenerarAdquisicion" hide="true" type="add-subdoc" visibleMode="close" color="teal" btnSolid="true" onlyPost="true" fromSource="solicitud" fromView="requisicionesProgramadas" toSection="aplicacion" fromSource2="mov" fromView2="disponibleEnAlmacenes"}}
    {{param codigo="=base.codigo"}}
  {{/action}}
  {{action id="notaAutorizarSolicitud" source="notaAutorizacionSolicitud" label="Autorizar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="green" icon="checkmark" btnSolid="true" onlyPost="true"}}
  {{action id="notaAutorizacionSolicitud" source="notaAutorizacionSolicitud" label="Autorizar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaAutorizacionSolicitudCargo" source="notaAutorizacionSolicitudCargo" label="Autorizar Cargo" transform="copiarSolicitudCargo" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaSeguimientoCuasifalla" source="notaSeguimientoCuasifalla" label="Seguimiento Cuasifalla" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaSeguimientoEventoAdverso" source="notaSeguimientoEventoAdverso" label="Seguimiento Evento Adverso" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}
  {{action id="notaAcuerdosEventoAdverso" source="notaAcuerdosEventoAdverso" label="Acuerdos Evento Adverso" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true"}}

  {{action id="notaActivacionSolicitud" source="notaActivacionSolicitud" label="Autorizar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}}
  {{action id="notaAceptacionSolicitud" source="notaAceptacionSolicitud" label="Aceptar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}}
  {{action id="notaConfirmaSolicitud" source="notaConfirmaSolicitud" label="Confirmar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaConfirmaEsCita" source="notaConfirmaSolicitud" label="Confirmar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" condition="=fn('esSolicitudTipoCita', _params.base.tipoSolicitud, _params._updated.moment)"}}
  {{action id="notaEnteradoSolicitud" source="notaEnteradoSolicitud" label="Enterado" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaEnteradoEsNotificacion" source="notaEnteradoSolicitud" label="Enterado" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" condition="=fn('esSolicitudTipoNotificacion', _params.base.tipoSolicitud, _params._updated.moment)"}}
  {{action id="notaIniciaAsignacion" source="notaIniciaAsignacion" label="Inicia Asignación" transform="copiarIniciaAsignacion" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaIniciaAsignacionSubTipoActivoFijo" source="notaIniciaAsignacionSubTipoActivoFijo" label="Inicia Asignación" transform="copiarIniciaAsignacionSubTipoActivoFijo" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaFinalizaAsignacion" source="notaFinalizaAsignacion" label="Finaliza Asignación" transform="copiarFinalizaAsignacion" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaFinalizaAsignacionSubTipoActivoFijo" source="notaFinalizaAsignacionSubTipoActivoFijo" label="Finaliza Asignación" transform="copiarFinalizaAsignacionSubTipoActivoFijo" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaIniciaSolicitud" source="notaIniciaSolicitud" label="Iniciar Solicitud" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaTerminaSolicitud" source="notaTerminaSolicitud" label="Terminar Solicitud" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaAsignacionCorrecion" source="notaAsignacionCorrecion" label="Asignar Correción" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{action id="notaIniciaCorrecion" source="notaIniciaCorrecion" label="Iniciar Correción" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{#action id="notaTerminaCorrecion" source="notaTerminaCorrecion" label="Terminar Correción" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" fromSource="mov" fromView="resumenInventario" error="=_items&&_items.length?'Tiene Insumos Asignados':null" errorType="info"}}
    {{param id="=_id"}}
  {{/action}}
  {{action id="notaCierreCorrecion" source="notaCierreCorrecion" label="Cerrar Correción" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="green" btnSolid="true" onlyPost="true" icon="checkmark"}}
  {{action id="notaProgramaReparacion" source="notaProgramaReparacion" label="Programar Reparación" transform="copiarProgramaReparacion" hide="true" type="add-subdoc" visibleMode="close" color="red" btnSolid="true" onlyPost="true" icon="close"}}
  {{action id="notaAsignacionReparacion" source="notaAsignacionReparacion" label="Asignar Reparación" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="green" btnSolid="true" onlyPost="true"}}
  {{action id="notaIniciaReparacion" source="notaIniciaReparacion" label="Iniciar Reparación" transform="copiarIniciaReparacion" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" btnSolid="true" onlyPost="true"}}
  {{#action id="notaTerminaReparacion" source="notaTerminaReparacion" label="Terminar Reparación" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" fromSource="mov" fromView="resumenInventario" error="=_items&&_items.length?'Tiene Insumos Asignados':null" errorType="info"}}
    {{param id="=_id"}}
  {{/action}}
  {{action id="notaCierreReparacion" source="notaCierreReparacion" label="Cerrar Reparación" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="green" btnSolid="true" onlyPost="true" icon="checkmark"}}
  {{action id="notaRepiteReparacion" source="notaRepiteReparacion" label="Repetir Reparación" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="red" btnSolid="true" onlyPost="true" icon="close"}}
  {{action id="notaConformidad" source="notaConformidad" label="Conforme" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="green" btnSolid="true" onlyPost="true" icon="checkmark"}}
  {{action id="notaNoConformidad" source="notaNoConformidad" label="No Conforme" transform="copiarSolicitudServicio" hide="true" type="add-subdoc" visibleMode="close" color="red" btnSolid="true" onlyPost="true" icon="close"}}
  {{action id="notaFinalizaMantenimiento" source="notaFinalizaMantenimiento" label="Finaliza Mantenimiento" transform="copiarFinalizaSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true"}}
  {{action id="notaFinalizaConvenio" source="notaFinalizaConvenio" label="Finalizar Convenio" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="deep-orange" onlyPost="true" btnSolid="true"}}
  {{action id="notaFinalizaSolicitud" source="notaFinalizaSolicitud" label="Finalizar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" onlyPost="true" btnSolid="true"}}
  {{action id="notaFinalizaEsTarea" source="notaFinalizaSolicitud" label="Finalizar" transform="copiarSolicitud" hide="true" type="add-subdoc" visibleMode="close" color="primary" btnSolid="true" onlyPost="true" condition="=fn('esSolicitudTipoTarea', _params.base.tipoSolicitud, _params._updated.moment)"}}
  {{#action id="subTableroUbicacionesRopaSucia" hide="true" type="sub-link" label="Ubicaciones Ropa Sucia" color="green" visibleMode="close" isBrowserAction="true"}}
    {{link href="'/persona/ubicacionesRopaSucia'" name="Ubicaciones Ropa Sucia"}}
  {{/action}}  
  {{#action id="subTableroUbicacionesLavanderia" hide="true" type="sub-link" label="Ubicaciones Lavandería" color="green" visibleMode="close" isBrowserAction="true"}}
    {{link href="'/persona/ubicacionesLavanderia'" name="Ubicaciones Lavandería"}}
  {{/action}}  
  {{#action id="subTableroUbicacionesRopaLimpia" hide="true" type="sub-link" label="Ubicaciones Ropa Limpia" color="green" visibleMode="close" isBrowserAction="true"}}
    {{link href="'/persona/ubicacionesRopaLimpia'" name="Ubicaciones Ropa Limpia"}}
  {{/action}}  

  {{#browser id="lista" name="Solicitudes" view="lista" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="buscar" name="Solicitudes" view="buscar" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="subProcesos" name="Sub Procesos" view="lista" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="listaCursos" name="Solicitudes" view="lista" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{list itemTemplate="verSolicitudSinPersona" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="listaAlumnos" name="Lista Alumnos" view="activos" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{param todo="true"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="listaAlumnosEvaluacion" name="Lista Alumnos" view="activos" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{param todo="true"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="misSubordinados" name="Solicitudes de mis Subordinados" view="activos" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green" showActions="preliminar, menuFlujo, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="activas" name="Solicitudes Activas" view="activos" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown"}}  {{!-- showActions="preliminar, bitacora" --}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="conformidad" name="Pendientes Conformidad" view="conformidad" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="porCobrar" name="Solicitudes por Cobrar" view="lista" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green" showActions="preliminar, notaCancelacionSolicitud"}}
    {{param porCobrar="true"}}
    {{list itemTemplate="verSolicitudPorCobrar" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="porCobrar2" name="Solicitudes por Cobrar" view="lista" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green" showActions="preliminar, cobrosRelacionados"}}
    {{param porCobrar="true"}}
    {{list itemTemplate="verSolicitudPorCobrar" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="anticiposPorAplicar" name="Anticipos por Aplicar" view="anticiposPorAplicar" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green" showActions="preliminar"}}
    {{list itemTemplate="verSolicitudPorAplicar" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="resultadosTxDx" name="ResultadosTxDx" view="resultadosTxDx" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="blue"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
  {{/browser}}
  {{#browser id="consultaExterna" name="Solicitud Consulta Externa" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="teal" btnSolid="true"}}
    {{param tipoSolicitud="consultaExterna"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="medicamento" name="Solicitud Medicamento" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="teal" btnSolid="true"}}
    {{param tipoSolicitud="medicamento"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="solucion" name="Solicitud Solución" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="teal" btnSolid="true"}}
    {{param tipoSolicitud="solucion"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="mezcla" name="Solicitud Mezcla" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="teal" btnSolid="true"}}
    {{param tipoSolicitud="mezcla"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="laboratorio" name="Solicitud Laboratorio" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="cyan"}}
    {{param tipoSolicitud="laboratorio"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="imagenologia" name="Solicitud Imagenología" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="light-blue"}}
    {{param tipoSolicitud="imagenologia"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="patologia" name="Solicitud Patología" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="blue"}}
    {{param tipoSolicitud="patologia"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="procedimiento" name="Solicitud Procedimiento" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="indigo" isBrowserAction="true"}}
    {{param tipoSolicitud="procedimiento"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="cirugia" name="Solicitud Cirugía" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="indigo" isBrowserAction="true"}}
    {{param tipoSolicitud="cirugia"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="transfusion" name="Solicitud Transfusión" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="indigo" isBrowserAction="true"}}
    {{param tipoSolicitud="transfusion"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="hemocomponente" name="Solicitud Hemocomponente" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="indigo" isBrowserAction="true"}}
    {{param tipoSolicitud="hemocomponente"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="cateterSondaDrenaje" name="Solicitud Catéteres, Sondas o Drenajes" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="grey"}}
    {{param tipoSolicitud="cateterSondaDrenaje"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="referencia" name="Solicitud Referencia" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green"}}
    {{param tipoSolicitud="referencia"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="interconsulta" name="Solicitud Interconsulta" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="light-green"}}
    {{param tipoSolicitud="interconsulta"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="dieta" name="Solicitud Dieta" view="pendientes" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="orange" showActions="preliminar"}}
    {{param tipoSolicitud="dieta"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="1" name="Solicitudes" view="porDias" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown" showActions="preliminar, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
    {{param dias="1"}}
  {{/browser}}
  {{#browser id="7" name="Solicitudes" view="porDias" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown" showActions="preliminar, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
    {{param dias="7"}}
  {{/browser}}
  {{#browser id="15" name="Solicitudes" view="porDias" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown" showActions="preliminar, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
    {{param dias="15"}}
  {{/browser}}
  {{#browser id="30" name="Solicitudes" view="porDias" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown" showActions="preliminar, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
    {{param dias="30"}}
  {{/browser}}
  {{#browser id="60" name="Solicitudes" view="porDias" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown" showActions="preliminar, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
    {{param dias="60"}}
  {{/browser}}
  {{!-- {{#browser id="90" name="Solicitudes" view="porDias" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="brown" showActions="preliminar, bitacora"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="false" allowInsert="false"}}
    {{param dias="90"}}
  {{/browser}} --}}
  {{#browser id="alumnosCurso" name="Alumnos" view="alta" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green" showActions="preliminar, diplomaParticipacion, bajaAlumno"}}
    {{param tipoSolicitud="inscripcionCurso"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
  {{#browser id="convocados" name="Convocados" view="convocados" showDoc="true" docOrientation="vertical" docPosition="75%" zoom="80%" color="green" showActions="preliminar"}}
    {{list itemTemplate="verSolicitud" allowSearch="true" allowRefresh="true" allowEdit="true" allowInsert="false"}}
  {{/browser}}
{{/define}}

{{#markup}}
  {{#template id="verSolicitud"}}
    <div class="list-material">
      <li class="has-action-left">
        {{#if semaforo}}
          <div class="list-action-left"><i class="icon ion-record text-{{semaforo}}"></i></div>
        {{else}}
          {{#if _unRead}}
            <div class="list-action-left"><i class="icon ion-record text-blue"></i></div>
          {{/if}}
          {{#if join.contexto.riesgoEpidemiologico.estaActivo}}
            <div class="list-action-left"><i class="icon ion-{{join.contexto.riesgoEpidemiologico.icono}} text-{{join.contexto.riesgoEpidemiologico.color}}"></i></div>
          {{else}}
            <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
          {{/if}}
        {{/if}}
        <div class="list-content">
          <span class="title">{{nombre}}
          {{#if base.esUrgente}}
          <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAltaPrioridad}}
          <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esMedianaPrioridad}}
          <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esBajaPrioridad}}
          <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
[.#if esRH.]
          {{#if esCandidato}}
            {{#if join.contexto.apegoPuesto}}
            <span class="fondo-{{colorApegoPuesto}}" style="font-size:12px;float:right;"><strong>&nbsp;{{join.contexto.apegoPuesto}}%&nbsp;</strong></span>
            {{/if}}
            {{#if join.contexto.tieneTrabajoActual}}
            <span class="fondo-amarillo" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Trabajo Actual&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if info.base.sinVacante}}
            <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Sin Vacante&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if info.grupo}}
            <span class="fondo-azul" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Grupo: {{info.grupo}}&nbsp;&nbsp;</strong></span>
            {{/if}}
          {{/if}}
[.else.]        
          {{#if noProgramada}}
          <span class="not-programmed" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;No Programada&nbsp;&nbsp;</strong></span>
          {{/if}}
[./if.]
          {{#if base.esAdicional}}
          <span class="is-additional" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esSobrante}}
          <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
          {{/if}}
          </span>
          {{#if base.esAreaCritica}}
          <span class="fondo-naranja" style="font-size:12px;"><strong>&nbsp;&nbsp;{{base._central}} {{join.contexto._cama}}&nbsp;&nbsp;</strong></span><br>
          {{else}}
            {{#if base._central}}
              <span style="font-size:12px;"><strong>{{base._central}} {{join.contexto._cama}}</strong></span><br>
            {{/if}}
          {{/if}}
[.#if esSIC.]
          {{#if info.base.servicio}}
            <span style="font-size:12px;"><strong>{{info.base._servicio}}</strong></span><br>
          {{/if}}
[.else.]
          {{#if persona.clave}}
            <span style="font-size:12px;">{{persona.clave}}</span>
            <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
            <br>
            {{#if _readOnly}}
            <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
            {{/if}}          
            {{#if join.contexto.esCasoMedicoLegal}}
            <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if join.contexto.cuentaCerrada}}
            <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.puedeAlta}}
              <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
              {{else}}
                {{#if join.contexto.puedeCerrar}}
                <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
                {{else}}
                  {{#if join.contexto.preAlta}}
                  <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
                  {{/if}}
                {{/if}}
              {{/if}}
            {{/if}}
            {{#if join._flags}}
              {{#with join._flags}}
                {{#if defuncion}}
                <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if cancerBucal}}
                <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if creher}}
                <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if hepatitis}}
                <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if labioPaladarHendido}}
                <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if iaas}}
                <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if suive}}
                <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pic}}
                <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pei}}
                <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if aislamiento}}
                  {{#with aislamiento.data}}
                    {{#if verde}}
                    <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                    {{/if}}
                    {{#if azul}}
                    <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                    {{/if}}
                    {{#if amarillo}}
                    <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                    {{/if}}
                    {{#if naranja}}
                    <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                    {{/if}}
                    {{#if gris}}
                    <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                    {{/if}}
                  {{/with}}                  
                {{/if}}
              {{/with}}
              <br>
            {{/if}}
          {{/if}}          
          {{#if persona.fechaNacimiento}}
            </br><span style="font-size:12px;">Nacimiento: {{date persona.fechaNacimiento "DD/MMM/YYYY"}}</span>
          {{/if}}          
[./if.]          
          {{#if _created.requestShort}}
            <span class="subProcess"><strong>{{_created.requestShort}}</strong></span><br>
          {{/if}}
          <span style="font-size:12px;white-space:pre-wrap;"><strong>{{#if base.subTipoSolicitud}}{{base._subTipoSolicitud}} - {{/if}}{{base._tipoSolicitud}} {{_created.folio}}</strong></span><br>
[.#if esSIC.]
          <span style="font-size:12px;white-space:pre-wrap;">{{_created.establishment}} {{date _created.date "D/MMM h:mma"}}{{#if semaforo}} - {{date info.base.vencimiento "D/MMM h:mma"}}{{/if}}</span><br>
[./if.]
[.#if esRH.]
          {{#if info.base.vencimiento}}
          <span style="font-size:12px;white-space:pre-wrap;">Vencimiento: {{date info.base.vencimiento "D/MMM h:mma"}}</span><br>
          {{/if}}
[./if.]
          {{#if _name1}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name1}}</span>
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;"><strong>{{_name2}}</strong></span>
          {{else}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name}}</span>
          {{/if}}
[.#if esHRAEI.]
          <br><span style="font-size:12px;">{{base._nota}} {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>
[./if.]
          {{#if base._solicitante}}
          </br><span style="font-size:12px;">{{base._solicitante}} / {{_especialidad}}</span>
          {{/if}}
          {{#if base.fechaHoraCita}}
          </br><span style="font-size:12px;">Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}</span>
          {{/if}}
[.#if esSIC.]
          {{#if base.criticidadZona}}
          <br><span class="zona-{{base.criticidadZona}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{base._criticidadZona}}&nbsp;&nbsp;</strong></span>
          {{/if}}
[./if.]
          {{#if _mensaje}}
          <br><span style="color:brown;font-size:12px;"><strong>{{_mensaje}}</strong></span>
          {{/if}}
          {{#if control.noConformidad}}
          <br><span class="fondo-amarillo-claro" style="font-size:12px;"><strong>&nbsp;&nbsp;No Conformidad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if control.incumplimiento}}
          <span class="fondo-rojo" style="font-size:12px;"><strong>&nbsp;&nbsp;Incumplimiento&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if esFormato2}}          
          <br><span style="white-space:pre-wrap;font-size:14px;" class="subMoment">{{control._subMoment}}</span>
          <br><span style="white-space:pre-wrap;font-style:italic;font-size:14px;" class="color-gris-obscuro"><strong>{{definicion}}</strong></span>
          {{else}}
            {{#if control.subMoment}}
            <span style="float:right;" class="subMoment">&nbsp;&nbsp;{{control._subMoment}}</span>
            {{/if}}
            {{#if _momentoActual}}
            <br><span style="{{#if _updated.reason}}color:red;{{/if}}font-size:12px;"><strong>{{_momentoActual}}</strong></span>
            {{/if}}
          {{/if}}
          {{#if _updated.reason}}
          <br><span style="color:red;font-size:12px;"><strong>{{_updated._reason}}</strong></span>
          {{/if}}
          {{#if _updated.reasonCommentaries}}
          <br><span style="color:red;font-size:12px;">{{_updated.reasonCommentaries}}</span>
          {{/if}}
          {{#if control.faltante}}
          <br><span style="color:red;font-size:12px;"><strong>Faltante: {{control.faltante}}</strong></span>
          {{/if}}
          {{#if base.fechaHoraRequerida}}
          <br><span style="color:teal;font-size:12px;"><strong>Fecha Hora Requerida: {{date base.fechaHoraRequerida "D/MMM h:mma"}}</strong></span>
          {{/if}}
          {{#if base.ubicacionEspecifica}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._ubicacionEspecifica}}</span>
          {{/if}}
          {{#if base.surtirAlmacenEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._surtirAlmacenEspecifico}}</span>
          {{/if}}
          {{#if base.surtirLoteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir con Lote Específico</span>
          {{/if}}
          {{#if base.loteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Lote Específico: {{base.loteEspecifico}}</span>
          {{/if}}
          {{#if info.base.folioReferencia}}
          <br><span style="color:green;font-size:12px;"><strong>Folio Asignado: {{info.base.folioReferencia}}</strong></span>
          {{/if}}
          {{#if info.base.anestesiologo}}
          <br><span style="color:green;font-size:12px;"><strong>Anestesiólogo: {{info.base._anestesiologo}}</strong></span>
          {{/if}}
          {{#if info.base.candidato}}
          <br><span style="color:green;font-size:12px;"><strong>Candidato: {{info.base._candidato}}</strong></span>
          {{/if}}
          {{#if join.persona.plazas}}
          <br><span style="font-size:12px;"><strong>{{join.persona.plazas}} Plazas</strong></span>
          {{/if}}
          {{#if leyenda}}
          <br><span style="font-size:12px;"><strong>{{leyenda}}</strong></span>
          {{/if}}          
          {{#if control.subMoment}}
            {{#unless _momentoActual}}{{#unless leyenda}}<br>{{/unless}}{{/unless}}
          {{/if}}
          <span style="color:darkcyan;font-size:12px;float:right;"><strong>&nbsp;&nbsp;{{_estatus}}</strong></span>
          {{#if control.resaltar}}
            <br><span class="fondo-amarillo-claro" style="font-size:12px;"><strong>&nbsp;&nbsp;{{control.resaltar}}&nbsp;&nbsp;</strong></span>
          {{/if}}
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verSolicitudSinPersona"}}
    <div class="list-material">
      <li class="has-action-left">
        {{#if semaforo}}
          <div class="list-action-left"><i class="icon ion-record text-{{semaforo}}"></i></div>
        {{else}}
          {{#if _unRead}}
            <div class="list-action-left"><i class="icon ion-record text-blue"></i></div>
          {{/if}}
          {{#if join.contexto.riesgoEpidemiologico.estaActivo}}
            <div class="list-action-left"><i class="icon ion-{{join.contexto.riesgoEpidemiologico.icono}} text-{{join.contexto.riesgoEpidemiologico.color}}"></i></div>
          {{else}}
            <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
          {{/if}}
        {{/if}}
        <div class="list-content">
          {{#if _created.requestShort}}
            <span class="subProcess"><strong>{{_created.requestShort}}</strong></span><br>
          {{/if}}
          <span style="font-size:14px;white-space:pre-wrap;"><strong>{{#if base.subTipoSolicitud}}{{base._subTipoSolicitud}} - {{/if}}{{base._tipoSolicitud}} {{_created.folio}}</strong></span><br>
[.#if esSIC.]
          <span style="font-size:12px;white-space:pre-wrap;">{{_created.establishment}} {{date _created.date "D/MMM h:mma"}}{{#if semaforo}} - {{date info.base.vencimiento "D/MMM h:mma"}}{{/if}}</span><br>
[./if.]
          {{#if _name1}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name1}}</span>
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;"><strong>{{_name2}}</strong></span>
          {{else}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name}}</span>
          {{/if}}
[.#if esHRAEI.]
          <br><span style="font-size:12px;">{{base._nota}} {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>
[./if.]
          {{#if base._solicitante}}
          </br><span style="font-size:12px;">{{base._solicitante}} / {{_especialidad}}</span>
          {{/if}}
          {{#if base.fechaHoraCita}}
          </br><span style="font-size:12px;">Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}</span>
          {{/if}}
[.#if esSIC.]
          {{#if base.criticidadZona}}
          <br><span class="zona-{{base.criticidadZona}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{base._criticidadZona}}&nbsp;&nbsp;</strong></span>
          {{/if}}
[./if.]
          {{#if control._mensaje}}
          <br><span style="color:brown;font-size:12px;"><strong>{{control._mensaje}}</strong></span>
          {{/if}}
          {{#if control.noConformidad}}
          <br><span class="fondo-amarillo-claro" style="font-size:12px;"><strong>&nbsp;&nbsp;No Conformidad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if control.incumplimiento}}
          <span class="fondo-rojo" style="font-size:12px;"><strong>&nbsp;&nbsp;Incumplimiento&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if control.subMoment}}
          <span style="float:right;" class="subMoment">&nbsp;&nbsp;{{control._subMoment}}</span>
          {{/if}}
          {{#if _momentoActual}}
          <br><span style="{{#if _updated.reason}}color:red;{{/if}}font-size:12px;"><strong>{{_momentoActual}}</strong></span>
          {{/if}}
          {{#if _updated.reason}}
          <br><span style="color:red;font-size:12px;"><strong>{{_updated._reason}}</strong></span>
          {{/if}}
          {{#if _updated.reasonCommentaries}}
          <br><span style="color:red;font-size:12px;">{{_updated.reasonCommentaries}}</span>
          {{/if}}
          {{#if control.faltante}}
          <br><span style="color:red;font-size:12px;"><strong>Faltante: {{control.faltante}}</strong></span>
          {{/if}}
          {{#if base.fechaHoraRequerida}}
          <br><span style="color:teal;font-size:12px;"><strong>Fecha Hora Requerida: {{date base.fechaHoraRequerida "D/MMM h:mma"}}</strong></span>
          {{/if}}
          {{#if base.ubicacionEspecifica}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._ubicacionEspecifica}}</span>
          {{/if}}
          {{#if base.surtirAlmacenEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._surtirAlmacenEspecifico}}</span>
          {{/if}}
          {{#if base.surtirLoteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir con Lote Específico</span>
          {{/if}}
          {{#if base.loteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Lote Específico: {{base.loteEspecifico}}</span>
          {{/if}}
          {{#if info.base.folioReferencia}}
          <br><span style="color:green;font-size:12px;"><strong>Folio Asignado: {{info.base.folioReferencia}}</strong></span>
          {{/if}}
          {{#if info.base.anestesiologo}}
          <br><span style="color:green;font-size:12px;"><strong>Anestesiólogo: {{info.base._anestesiologo}}</strong></span>
          {{/if}}
          {{#if info.base.candidato}}
          <br><span style="color:green;font-size:12px;"><strong>Candidato: {{info.base._candidato}}</strong></span>
          {{/if}}
          {{#if join.persona.plazas}}
          <br><span style="font-size:12px;"><strong>{{join.persona.plazas}} Plazas</strong></span>
          {{/if}}
          {{#if leyenda}}
          <br><span style="font-size:12px;"><strong>{{leyenda}}</strong></span>
          {{/if}}
          {{#if control.subMoment}}
            {{#unless _momentoActual}}{{#unless leyenda}}<br>{{/unless}}{{/unless}}
          {{/if}}
          <span style="color:darkcyan;font-size:12px;float:right;"><strong>&nbsp;&nbsp;{{_estatus}}</strong></span>
          {{#if control.resaltar}}
            <br><span class="fondo-amarillo-claro" style="font-size:12px;"><strong>&nbsp;&nbsp;{{control.resaltar}}&nbsp;&nbsp;</strong></span>
          {{/if}}
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verSolicitudGrupo"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      {{else}}
      <span>Sin datos</span>
      {{/if}}
      <span class="bold">{{base._nota}}</span><br>
      <span>{{nombre}}</span>
      {{#if base.esUrgente}}
      <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAltaPrioridad}}
      <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esMedianaPrioridad}}
      <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esBajaPrioridad}}
      <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAdicional}}
      <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esSobrante}}
      <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
      {{/if}}
      <br>
      {{#if base._central}}
        <span style="font-size:12px;">{{base._central}} {{join.contexto._cama}}</span><br>
      {{/if}}
      {{#if persona.clave}}
        <span style="font-size:12px;">{{persona.clave}}</span>
        <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
        <br>
        {{#if _readOnly}}
        <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
        {{/if}}          
        {{#if join.contexto.esCasoMedicoLegal}}
        <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
        {{/if}}
        {{#if join.contexto.cuentaCerrada}}
        <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
        {{else}}
          {{#if join.contexto.puedeAlta}}
          <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
          {{else}}
            {{#if join.contexto.puedeCerrar}}
            <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.preAlta}}
              <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
              {{/if}}
            {{/if}}
          {{/if}}
        {{/if}}
        {{#if join._flags}}
          {{#with join._flags}}
            {{#if defuncion}}
            <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if cancerBucal}}
            <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if creher}}
            <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if hepatitis}}
            <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if labioPaladarHendido}}
            <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if iaas}}
            <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if suive}}
            <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pic}}
            <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pei}}
            <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if aislamiento}}
              {{#with aislamiento.data}}
                {{#if verde}}
                <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                {{/if}}
                {{#if azul}}
                <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                {{/if}}
                {{#if amarillo}}
                <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                {{/if}}
                {{#if naranja}}
                <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                {{/if}}
                {{#if gris}}
                <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                {{/if}}
              {{/with}}                  
            {{/if}}
          {{/with}}
          <br>
        {{/if}}
      {{/if}}
      {{#if _id}}
      <span style="font-size:12px;">Solicitado: {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>      
      {{/if}}
      {{#if base._solicitante}}
      </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorCodigo"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      {{else}}
      <span>Sin datos</span>
      {{/if}}
      <span class="bold">{{base.descripcion}} ({{base.codigo}})</span><br>
      <span>{{nombre}}</span>
      {{#if base.esUrgente}}
      <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAltaPrioridad}}
      <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esMedianaPrioridad}}
      <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esBajaPrioridad}}
      <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAdicional}}
      <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esSobrante}}
      <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
      {{/if}}
      <br>
      {{#if base._central}}
        <span style="font-size:12px;">{{base._central}} {{join.contexto._cama}}</span><br>
      {{/if}}
      {{#if persona.clave}}
        <span style="font-size:12px;">{{persona.clave}}</span>
        <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
        <br>
        {{#if _readOnly}}
        <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
        {{/if}}          
        {{#if join.contexto.esCasoMedicoLegal}}
        <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
        {{/if}}
        {{#if join.contexto.cuentaCerrada}}
        <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
        {{else}}
          {{#if join.contexto.puedeAlta}}
          <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
          {{else}}
            {{#if join.contexto.puedeCerrar}}
            <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.preAlta}}
              <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
              {{/if}}
            {{/if}}
          {{/if}}
        {{/if}}
        {{#if join._flags}}
          {{#with join._flags}}
            {{#if defuncion}}
            <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if cancerBucal}}
            <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if creher}}
            <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if hepatitis}}
            <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if labioPaladarHendido}}
            <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if iaas}}
            <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if suive}}
            <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pic}}
            <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pei}}
            <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if aislamiento}}
              {{#with aislamiento.data}}
                {{#if verde}}
                <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                {{/if}}
                {{#if azul}}
                <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                {{/if}}
                {{#if amarillo}}
                <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                {{/if}}
                {{#if naranja}}
                <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                {{/if}}
                {{#if gris}}
                <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                {{/if}}
              {{/with}}                  
            {{/if}}
          {{/with}}
          <br>
        {{/if}}
      {{/if}}
      {{#if _id}}
      <span style="font-size:12px;">Solicitado: {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>      
      {{/if}}
      {{#if base._solicitante}}
      </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorTipo"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      {{else}}
      <span>Sin datos</span>
      {{/if}}
      <span class="bold">{{base._tipoSolicitud}}</span><br>
      <span>{{nombre}}</span>
      {{#if base.esUrgente}}
      <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAltaPrioridad}}
      <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esMedianaPrioridad}}
      <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esBajaPrioridad}}
      <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAdicional}}
      <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esSobrante}}
      <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
      {{/if}}
      <br>
      {{#if base._central}}
        <span style="font-size:12px;">{{base._central}} {{join.contexto._cama}}</span><br>
      {{/if}}
      {{#if persona.clave}}
        <span style="font-size:12px;">{{persona.clave}}</span>
        <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
        <br>
        {{#if _readOnly}}
        <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
        {{/if}}          
        {{#if join.contexto.esCasoMedicoLegal}}
        <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
        {{/if}}
        {{#if join.contexto.cuentaCerrada}}
        <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
        {{else}}
          {{#if join.contexto.puedeAlta}}
          <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
          {{else}}
            {{#if join.contexto.puedeCerrar}}
            <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.preAlta}}
              <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
              {{/if}}
            {{/if}}
          {{/if}}
        {{/if}}
        {{#if join._flags}}
          {{#with join._flags}}
            {{#if defuncion}}
            <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if cancerBucal}}
            <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if creher}}
            <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if hepatitis}}
            <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if labioPaladarHendido}}
            <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if iaas}}
            <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if suive}}
            <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pic}}
            <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pei}}
            <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if aislamiento}}
              {{#with aislamiento.data}}
                {{#if verde}}
                <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                {{/if}}
                {{#if azul}}
                <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                {{/if}}
                {{#if amarillo}}
                <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                {{/if}}
                {{#if naranja}}
                <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                {{/if}}
                {{#if gris}}
                <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                {{/if}}
              {{/with}}                  
            {{/if}}
          {{/with}}
          <br>
        {{/if}}
      {{/if}}
      {{#if _id}}
      <span style="font-size:12px;">Solicitado: {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>      
      {{/if}}
      {{#if base._solicitante}}
      </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorPuesto"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      <span class="bold">{{info.base._puesto}}</span><br>
      {{else}}
      <span>Sin datos</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorSubTipo"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      <span class="bold">{{#if base.subTipoSolicitud}}{{base._subTipoSolicitud}}{{else}}{{base._tipoSolicitud}}{{/if}}</span><br>
      {{else}}
      <span>Sin datos</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorMomento"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      <span class="bold">{{#if control._subMoment}}{{control._subMoment}}{{else}}{{_updated._moment}}{{/if}}</span><br>
      {{else}}
      <span>Sin datos</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorAntiguedadRequerida"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      <span class="bold">{{base.datosCurso.base._antiguedadRequerida}}</span><br>
      {{else}}
      <span>Sin datos</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorPersona"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      <span class="bold">{{persona.nombreCompleto}}</span><br>
      {{else}}
      <span>Sin datos</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorServicio"}}
    <div>
      {{#if _id}}
      <img class="auto-img-lista" src="https://his-imagenes.s3-accelerate.amazonaws.com/widgets/folder.png">
      {{else}}
      <span>Sin datos</span>
      {{/if}}
      <span class="bold">{{_servicio}}</span><br>
      <span>{{nombre}}</span>
      {{#if base.esUrgente}}
      <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAltaPrioridad}}
      <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esMedianaPrioridad}}
      <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esBajaPrioridad}}
      <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esAdicional}}
      <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
      {{/if}}
      {{#if base.esSobrante}}
      <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
      {{/if}}
      <br>
      {{#if base._central}}
        <span style="font-size:12px;">{{base._central}} {{join.contexto._cama}}</span><br>
      {{/if}}
      {{#if persona.clave}}
        <span style="font-size:12px;">{{persona.clave}}</span>
        <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
        <br>
        {{#if _readOnly}}
        <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
        {{/if}}          
        {{#if join.contexto.esCasoMedicoLegal}}
        <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
        {{/if}}
        {{#if join.contexto.cuentaCerrada}}
        <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
        {{else}}
          {{#if join.contexto.puedeAlta}}
          <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
          {{else}}
            {{#if join.contexto.puedeCerrar}}
            <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.preAlta}}
              <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
              {{/if}}
            {{/if}}
          {{/if}}
        {{/if}}
        {{#if join._flags}}
          {{#with join._flags}}
            {{#if defuncion}}
            <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if cancerBucal}}
            <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if creher}}
            <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if hepatitis}}
            <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if labioPaladarHendido}}
            <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if iaas}}
            <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if suive}}
            <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pic}}
            <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if pei}}
            <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if aislamiento}}
              {{#with aislamiento.data}}
                {{#if verde}}
                <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                {{/if}}
                {{#if azul}}
                <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                {{/if}}
                {{#if amarillo}}
                <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                {{/if}}
                {{#if naranja}}
                <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                {{/if}}
                {{#if gris}}
                <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                {{/if}}
              {{/with}}                  
            {{/if}}
          {{/with}}
          <br>
        {{/if}}
      {{/if}}
      {{#if _id}}
      <span style="font-size:12px;">Solicitado: {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>      
      {{/if}}
      {{#if base._solicitante}}
      </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
      {{/if}}
    </div>
  {{/template}}    
  {{#template id="verSolicitudDetalle"}}
    <div class="list-material">
      <li class="has-action-left">
        {{#if join.contexto.riesgoEpidemiologico.estaActivo}}
          <div class="list-action-left"><i class="icon ion-{{join.contexto.riesgoEpidemiologico.icono}} text-{{join.contexto.riesgoEpidemiologico.color}}"></i></div>
        {{else}}
          <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
        {{/if}}        
        <div class="list-content">
          <span style="white-space:pre-wrap;">{{_name}}</span>
          {{#if base.fechaHoraCita}}
          <br><span style="font-size:12px;">Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}</span>
          {{/if}}
          {{#if control.faltante}}
          <br><span style="color:red;font-size:12px;"><strong>Faltante: {{control.faltante}}</strong></span>
          {{/if}}
          {{#if _momentoActual}}
          <br><span style="{{#if _updated.reason}}color:red;{{/if}}font-size:12px;"><strong>{{_momentoActual}}</strong></span>
          {{/if}}
          {{#if _updated.reason}}
          <br><span style="color:red;font-size:12px;"><strong>{{_updated._reason}}</strong></span>
          {{/if}}
          {{#if _updated.reasonCommentaries}}
          <br><span style="color:red;font-size:12px;">{{_updated.reasonCommentaries}}</span>
          {{/if}}
          {{#if base.ubicacionEspecifica}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._ubicacionEspecifica}}</span>
          {{/if}}
          {{#if base.surtirAlmacenEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._surtirAlmacenEspecifico}}</span>
          {{/if}}
          {{#if base.surtirLoteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir con Lote Específico</span>
          {{/if}}
          {{#if base.loteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Lote Específico: {{base.loteEspecifico}}</span>
          {{/if}}
          {{#if info.base.folioReferencia}}
          <br><span style="color:green;font-size:12px;"><strong>Folio Asignado: {{info.base.folioReferencia}}</strong></span>
          {{/if}}
          {{#if info.base.anestesiologo}}
          <br><span style="color:green;font-size:12px;"><strong>Anestesiólogo: {{info.base._anestesiologo}}</strong></span>
          {{/if}}
          {{#if info.base.candidato}}
          <br><span style="color:green;font-size:12px;"><strong>Candidato: {{info.base._candidato}}</strong></span>
          {{/if}}
          {{#if join.persona.plazas}}
          <br><span style="font-size:12px;"><strong>{{join.persona.plazas}} Plazas</strong></span>
          {{/if}}
          {{#if leyenda}}
          <br><span style="font-size:12px;"><strong>{{leyenda}}</strong></span>
          {{/if}}          
          {{#if control.subMoment}}
          <span style="float:right;" class="moment2">{{control._subMoment}}</span>
          {{/if}}
          <br><span style="font-size:12px;"><strong>{{base._tipoSolicitud}} {{_created.folio}}</strong></span>
          <span style="color:darkcyan;font-size:12px;float:right;"><strong>{{_estatus}}</strong></span>
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorCobrar"}}
    <div class="list-material">
      <li class="has-action-left">
        {{#if join.contexto.riesgoEpidemiologico.estaActivo}}
          <div class="list-action-left"><i class="icon ion-{{join.contexto.riesgoEpidemiologico.icono}} text-{{join.contexto.riesgoEpidemiologico.color}}"></i></div>
        {{else}}
          <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
        {{/if}}        
        <div class="list-content">
          <span class="title">{{nombre}}
          {{#if base.esUrgente}}
          <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAltaPrioridad}}
          <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esMedianaPrioridad}}
          <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esBajaPrioridad}}
          <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if noProgramada}}
          <span class="not-programmed" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;No Programada&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAdicional}}
          <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esSobrante}}
          <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
          {{/if}}
          </span>
          {{#if base._central}}
            <span style="font-size:12px;"><strong>{{base._central}} {{join.contexto._cama}}</strong></span><br>
          {{/if}}
          {{#if persona.clave}}
            <span style="font-size:12px;">{{persona.clave}}</span>
            <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
            <br>
            {{#if _readOnly}}
            <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
            {{/if}}          
            {{#if join.contexto.esCasoMedicoLegal}}
            <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if join.contexto.cuentaCerrada}}
            <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.puedeAlta}}
              <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
              {{else}}
                {{#if join.contexto.puedeCerrar}}
                <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
                {{else}}
                  {{#if join.contexto.preAlta}}
                  <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
                  {{/if}}
                {{/if}}
              {{/if}}
            {{/if}}
            {{#if join._flags}}
              {{#with join._flags}}
                {{#if defuncion}}
                <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if cancerBucal}}
                <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if creher}}
                <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if hepatitis}}
                <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if labioPaladarHendido}}
                <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if iaas}}
                <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if suive}}
                <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pic}}
                <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pei}}
                <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if aislamiento}}
                  {{#with aislamiento.data}}
                    {{#if verde}}
                    <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                    {{/if}}
                    {{#if azul}}
                    <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                    {{/if}}
                    {{#if amarillo}}
                    <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                    {{/if}}
                    {{#if naranja}}
                    <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                    {{/if}}
                    {{#if gris}}
                    <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                    {{/if}}
                  {{/with}}
                {{/if}}
              {{/with}}
              <br>
            {{/if}}
          {{/if}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name}}</span>
          {{#if control.faltante}}
          <br><span style="color:red;font-size:12px;"><strong>Faltante: {{control.faltante}}</strong></span>
          {{/if}}
          <br><span style="font-size:12px;">Solicitud: {{_created.folio}} {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>
          <span style="font-size:12px;float:right;">{{#if base.fechaHoraCita}}Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}{{!--  {{base.duracionCita}} min{{else}}{{date _created.date "DD/MMM/YYYY h:mma"}} --}}{{/if}}</span>
          {{#if base._solicitante}}
          </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
          {{/if}}
          {{#if base._nota}}<br><span style="font-size:12px;">Generado por: {{base._nota}}{{/if}}</span>
          </br><span style="font-size:12px;"><strong>Importe: {{format control.importe "currency"}}</strong></span>
          {{#if control.porCobrar}}
          </br><span class="especifico2" style="font-size:12px;"><strong>Por Cobrar: {{format control.porCobrar "currency"}}</strong></span>
          {{/if}}
          {{#if control.porPagar}}
          </br><span class="especifico2" style="font-size:12px;"><strong>Por Pagar: {{format control.porPagar "currency"}}</strong></span>
          {{/if}}
          {{#if base.ubicacionEspecifica}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._ubicacionEspecifica}}</span>
          {{/if}}
          {{#if base.surtirAlmacenEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._surtirAlmacenEspecifico}}</span>
          {{/if}}
          {{#if base.surtirLoteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir con Lote Específico</span>
          {{/if}}
          {{#if base.loteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Lote Específico: {{base.loteEspecifico}}</span>
          {{/if}}
          {{#if leyenda}}
          <br><span style="font-size:12px;"><strong>{{leyenda}}</strong></span>
          {{/if}}
          {{#if control.subMoment}}
          <span style="float:right;" class="moment2">{{control._subMoment}}</span>
          {{/if}}
          <br><span style="font-size:12px;"><strong>{{base._tipoSolicitud}} {{_created.folio}}</strong></span>
          <span style="font-size:12px;float:right;"><strong>{{_estatus}}{{#if _updated.reason}} - {{_updated._reason}}{{/if}}</strong></span>
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verSolicitudPorAplicar"}}
    <div class="list-material">
      <li class="has-action-left">
        {{#if join.contexto.riesgoEpidemiologico.estaActivo}}
          <div class="list-action-left"><i class="icon ion-{{join.contexto.riesgoEpidemiologico.icono}} text-{{join.contexto.riesgoEpidemiologico.color}}"></i></div>
        {{else}}
          <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
        {{/if}}        
        <div class="list-content">
          <span class="title">{{nombre}}
          {{#if base.esUrgente}}
          <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAltaPrioridad}}
          <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esMedianaPrioridad}}
          <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esBajaPrioridad}}
          <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if noProgramada}}
          <span class="not-programmed" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;No Programada&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAdicional}}
          <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esSobrante}}
          <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
          {{/if}}
          </span>
          {{#if base._central}}
            <span style="font-size:12px;"><strong>{{base._central}} {{join.contexto._cama}}</strong></span><br>
          {{/if}}
          {{#if persona.clave}}
            <span style="font-size:12px;">{{persona.clave}}</span>
            <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
            <br>
            {{#if _readOnly}}
            <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
            {{/if}}          
            {{#if join.contexto.esCasoMedicoLegal}}
            <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if join.contexto.cuentaCerrada}}
            <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.puedeAlta}}
              <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
              {{else}}
                {{#if join.contexto.puedeCerrar}}
                <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
                {{else}}
                  {{#if join.contexto.preAlta}}
                  <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
                  {{/if}}
                {{/if}}
              {{/if}}
            {{/if}}
            {{#if join._flags}}
              {{#with join._flags}}
                {{#if defuncion}}
                <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if cancerBucal}}
                <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if creher}}
                <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if hepatitis}}
                <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if labioPaladarHendido}}
                <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if iaas}}
                <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if suive}}
                <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pic}}
                <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pei}}
                <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if aislamiento}}
                  {{#with aislamiento.data}}
                    {{#if verde}}
                    <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                    {{/if}}
                    {{#if azul}}
                    <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                    {{/if}}
                    {{#if amarillo}}
                    <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                    {{/if}}
                    {{#if naranja}}
                    <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                    {{/if}}
                    {{#if gris}}
                    <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                    {{/if}}
                  {{/with}}
                {{/if}}
              {{/with}}
              <br>
            {{/if}}
          {{/if}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name}}</span>
          {{#if control.faltante}}
          <br><span style="color:red;font-size:12px;"><strong>Faltante: {{control.faltante}}</strong></span>
          {{/if}}
          <br><span style="font-size:12px;">Solicitud: {{_created.folio}} {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>
          <span style="font-size:12px;float:right;">{{#if base.fechaHoraCita}}Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}{{!--  {{base.duracionCita}} min{{else}}{{date _created.date "DD/MMM/YYYY h:mma"}} --}}{{/if}}</span>
          {{#if base._solicitante}}
          </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
          {{/if}}
          {{#if base._nota}}<br><span style="font-size:12px;">Generado por: {{base._nota}}{{/if}}</span>
          </br><span style="font-size:12px;"><strong>Importe: {{format control.importe "currency"}}</strong></span>
          </br><span class="especifico2" style="font-size:12px;"><strong>Por Aplicar: {{format control.porPagar "currency"}}</strong></span>
          {{#if leyenda}}
          <br><span style="font-size:12px;"><strong>{{leyenda}}</strong></span>
          {{/if}}
          {{#if control.subMoment}}
          <span style="float:right;" class="moment2">{{control._subMoment}}</span>
          {{/if}}
          <br><span style="font-size:12px;"><strong>{{base._tipoSolicitud}} {{_created.folio}}</strong></span>
          <span style="font-size:12px;float:right;"><strong>{{_estatus}}{{#if _updated.reason}} - {{_updated._reason}}{{/if}}</strong></span>
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verFechaRequerida"}}
    <div class="list-material">
      <li class="has-action-left">
        <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
        <div class="list-content">
          <span class="title">{{nombre}}
          {{#if base.esUrgente}}
          <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAltaPrioridad}}
          <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esMedianaPrioridad}}
          <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esBajaPrioridad}}
          <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if noProgramada}}
          <span class="not-programmed" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;No Programada&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAdicional}}
          <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esSobrante}}
          <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
          {{/if}}
          </span>
          {{#if base._central}}
            <span style="font-size:12px;"><strong>{{base._central}} {{join.contexto._cama}}</strong></span><br>
          {{/if}}
          {{#if persona.clave}}
            <span style="font-size:12px;">{{persona.clave}}</span>
            <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
            <br>
            {{#if _readOnly}}
            <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
            {{/if}}          
            {{#if join.contexto.esCasoMedicoLegal}}
            <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if join.contexto.cuentaCerrada}}
            <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.puedeAlta}}
              <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
              {{else}}
                {{#if join.contexto.puedeCerrar}}
                <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
                {{else}}
                  {{#if join.contexto.preAlta}}
                  <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
                  {{/if}}
                {{/if}}
              {{/if}}
            {{/if}}
            {{#if join._flags}}
              {{#with join._flags}}
                {{#if defuncion}}
                <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if cancerBucal}}
                <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if creher}}
                <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if hepatitis}}
                <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if labioPaladarHendido}}
                <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if iaas}}
                <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if suive}}
                <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pic}}
                <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pei}}
                <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if aislamiento}}
                  {{#with aislamiento.data}}
                    {{#if verde}}
                    <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                    {{/if}}
                    {{#if azul}}
                    <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                    {{/if}}
                    {{#if amarillo}}
                    <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                    {{/if}}
                    {{#if naranja}}
                    <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                    {{/if}}
                    {{#if gris}}
                    <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                    {{/if}}
                  {{/with}}
                {{/if}}
              {{/with}}
              <br>
            {{/if}}
          {{/if}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_name}}</span>
          <br><span style="font-size:12px;">Solicitud: {{_created.folio}} {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>
          <span style="font-size:12px;float:right;">{{#if base.fechaHoraCita}}Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}{{!--  {{base.duracionCita}} min{{else}}{{date _created.date "DD/MMM/YYYY h:mma"}} --}}{{/if}}</span>
          {{#if base._solicitante}}
          </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
          {{/if}}
          {{#if base._nota}}<br><span style="font-size:12px;">Generado por: {{base._nota}}{{/if}}</span>
          <span style="font-size:12px;float:right;"><strong>{{date fechaRequerida "D/MMM h:mma"}}</strong></span>
          {{#if base.ubicacionEspecifica}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._ubicacionEspecifica}}</span>
          {{/if}}
          {{#if base.surtirAlmacenEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._surtirAlmacenEspecifico}}</span>
          {{/if}}
          {{#if base.surtirLoteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir con Lote Específico</span>
          {{/if}}
          {{#if base.loteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Lote Específico: {{base.loteEspecifico}}</span>
          {{/if}}
          {{#if leyenda}}
          <span style="font-size:12px;float:right;"><strong>{{leyenda}}</strong></span>
          {{/if}}
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verPuedePasar"}}
    <div class="list-material">
      <li class="has-action-left">
        {{#if join.contexto.riesgoEpidemiologico.estaActivo}}
          <div class="list-action-left"><i class="icon ion-{{join.contexto.riesgoEpidemiologico.icono}} text-{{join.contexto.riesgoEpidemiologico.color}}"></i></div>
        {{else}}
          <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
        {{/if}}
        <div class="list-content">
          <span class="title">{{nombre}}
          {{#if base.esUrgente}}
          <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAltaPrioridad}}
          <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esMedianaPrioridad}}
          <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esBajaPrioridad}}
          <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if noProgramada}}
          <span class="not-programmed" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;No Programada&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAdicional}}
          <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esSobrante}}
          <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
          {{/if}}
          </span>
          {{#if base._central}}
            <span style="font-size:12px;"><strong>{{base._central}} {{join.contexto._cama}}</strong></span><br>
          {{/if}}
          {{#if persona.clave}}
            <span style="font-size:12px;">{{persona.clave}}</span>
            <span style="font-size:12px;float:right;">{{persona._genero}}{{#if persona._tipoSanguineo}}, {{persona._tipoSanguineo}}{{/if}}</span>
            <br>
            {{#if _readOnly}}
            <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
            {{/if}}          
            {{#if join.contexto.esCasoMedicoLegal}}
            <span class="cml" style="font-size:12px;"><strong>&nbsp;&nbsp;CML&nbsp;&nbsp;</strong></span>
            {{/if}}
            {{#if join.contexto.cuentaCerrada}}
            <span class="closed-account" style="font-size:12px;"><strong>&nbsp;&nbsp;Cuenta Cerrada&nbsp;&nbsp;</strong></span>
            {{else}}
              {{#if join.contexto.puedeAlta}}
              <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
              {{else}}
                {{#if join.contexto.puedeCerrar}}
                <span class="puede-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Alta&nbsp;&nbsp;</strong></span>
                {{else}}
                  {{#if join.contexto.preAlta}}
                  <span class="pre-alta" style="font-size:12px;"><strong>&nbsp;&nbsp;Pre Alta&nbsp;&nbsp;</strong></span>
                  {{/if}}
                {{/if}}
              {{/if}}
            {{/if}}
            {{#if join._flags}}
              {{#with join._flags}}
                {{#if defuncion}}
                <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if cancerBucal}}
                <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if creher}}
                <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if hepatitis}}
                <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if labioPaladarHendido}}
                <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if iaas}}
                <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if suive}}
                <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pic}}
                <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if pei}}
                <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
                {{/if}}
                {{#if aislamiento}}
                  {{#with aislamiento.data}}
                    {{#if verde}}
                    <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                    {{/if}}
                    {{#if azul}}
                    <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                    {{/if}}
                    {{#if amarillo}}
                    <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                    {{/if}}
                    {{#if naranja}}
                    <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                    {{/if}}
                    {{#if gris}}
                    <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                    {{/if}}
                  {{/with}}
                {{/if}}
              {{/with}}
              <br>
            {{/if}}
          {{/if}}
          <span style="font-size:12px;white-space:pre-wrap;font-style:italic;">{{_parent.name}}</span>          
          <br><span style="font-size:12px;">Solicitud: {{_created.folio}} {{date _created.date "D/MMM h:mma"}}{{#if info.base.cama}}, {{info.base._cama}}{{/if}}</span>
          <span style="font-size:12px;float:right;">{{#if base.fechaHoraCita}}Cita: {{date base.fechaHoraCita "D/MMM h:mma"}}{{!--  {{base.duracionCita}} min{{else}}{{date _created.date "DD/MMM/YYYY h:mma"}} --}}{{/if}}</span>
          {{#if base._solicitante}}
          </br><span style="font-size:12px;">Solicitante: {{base._solicitante}} {{base._especialidad}}</span>
          {{/if}}
          {{#if base._nota}}<br><span style="font-size:12px;">Generado por: {{base._nota}}{{/if}}</span>
          <span style="font-size:12px;float:right;">
          <strong>
          {{#if puedePasar}}
            Puede Pasar
          {{else}}
            {{#if enAtencion}}
              En Atención
            {{else}}
              {{#if porCobrar}}Saldo: {{format porCobrar "currency"}}{{else}}COBRADO{{/if}}
            {{/if}}
          {{/if}}
          </strong></span>
          {{#if base.ubicacionEspecifica}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._ubicacionEspecifica}}</span>
          {{/if}}
          {{#if base.surtirAlmacenEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir de: {{base._surtirAlmacenEspecifico}}</span>
          {{/if}}
          {{#if base.loteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Lote Específico: {{base.loteEspecifico}}</span>
          {{/if}}
          {{#if base.surtirLoteEspecifico}}
          </br><span class="especifico" style="font-size:12px;">Surtir con Lote Específico</span>
          {{/if}}
          {{#if leyenda}}
          <span style="font-size:12px;float:right;"><strong>{{leyenda}}</strong></span>
          {{/if}}
        </div>          
      </li>
    </div>
  {{/template}}    
  {{#template id="verSolicitudNombreCorto"}}
    <div class="list-material">
      <li class="has-action-left">
        <div class="list-action-left"><i class="icon ion-{{icono}} text-{{color}}"></i></div>
        <div class="list-content">
          <span class="title">{{base.nombreCorto}}
          {{#if base.esUrgente}}
          <span class="urgent" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Urgente&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAltaPrioridad}}
          <span class="high-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Alta Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esMedianaPrioridad}}
          <span class="medium-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Mediana Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esBajaPrioridad}}
          <span class="low-priority" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Baja Prioridad&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if noProgramada}}
          <span class="not-programmed" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;No Programada&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esAdicional}}
          <span class="missing" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Adicional&nbsp;&nbsp;</strong></span>
          {{/if}}
          {{#if base.esSobrante}}
          <span class="is-leftover" style="font-size:12px;float:right;"><strong>&nbsp;&nbsp;Es Sobrante&nbsp;&nbsp;</strong></span>
          {{/if}}
          </span>
          <br>
          {{#if _readOnly}}
          <span class="read-only" style="font-size:12px;"><strong>&nbsp;&nbsp;Solo Lectura&nbsp;&nbsp;</strong></span>
          {{/if}}          
          {{#if join._flags}}
            {{#with join._flags}}
              {{#if defuncion}}
              <span class="fondo-{{defuncion.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{defuncion.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if cancerBucal}}
              <span class="fondo-{{cancerBucal.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{cancerBucal.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if creher}}
              <span class="fondo-{{creher.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{creher.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if hepatitis}}
              <span class="fondo-{{hepatitis.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{hepatitis.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if labioPaladarHendido}}
              <span class="fondo-{{labioPaladarHendido.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{labioPaladarHendido.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if iaas}}
              <span class="fondo-{{iaas.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{iaas.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if suive}}
              <span class="fondo-{{suive.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{suive.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if pic}}
              <span class="fondo-{{pic.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pic.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if pei}}
              <span class="fondo-{{pei.color}}" style="font-size:12px;"><strong>&nbsp;&nbsp;{{pei.name}}&nbsp;&nbsp;</strong></span>
              {{/if}}
              {{#if aislamiento}}
                {{#with aislamiento.data}}
                  {{#if verde}}
                  <br><span style="font-size:12px;" class="color-verde">Aislamiento Precauciones Gotas</span>
                  {{/if}}
                  {{#if azul}}
                  <br><span style="font-size:12px;" class="color-azul">Aislamiento Precauciones Vía Aérea</span>
                  {{/if}}
                  {{#if amarillo}}
                  <br><span style="font-size:12px;" class="color-amarillo">Aislamiento Precauciones Contacto</span>
                  {{/if}}
                  {{#if naranja}}
                  <br><span style="font-size:12px;" class="color-naranja">Aislamiento Precauciones Contacto Plus</span>
                  {{/if}}
                  {{#if gris}}
                  <br><span style="font-size:12px;" class="color-gris-obscuro">Aislamiento Precauciones Protección</span>
                  {{/if}}
                {{/with}}
              {{/if}}
            {{/with}}
            <br>
          {{/if}}
          {{#if _updated._moment}}
          <span style="font-size:12px;"><strong>{{_updated._moment}}</strong></span>
          {{/if}}
        </div>          
      </li>
    </div>
  {{/template}}    
{{/markup}}