{{#define id="notaTempEgresos"}}
  {{#action id="afectar" confirm="=calc.in('SI', _.union(calc.pluckRef([base.afeccionPrincipal], 'base.excedeLimiteEdad'),calc.pluckRef([base.afeccionPrincipalReseleccionada], 'base.excedeLimiteEdad'),calc.pluckRef(base.otrosDiagnosticos, 'base.excedeLimiteEdad')))" confirmMessage="Diagnóstico Excede Límite Edad<br>¿Desea continuar?"}}
    {{#update section="base"}}
      {{set excedeLimiteEdad="=calc.in('SI', _.union(calc.pluckRef([base.afeccionPrincipal], 'base.excedeLimiteEdad'),calc.pluckRef([base.afeccionPrincipalReseleccionada], 'base.excedeLimiteEdad'),calc.pluckRef(base.otrosDiagnosticos, 'base.excedeLimiteEdad')))?'SI':'NO'"}}
    {{/update}}
  {{/action}}

  {{#section id="base"}}
    {{validator type="expr" notValidIf="=calc.hasDuplicates(calc.mergeArrays(afeccionPrincipal.base.diagnostico, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.diagnostico, calc.pluckRef(@otrosDiagnosticos, 'base.diagnostico')), @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.diagnostico)" message="Tiene Diagnósticos Duplicados"}}
    {{validator type="expr" notValidIf="=calc.hasDuplicates(calc.mergeArrays(afeccionPrincipal.base.validoSeul, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.validoSeul, calc.pluckRef(@otrosDiagnosticos, 'base.validoSeul')), null, 'PARTO')" message="Tiene Diagnósticos de tipo PARTO Duplicados"}}
    {{validator type="expr" notValidIf="=calc.hasDuplicates(calc.mergeArrays(afeccionPrincipal.base.validoSeul, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.validoSeul, calc.pluckRef(@otrosDiagnosticos, 'base.validoSeul')), null, 'ABORTO')" message="Tiene Diagnósticos de tipo ABORTO Duplicados"}}
    {{validator type="expr" notValidIf="=calc.in('MUJER_FERTIL', calc.mergeArrays(afeccionPrincipal.base.validoEgresos, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.validoEgresos, calc.pluckRef(@otrosDiagnosticos, 'base.validoEgresos')))&&!calc.in(@mujerFertil, ['embarazo','puerperio'])" message="Tiene Diagnósticos con MUJER FERTIL Incorrecto"}}
    {{validator type="expr" notValidIf="=calc.in('PARTO', calc.mergeArrays(afeccionPrincipal.base.validoSeul, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.validoSeul, calc.pluckRef(@otrosDiagnosticos, 'base.validoSeul')))&&calc.getRef(@datosMujer, 'base.tipoAtencionObstetrica')!='parto'" message="Tiene Diagnósticos que Requieren Atención Obstétrica de PARTO"}}
    {{validator type="expr" notValidIf="=calc.in('ABORTO', calc.mergeArrays(afeccionPrincipal.base.validoSeul, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.validoSeul, calc.pluckRef(@otrosDiagnosticos, 'base.validoSeul')))&&calc.getRef(@datosMujer, 'base.tipoAtencionObstetrica')!='aborto'" message="Tiene Diagnósticos que Requieren Atención Obstétrica de ABORTO"}}
    {{validator type="expr" notValidIf="=calc.in('EUTOCICO', calc.mergeArrays(afeccionPrincipal.base.tipoProducto, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.tipoProducto, calc.pluckRef(@otrosDiagnosticos, 'base.tipoProducto')))&&calc.getRef(@datosMujer, 'base.tipoNacimiento')!='eutocico'" message="Tiene Diagnósticos que Requieren Tipo Nacimiento EUTÓCICO"}}
    {{validator type="expr" notValidIf="=calc.in('DISTOCICO', calc.mergeArrays(afeccionPrincipal.base.tipoProducto, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.tipoProducto, calc.pluckRef(@otrosDiagnosticos, 'base.tipoProducto')))&&calc.getRef(@datosMujer, 'base.tipoNacimiento')!='distocico'" message="Tiene Diagnósticos que Requieren Tipo Nacimiento DISTÓCICO VAGINAL"}}
    {{validator type="expr" notValidIf="=calc.in('CESAREA', calc.mergeArrays(afeccionPrincipal.base.tipoProducto, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.tipoProducto, calc.pluckRef(@otrosDiagnosticos, 'base.tipoProducto')))&&calc.getRef(@datosMujer, 'base.tipoNacimiento')!='cesarea'" message="Tiene Diagnósticos que Requieren Tipo Nacimiento CESÁREA"}}
    {{validator type="expr" notValidIf="=calc.in('UNICO', calc.mergeArrays(afeccionPrincipal.base.tipoNacimiento, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.tipoNacimiento, calc.pluckRef(@otrosDiagnosticos, 'base.tipoNacimiento')))&&calc.getRef(@datosMujer, 'base.tipoEmbarazo')!='unico'" message="Tiene Diagnósticos que Requieren Producto ÚNICO"}}
    {{validator type="expr" notValidIf="=calc.in('MULTIPLE', calc.mergeArrays(afeccionPrincipal.base.tipoNacimiento, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.tipoNacimiento, calc.pluckRef(@otrosDiagnosticos, 'base.tipoNacimiento')))&&!calc.in(calc.getRef(@datosMujer, 'base.tipoEmbarazo'), ['gemelar','tresMas'])" message="Tiene Diagnósticos que Requieren Producto GEMELAR o TRES O MÁS"}}
    {{validator type="expr" notValidIf="=calc.in('CESAREA', calc.pluckRef(@procedimientoEgresos, 'base.otrasValidaciones'))&&calc.getRef(@datosMujer, 'base.tipoNacimiento')!='cesarea'" message="El Procedimiento Tipo CESÁREA No Corresponde"}}    
    {{validator type="expr" notValidIf="=calc.in(@metodoAnticonceptivo, ['5','8'])&&(!calc.in('Z301', calc.mergeArrays(afeccionPrincipal.base.diagnostico, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.diagnostico, calc.pluckRef(@otrosDiagnosticos, 'base.diagnostico')))||!calc.in('697X', calc.pluckRef(@procedimientoEgresos, 'base.procedimientoCie9')))" message="Método de Planificación Familiar DIU o DIO MEDICADO No Corresponde con el Diagnóstico (Z301) y/o Procedimiento (697X)"}}
    {{validator type="expr" notValidIf="=calc.in(@metodoAnticonceptivo, ['10'])&&(!calc.in('Z302', calc.mergeArrays(afeccionPrincipal.base.diagnostico, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.diagnostico, calc.pluckRef(@otrosDiagnosticos, 'base.diagnostico')))||!calc.in('697X', calc.pluckRef(@procedimientoEgresos, 'base.procedimientoCie9')))" message="Método de Planificación Familiar OTB No Corresponde con el Diagnóstico (Z302) y/o Procedimiento (697X)"}}
    {{validator type="expr" validIf="=calc.isAllTrueFalse(calc.in('Z302', calc.mergeArrays(afeccionPrincipal.base.diagnostico, @afeccionPrincipalReseleccionada&&afeccionPrincipalReseleccionada.base.diagnostico, calc.pluckRef(@otrosDiagnosticos, 'base.diagnostico'))), calc.in('ESTERILIZACION', calc.pluckRef(@procedimientoEgresos, 'base.otrasValidaciones')))" message="El Procedimiento Tipo ESTERILIZACIÓN No Corresponde con los Diagnósticos"}}
  {{/section}}
{{/define}}